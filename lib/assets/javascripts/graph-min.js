/*!
  MIT License
  
  Copyright (c) 2011 David Piegza
  Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
  documentation files (the "Software"), to deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to
  permit persons to whom the Software is furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in all copies or substantial portions of
  the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,
  INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
  PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
  HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF
  CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
  SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
/*! stats.js r5 - http://github.com/mrdoob/stats.js */
var Stats=function(){function O(h,b,k){var e,g,j;for(g=0;g<30;g++){for(e=0;e<73;e++){j=(e+g*74)*4;h[j]=h[j+4];h[j+1]=h[j+5];h[j+2]=h[j+6]}}for(g=0;g<30;g++){j=(73+g*74)*4;if(g<b){h[j]=al[k].bg.r;h[j+1]=al[k].bg.g;h[j+2]=al[k].bg.b}else{h[j]=al[k].fg.r;h[j+1]=al[k].fg.g;h[j+2]=al[k].fg.b}}}var Q=0,M=2,ak,u=0,ae=(new Date).getTime(),n=ae,f=ae,ac=0,aa=1000,Y=0,ad,aj,am,ab,X,Z=0,V=1000,T=0,ai,ah,W,R,U=0,P=1000,N=0,ag,af,S,K,al={fps:{bg:{r:16,g:16,b:48},fg:{r:0,g:255,b:255}},ms:{bg:{r:16,g:48,b:16},fg:{r:0,g:255,b:0}},mem:{bg:{r:48,g:16,b:26},fg:{r:255,g:0,b:128}}};ak=document.createElement("div");ak.style.cursor="pointer";ak.style.width="80px";ak.style.opacity="0.9";ak.style.zIndex="10001";ak.addEventListener("click",function(){Q++;Q==M&&(Q=0);ad.style.display="none";ai.style.display="none";ag.style.display="none";switch(Q){case 0:ad.style.display="block";break;case 1:ai.style.display="block";break;case 2:ag.style.display="block"}},false);ad=document.createElement("div");ad.style.backgroundColor="rgb("+Math.floor(al.fps.bg.r/2)+","+Math.floor(al.fps.bg.g/2)+","+Math.floor(al.fps.bg.b/2)+")";ad.style.padding="2px 0px 3px 0px";ak.appendChild(ad);aj=document.createElement("div");aj.style.fontFamily="Helvetica, Arial, sans-serif";aj.style.textAlign="left";aj.style.fontSize="9px";aj.style.color="rgb("+al.fps.fg.r+","+al.fps.fg.g+","+al.fps.fg.b+")";aj.style.margin="0px 0px 1px 3px";aj.innerHTML='<span style="font-weight:bold">FPS</span>';ad.appendChild(aj);am=document.createElement("canvas");am.width=74;am.height=30;am.style.display="block";am.style.marginLeft="3px";ad.appendChild(am);ab=am.getContext("2d");ab.fillStyle="rgb("+al.fps.bg.r+","+al.fps.bg.g+","+al.fps.bg.b+")";ab.fillRect(0,0,am.width,am.height);X=ab.getImageData(0,0,am.width,am.height);ai=document.createElement("div");ai.style.backgroundColor="rgb("+Math.floor(al.ms.bg.r/2)+","+Math.floor(al.ms.bg.g/2)+","+Math.floor(al.ms.bg.b/2)+")";ai.style.padding="2px 0px 3px 0px";ai.style.display="none";ak.appendChild(ai);ah=document.createElement("div");ah.style.fontFamily="Helvetica, Arial, sans-serif";ah.style.textAlign="left";ah.style.fontSize="9px";ah.style.color="rgb("+al.ms.fg.r+","+al.ms.fg.g+","+al.ms.fg.b+")";ah.style.margin="0px 0px 1px 3px";ah.innerHTML='<span style="font-weight:bold">MS</span>';ai.appendChild(ah);am=document.createElement("canvas");am.width=74;am.height=30;am.style.display="block";am.style.marginLeft="3px";ai.appendChild(am);W=am.getContext("2d");W.fillStyle="rgb("+al.ms.bg.r+","+al.ms.bg.g+","+al.ms.bg.b+")";W.fillRect(0,0,am.width,am.height);R=W.getImageData(0,0,am.width,am.height);try{if(performance&&performance.memory&&performance.memory.totalJSHeapSize){M=3}}catch(c){}ag=document.createElement("div");ag.style.backgroundColor="rgb("+Math.floor(al.mem.bg.r/2)+","+Math.floor(al.mem.bg.g/2)+","+Math.floor(al.mem.bg.b/2)+")";ag.style.padding="2px 0px 3px 0px";ag.style.display="none";ak.appendChild(ag);af=document.createElement("div");af.style.fontFamily="Helvetica, Arial, sans-serif";af.style.textAlign="left";af.style.fontSize="9px";af.style.color="rgb("+al.mem.fg.r+","+al.mem.fg.g+","+al.mem.fg.b+")";af.style.margin="0px 0px 1px 3px";af.innerHTML='<span style="font-weight:bold">MEM</span>';ag.appendChild(af);am=document.createElement("canvas");am.width=74;am.height=30;am.style.display="block";am.style.marginLeft="3px";ag.appendChild(am);S=am.getContext("2d");S.fillStyle="#301010";S.fillRect(0,0,am.width,am.height);K=S.getImageData(0,0,am.width,am.height);return{domElement:ak,update:function(){u++;ae=(new Date).getTime();Z=ae-n;V=Math.min(V,Z);T=Math.max(T,Z);O(R.data,Math.min(30,30-Z/200*30),"ms");ah.innerHTML='<span style="font-weight:bold">'+Z+" MS</span> ("+V+"-"+T+")";W.putImageData(R,0,0);n=ae;if(ae>f+1000){ac=Math.round(u*1000/(ae-f));aa=Math.min(aa,ac);Y=Math.max(Y,ac);O(X.data,Math.min(30,30-ac/100*30),"fps");aj.innerHTML='<span style="font-weight:bold">'+ac+" FPS</span> ("+aa+"-"+Y+")";ab.putImageData(X,0,0);if(M==3){U=performance.memory.usedJSHeapSize*9.54e-7;P=Math.min(P,U);N=Math.max(N,U);O(K.data,Math.min(30,30-U/2),"mem");af.innerHTML='<span style="font-weight:bold">'+Math.round(U)+" MEM</span> ("+Math.round(P)+"-"+Math.round(N)+")";S.putImageData(K,0,0)}f=ae;u=0}}}};
/*!
 * Provides requestAnimationFrame in a cross browser way.
 * http://paulirish.com/2011/requestanimationframe-for-smart-animating/
 */
if(!window.requestAnimationFrame){window.requestAnimationFrame=(function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c,b){window.setTimeout(c,1000/60)}})()}var THREEJS=THREEJS||{};THREEJS.Interaction=function(v,c){var k=0,j=0,B=0,z=0,w=0,g=0,e=0,y=0,A=0,x=false,o=window.innerWidth/2,n=window.innerHeight/2,t=false,u=false;var v=v;this.element=c||document;this.element.addEventListener("mousedown",h,false);this.element.addEventListener("mousemove",p,false);this.element.addEventListener("mouseup",f,false);this.element.addEventListener("mousewheel",m,false);this.element.addEventListener("DOMMouseScroll",m,false);this.element.addEventListener("mousewheel",m,false);function h(C){C.preventDefault();if(C.button==2){w=40}if(C.button==0){u=true;x=true}}function p(C){C.preventDefault();if(u){t=true}if(x){B=C.clientX;z=C.clientY;w=0;g=0;y=C.clientX;A=C.clientY;x=false}if(t&&u&&C.shiftKey){B=C.clientX;z=C.clientY;g=(z-A);e=(B-y);y=B;A=z}else{if(t&&u){B=C.clientX;z=C.clientY;w=(B-y);g=(z-A);y=B;A=z}}}function f(C){C.preventDefault();if(C.button==0){u=false}}function m(C){C.preventDefault();var D=0;if(C.wheelDelta){D=C.wheelDelta/120}else{if(C.detail){D=-C.detail/3}}if(C.shiftKey){v.rotation.x+=D*0.2}else{v.position.z-=D*1000}}function b(C){distanceTarget-=C;distanceTarget=distanceTarget>1000?1000:distanceTarget;distanceTarget=distanceTarget<350?350:distanceTarget}this.update=function(){var C=v.position.z/1000;v.position.x-=(w*2)*(C);v.position.y+=(g*2)*(C);v.rotation.y=(e/20);if(w>-0.5&&w<0.5){w=0}if(g>-0.5&&g<0.5){g=0}w*=0.9;g*=0.9}};
/*! Three.js r42 - http://github.com/mrdoob/three.js */
var THREE=THREE||{};if(!window.Int32Array){window.Int32Array=Array,window.Float32Array=Array}THREE.Color=function(c){this.setHex(c)};THREE.Color.prototype={copy:function(c){this.r=c.r;this.g=c.g;this.b=c.b;this.hex=c.hex},setHex:function(c){this.hex=~~c&16777215;this.updateRGB()},setRGB:function(f,h,g){this.r=f;this.g=h;this.b=g;this.updateHex()},setHSV:function(y,x,w){var v,u,p,t,o,j;if(w==0){v=u=p=0}else{switch(t=Math.floor(y*6),o=y*6-t,y=w*(1-x),j=w*(1-x*o),x=w*(1-x*(1-o)),t){case 1:v=j;u=w;p=y;break;case 2:v=y;u=w;p=x;break;case 3:v=y;u=j;p=w;break;case 4:v=x;u=y;p=w;break;case 5:v=w;u=y;p=j;break;case 6:case 0:v=w,u=x,p=y}}this.setRGB(v,u,p)},updateHex:function(){this.hex=~~(this.r*255)<<16^~~(this.g*255)<<8^~~(this.b*255)},updateRGB:function(){this.r=(this.hex>>16&255)/255;this.g=(this.hex>>8&255)/255;this.b=(this.hex&255)/255},clone:function(){return new THREE.Color(this.hex)}};THREE.Vector2=function(e,f){this.set(e||0,f||0)};THREE.Vector2.prototype={set:function(e,f){this.x=e;this.y=f;return this},copy:function(c){this.x=c.x;this.y=c.y;return this},clone:function(){return new THREE.Vector2(this.x,this.y)},add:function(e,f){this.x=e.x+f.x;this.y=e.y+f.y;return this},addSelf:function(c){this.x+=c.x;this.y+=c.y;return this},sub:function(e,f){this.x=e.x-f.x;this.y=e.y-f.y;return this},subSelf:function(c){this.x-=c.x;this.y-=c.y;return this},multiplyScalar:function(c){this.x*=c;this.y*=c;return this},divideScalar:function(c){c?(this.x/=c,this.y/=c):this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(c){return this.x*c.x+this.y*c.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(c){return Math.sqrt(this.distanceToSquared(c))},distanceToSquared:function(e){var f=this.x-e.x,e=this.y-e.y;return f*f+e*e},setLength:function(c){return this.normalize().multiplyScalar(c)},unit:function(){return this.normalize()},equals:function(c){return c.x==this.x&&c.y==this.y}};THREE.Vector3=function(f,h,g){this.set(f||0,h||0,g||0)};THREE.Vector3.prototype={set:function(f,h,g){this.x=f;this.y=h;this.z=g;return this},copy:function(c){this.x=c.x;this.y=c.y;this.z=c.z;return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)},add:function(e,f){this.x=e.x+f.x;this.y=e.y+f.y;this.z=e.z+f.z;return this},addSelf:function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;return this},addScalar:function(c){this.x+=c;this.y+=c;this.z+=c;return this},sub:function(e,f){this.x=e.x-f.x;this.y=e.y-f.y;this.z=e.z-f.z;return this},subSelf:function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;return this},multiply:function(e,f){this.x=e.x*f.x;this.y=e.y*f.y;this.z=e.z*f.z;return this},multiplySelf:function(c){this.x*=c.x;this.y*=c.y;this.z*=c.y;return this},multiplyScalar:function(c){this.x*=c;this.y*=c;this.z*=c;return this},divideSelf:function(c){return this.divide(this,c)},divideScalar:function(c){c?(this.x/=c,this.y/=c,this.z/=c):this.set(0,0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return this.x+this.y+this.z},normalize:function(){return this.divideScalar(this.length())},setLength:function(c){return this.normalize().multiplyScalar(c)},cross:function(e,f){this.x=e.y*f.z-e.z*f.y;this.y=e.z*f.x-e.x*f.z;this.z=e.x*f.y-e.y*f.x;return this},crossSelf:function(c){return this.set(this.y*c.z-this.z*c.y,this.z*c.x-this.x*c.z,this.x*c.y-this.y*c.x)},distanceTo:function(c){return Math.sqrt(this.distanceToSquared(c))},distanceToSquared:function(c){return(new THREE.Vector3).sub(this,c).lengthSq()},setPositionFromMatrix:function(c){this.x=c.n14;this.y=c.n24;this.z=c.n34},setRotationFromMatrix:function(e){var f=Math.cos(this.y);this.y=Math.asin(e.n13);Math.abs(f)>0.00001?(this.x=Math.atan2(-e.n23/f,e.n33/f),this.z=Math.atan2(-e.n12/f,e.n11/f)):(this.x=0,this.z=Math.atan2(e.n21,e.n22))},isZero:function(){return this.lengthSq()<0.0001}};THREE.Vector4=function(g,k,j,h){this.set(g||0,k||0,j||0,h||1)};THREE.Vector4.prototype={set:function(g,k,j,h){this.x=g;this.y=k;this.z=j;this.w=h;return this},copy:function(c){return this.set(c.x,c.y,c.z,c.w||1)},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)},add:function(e,f){this.x=e.x+f.x;this.y=e.y+f.y;this.z=e.z+f.z;this.w=e.w+f.w;return this},addSelf:function(c){this.x+=c.x;this.y+=c.y;this.z+=c.z;this.w+=c.w;return this},sub:function(e,f){this.x=e.x-f.x;this.y=e.y-f.y;this.z=e.z-f.z;this.w=e.w-f.w;return this},subSelf:function(c){this.x-=c.x;this.y-=c.y;this.z-=c.z;this.w-=c.w;return this},multiplyScalar:function(c){this.x*=c;this.y*=c;this.z*=c;this.w*=c;return this},divideScalar:function(c){c?(this.x/=c,this.y/=c,this.z/=c,this.w/=c):this.set(0,0,0,1);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(c){return this.x*c.x+this.y*c.y+this.z*c.z+this.w*c.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(c){return this.normalize().multiplyScalar(c)},lerpSelf:function(e,f){this.x+=(e.x-this.x)*f;this.y+=(e.y-this.y)*f;this.z+=(e.z-this.z)*f;this.w+=(e.w-this.w)*f;return this}};THREE.Ray=function(e,f){this.origin=e||new THREE.Vector3;this.direction=f||new THREE.Vector3};THREE.Ray.prototype={intersectScene:function(c){return this.intersectObjects(c.objects)},intersectObjects:function(g){var k,j,h=[];k=0;for(j=g.length;k<j;k++){h=h.concat(this.intersectObject(g[k]))}h.sort(function(c,f){return c.distance-f.distance});return h},intersectObject:function(K){function J(g,k,m){var h,m=m.matrixWorld.getPosition();h=m.clone().subSelf(g).dot(k);g=g.clone().addSelf(k.clone().multiplyScalar(h));return m.distanceTo(g)}function I(k,p,t,o){var o=o.clone().subSelf(p),t=t.clone().subSelf(p),n=k.clone().subSelf(p),k=o.dot(o),p=o.dot(t),o=o.dot(n),m=t.dot(t),t=t.dot(n),n=1/(k*m-p*p),m=(m*o-p*t)*n,k=(k*t-p*o)*n;return m>0&&k>0&&m+k<1}if(K instanceof THREE.Particle){var H=J(this.origin,this.direction,K);if(!H||H>K.scale.x){return[]}return[{distance:H,point:K.position,face:null,object:K}]}else{if(K instanceof THREE.Mesh){H=J(this.origin,this.direction,K);if(!H||H>K.geometry.boundingSphere.radius*Math.max(K.scale.x,Math.max(K.scale.y,K.scale.z))){return[]}var G,E,F,D,C,z,x,O,M,N,L=K.geometry,j=L.vertices,y=[],H=0;for(G=L.faces.length;H<G;H++){if(E=L.faces[H],M=this.origin.clone(),N=this.direction.clone(),z=K.matrixWorld,F=z.multiplyVector3(j[E.a].position.clone()),D=z.multiplyVector3(j[E.b].position.clone()),C=z.multiplyVector3(j[E.c].position.clone()),z=E instanceof THREE.Face4?z.multiplyVector3(j[E.d].position.clone()):null,x=K.matrixRotationWorld.multiplyVector3(E.normal.clone()),O=N.dot(x),K.doubleSided||(K.flipSided?O>0:O<0)){if(x=x.dot((new THREE.Vector3).sub(F,M))/O,M=M.addSelf(N.multiplyScalar(x)),E instanceof THREE.Face3){I(M,F,D,C)&&(E={distance:this.origin.distanceTo(M),point:M,face:E,object:K},y.push(E))}else{if(E instanceof THREE.Face4&&(I(M,F,D,z)||I(M,D,C,z))){E={distance:this.origin.distanceTo(M),point:M,face:E,object:K},y.push(E)}}}}return y}else{return[]}}}};THREE.Rectangle=function(){function n(){o=u-w;p=t-v}var w,v,u,t,o,p,j=!0;this.getX=function(){return w};this.getY=function(){return v};this.getWidth=function(){return o};this.getHeight=function(){return p};this.getLeft=function(){return w};this.getTop=function(){return v};this.getRight=function(){return u};this.getBottom=function(){return t};this.set=function(e,b,f,c){j=!1;w=e;v=b;u=f;t=c;n()};this.addPoint=function(c,b){j?(j=!1,w=c,v=b,u=c,t=b):(w=w<c?w:c,v=v<b?v:b,u=u>c?u:c,t=t>b?t:b);n()};this.add3Points=function(g,c,m,f,b,e){j?(j=!1,w=g<m?g<b?g:b:m<b?m:b,v=c<f?c<e?c:e:f<e?f:e,u=g>m?g>b?g:b:m>b?m:b,t=c>f?c>e?c:e:f>e?f:e):(w=g<m?g<b?g<w?g:w:b<w?b:w:m<b?m<w?m:w:b<w?b:w,v=c<f?c<e?c<v?c:v:e<v?e:v:f<e?f<v?f:v:e<v?e:v,u=g>m?g>b?g>u?g:u:b>u?b:u:m>b?m>u?m:u:b>u?b:u,t=c>f?c>e?c>t?c:t:e>t?e:t:f>e?f>t?f:t:e>t?e:t);n()};this.addRectangle=function(b){j?(j=!1,w=b.getLeft(),v=b.getTop(),u=b.getRight(),t=b.getBottom()):(w=w<b.getLeft()?w:b.getLeft(),v=v<b.getTop()?v:b.getTop(),u=u>b.getRight()?u:b.getRight(),t=t>b.getBottom()?t:b.getBottom());n()};this.inflate=function(b){w-=b;v-=b;u+=b;t+=b;n()};this.minSelf=function(b){w=w>b.getLeft()?w:b.getLeft();v=v>b.getTop()?v:b.getTop();u=u<b.getRight()?u:b.getRight();t=t<b.getBottom()?t:b.getBottom();n()};this.instersects=function(c){return Math.min(u,c.getRight())-Math.max(w,c.getLeft())>=0&&Math.min(t,c.getBottom())-Math.max(v,c.getTop())>=0};this.empty=function(){j=!0;t=u=v=w=0;n()};this.isEmpty=function(){return j}};THREE.Matrix3=function(){this.m=[]};THREE.Matrix3.prototype={transpose:function(){var e,f=this.m;e=f[1];f[1]=f[3];f[3]=e;e=f[2];f[2]=f[6];f[6]=e;e=f[5];f[5]=f[7];f[7]=e;return this},transposeIntoArray:function(e){var f=this.m;e[0]=f[0];e[1]=f[3];e[2]=f[6];e[3]=f[1];e[4]=f[4];e[5]=f[7];e[6]=f[2];e[7]=f[5];e[8]=f[8];return this}};THREE.Matrix4=function(I,H,G,F,E,C,D,A,z,y,x,M,K,L,J,j){this.set(I||1,H||0,G||0,F||0,E||0,C||1,D||0,A||0,z||0,y||0,x||1,M||0,K||0,L||0,J||0,j||1);this.flat=Array(16);this.m33=new THREE.Matrix3};THREE.Matrix4.prototype={set:function(I,H,G,F,E,C,D,A,z,y,x,M,K,L,J,j){this.n11=I;this.n12=H;this.n13=G;this.n14=F;this.n21=E;this.n22=C;this.n23=D;this.n24=A;this.n31=z;this.n32=y;this.n33=x;this.n34=M;this.n41=K;this.n42=L;this.n43=J;this.n44=j;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(c){this.set(c.n11,c.n12,c.n13,c.n14,c.n21,c.n22,c.n23,c.n24,c.n31,c.n32,c.n33,c.n34,c.n41,c.n42,c.n43,c.n44);return this},lookAt:function(h,p,o){var n=THREE.Matrix4.__v1,m=THREE.Matrix4.__v2,j=THREE.Matrix4.__v3;j.sub(h,p).normalize();if(j.length()===0){j.z=1}n.cross(o,j).normalize();n.length()===0&&(j.x+=0.0001,n.cross(o,j).normalize());m.cross(j,n).normalize();this.n11=n.x;this.n12=m.x;this.n13=j.x;this.n21=n.y;this.n22=m.y;this.n23=j.y;this.n31=n.z;this.n32=m.z;this.n33=j.z;return this},multiplyVector3:function(h){var n=h.x,m=h.y,k=h.z,j=1/(this.n41*n+this.n42*m+this.n43*k+this.n44);h.x=(this.n11*n+this.n12*m+this.n13*k+this.n14)*j;h.y=(this.n21*n+this.n22*m+this.n23*k+this.n24)*j;h.z=(this.n31*n+this.n32*m+this.n33*k+this.n34)*j;return h},multiplyVector4:function(h){var n=h.x,m=h.y,k=h.z,j=h.w;h.x=this.n11*n+this.n12*m+this.n13*k+this.n14*j;h.y=this.n21*n+this.n22*m+this.n23*k+this.n24*j;h.z=this.n31*n+this.n32*m+this.n33*k+this.n34*j;h.w=this.n41*n+this.n42*m+this.n43*k+this.n44*j;return h},rotateAxis:function(g){var k=g.x,j=g.y,h=g.z;g.x=k*this.n11+j*this.n12+h*this.n13;g.y=k*this.n21+j*this.n22+h*this.n23;g.z=k*this.n31+j*this.n32+h*this.n33;g.normalize();return g},crossVector:function(e){var f=new THREE.Vector4;f.x=this.n11*e.x+this.n12*e.y+this.n13*e.z+this.n14*e.w;f.y=this.n21*e.x+this.n22*e.y+this.n23*e.z+this.n24*e.w;f.z=this.n31*e.x+this.n32*e.y+this.n33*e.z+this.n34*e.w;f.w=e.w?this.n41*e.x+this.n42*e.y+this.n43*e.z+this.n44*e.w:1;return f},multiply:function(av,au){var at=av.n11,ar=av.n12,aq=av.n13,an=av.n14,ap=av.n21,am=av.n22,al=av.n23,ak=av.n24,ai=av.n31,ad=av.n32,aa=av.n33,ac=av.n34,X=av.n41,ag=av.n42,ah=av.n43,U=av.n44,Y=au.n11,P=au.n12,af=au.n13,W=au.n14,ae=au.n21,M=au.n22,R=au.n23,ab=au.n24,V=au.n31,L=au.n32,O=au.n33,N=au.n34,ao=au.n41,aj=au.n42,E=au.n43,x=au.n44;this.n11=at*Y+ar*ae+aq*V+an*ao;this.n12=at*P+ar*M+aq*L+an*aj;this.n13=at*af+ar*R+aq*O+an*E;this.n14=at*W+ar*ab+aq*N+an*x;this.n21=ap*Y+am*ae+al*V+ak*ao;this.n22=ap*P+am*M+al*L+ak*aj;this.n23=ap*af+am*R+al*O+ak*E;this.n24=ap*W+am*ab+al*N+ak*x;this.n31=ai*Y+ad*ae+aa*V+ac*ao;this.n32=ai*P+ad*M+aa*L+ac*aj;this.n33=ai*af+ad*R+aa*O+ac*E;this.n34=ai*W+ad*ab+aa*N+ac*x;this.n41=X*Y+ag*ae+ah*V+U*ao;this.n42=X*P+ag*M+ah*L+U*aj;this.n43=X*af+ag*R+ah*O+U*E;this.n44=X*W+ag*ab+ah*N+U*x;return this},multiplyToArray:function(f,h,g){this.multiply(f,h);g[0]=this.n11;g[1]=this.n21;g[2]=this.n31;g[3]=this.n41;g[4]=this.n12;g[5]=this.n22;g[6]=this.n32;g[7]=this.n42;g[8]=this.n13;g[9]=this.n23;g[10]=this.n33;g[11]=this.n43;g[12]=this.n14;g[13]=this.n24;g[14]=this.n34;g[15]=this.n44;return this},multiplySelf:function(c){this.multiply(this,c);return this},multiplyScalar:function(c){this.n11*=c;this.n12*=c;this.n13*=c;this.n14*=c;this.n21*=c;this.n22*=c;this.n23*=c;this.n24*=c;this.n31*=c;this.n32*=c;this.n33*=c;this.n34*=c;this.n41*=c;this.n42*=c;this.n43*=c;this.n44*=c;return this},determinant:function(){var I=this.n11,H=this.n12,G=this.n13,F=this.n14,E=this.n21,C=this.n22,D=this.n23,A=this.n24,z=this.n31,y=this.n32,x=this.n33,M=this.n34,K=this.n41,L=this.n42,J=this.n43,j=this.n44;return F*D*y*K-G*A*y*K-F*C*x*K+H*A*x*K+G*C*M*K-H*D*M*K-F*D*z*L+G*A*z*L+F*E*x*L-I*A*x*L-G*E*M*L+I*D*M*L+F*C*z*J-H*A*z*J-F*E*y*J+I*A*y*J+H*E*M*J-I*C*M*J-G*C*z*j+H*D*z*j+G*E*y*j-I*D*y*j-H*E*x*j+I*C*x*j},transpose:function(){var c;c=this.n21;this.n21=this.n12;this.n12=c;c=this.n31;this.n31=this.n13;this.n13=c;c=this.n32;this.n32=this.n23;this.n23=c;c=this.n41;this.n41=this.n14;this.n14=c;c=this.n42;this.n42=this.n24;this.n24=c;c=this.n43;this.n43=this.n34;this.n43=c;return this},clone:function(){var c=new THREE.Matrix4;c.n11=this.n11;c.n12=this.n12;c.n13=this.n13;c.n14=this.n14;c.n21=this.n21;c.n22=this.n22;c.n23=this.n23;c.n24=this.n24;c.n31=this.n31;c.n32=this.n32;c.n33=this.n33;c.n34=this.n34;c.n41=this.n41;c.n42=this.n42;c.n43=this.n43;c.n44=this.n44;return c},flatten:function(){this.flat[0]=this.n11;this.flat[1]=this.n21;this.flat[2]=this.n31;this.flat[3]=this.n41;this.flat[4]=this.n12;this.flat[5]=this.n22;this.flat[6]=this.n32;this.flat[7]=this.n42;this.flat[8]=this.n13;this.flat[9]=this.n23;this.flat[10]=this.n33;this.flat[11]=this.n43;this.flat[12]=this.n14;this.flat[13]=this.n24;this.flat[14]=this.n34;this.flat[15]=this.n44;return this.flat},flattenToArray:function(c){c[0]=this.n11;c[1]=this.n21;c[2]=this.n31;c[3]=this.n41;c[4]=this.n12;c[5]=this.n22;c[6]=this.n32;c[7]=this.n42;c[8]=this.n13;c[9]=this.n23;c[10]=this.n33;c[11]=this.n43;c[12]=this.n14;c[13]=this.n24;c[14]=this.n34;c[15]=this.n44;return c},flattenToArrayOffset:function(e,f){e[f]=this.n11;e[f+1]=this.n21;e[f+2]=this.n31;e[f+3]=this.n41;e[f+4]=this.n12;e[f+5]=this.n22;e[f+6]=this.n32;e[f+7]=this.n42;e[f+8]=this.n13;e[f+9]=this.n23;e[f+10]=this.n33;e[f+11]=this.n43;e[f+12]=this.n14;e[f+13]=this.n24;e[f+14]=this.n34;e[f+15]=this.n44;return e},setTranslation:function(f,h,g){this.set(1,0,0,f,0,1,0,h,0,0,1,g,0,0,0,1);return this},setScale:function(f,h,g){this.set(f,0,0,0,0,h,0,0,0,0,g,0,0,0,0,1);return this},setRotationX:function(e){var f=Math.cos(e),e=Math.sin(e);this.set(1,0,0,0,0,f,-e,0,0,e,f,0,0,0,0,1);return this},setRotationY:function(e){var f=Math.cos(e),e=Math.sin(e);this.set(f,0,e,0,0,1,0,0,-e,0,f,0,0,0,0,1);return this},setRotationZ:function(e){var f=Math.cos(e),e=Math.sin(e);this.set(f,-e,0,0,e,f,0,0,0,0,1,0,0,0,0,1);return this},setRotationAxis:function(A,z){var y=Math.cos(z),x=Math.sin(z),w=1-y,u=A.x,v=A.y,t=A.z,p=w*u,j=w*v;this.set(p*u+y,p*v-x*t,p*t+x*v,0,p*v+x*t,j*v+y,j*t-x*u,0,p*t-x*v,j*t+x*u,w*t*t+y,0,0,0,0,1);return this},setPosition:function(c){this.n14=c.x;this.n24=c.y;this.n34=c.z;return this},getPosition:function(){if(!this.position){this.position=new THREE.Vector3}this.position.set(this.n14,this.n24,this.n34);return this.position},getColumnX:function(){if(!this.columnX){this.columnX=new THREE.Vector3}this.columnX.set(this.n11,this.n21,this.n31);return this.columnX},getColumnY:function(){if(!this.columnY){this.columnY=new THREE.Vector3}this.columnY.set(this.n12,this.n22,this.n32);return this.columnY},getColumnZ:function(){if(!this.columnZ){this.columnZ=new THREE.Vector3}this.columnZ.set(this.n13,this.n23,this.n33);return this.columnZ},setRotationFromEuler:function(D,C){var B=D.x,A=D.y,z=D.z,x=Math.cos(B),B=Math.sin(B),y=Math.cos(A),A=Math.sin(A),w=Math.cos(z),z=Math.sin(z);switch(C){case"YXZ":var v=y*w,u=y*z,j=A*w,E=A*z;this.n11=v+E*B;this.n12=j*B-u;this.n13=x*A;this.n21=x*z;this.n22=x*w;this.n23=-B;this.n31=u*B-j;this.n32=E+v*B;this.n33=x*y;break;case"ZXY":v=y*w;u=y*z;j=A*w;E=A*z;this.n11=v-E*B;this.n12=-x*z;this.n13=j+u*B;this.n21=u+j*B;this.n22=x*w;this.n23=E-v*B;this.n31=-x*A;this.n32=B;this.n33=x*y;break;case"ZYX":v=x*w;u=x*z;j=B*w;E=B*z;this.n11=y*w;this.n12=j*A-u;this.n13=v*A+E;this.n21=y*z;this.n22=E*A+v;this.n23=u*A-j;this.n31=-A;this.n32=B*y;this.n33=x*y;break;case"YZX":v=x*y;u=x*A;j=B*y;E=B*A;this.n11=y*w;this.n12=E-v*z;this.n13=j*z+u;this.n21=z;this.n22=x*w;this.n23=-B*w;this.n31=-A*w;this.n32=u*z+j;this.n33=v-E*z;break;case"XZY":v=x*y;u=x*A;j=B*y;E=B*A;this.n11=y*w;this.n12=-z;this.n13=A*w;this.n21=v*z+E;this.n22=x*w;this.n23=u*z-j;this.n31=j*z-u;this.n32=B*w;this.n33=E*z+v;break;default:v=x*w,u=x*z,j=B*w,E=B*z,this.n11=y*w,this.n12=-y*z,this.n13=A,this.n21=u+j*A,this.n22=v-E*A,this.n23=-B*y,this.n31=E-v*A,this.n32=j+u*A,this.n33=x*y}return this},setRotationFromQuaternion:function(A){var z=A.x,y=A.y,x=A.z,w=A.w,u=z+z,v=y+y,t=x+x,A=z*u,p=z*v;z*=t;var j=y*v;y*=t;x*=t;u*=w;v*=w;w*=t;this.n11=1-(j+x);this.n12=p-w;this.n13=z+v;this.n21=p+w;this.n22=1-(A+x);this.n23=y-u;this.n31=z-v;this.n32=y+u;this.n33=1-(A+j);return this},scale:function(f){var h=f.x,g=f.y,f=f.z;this.n11*=h;this.n12*=g;this.n13*=f;this.n21*=h;this.n22*=g;this.n23*=f;this.n31*=h;this.n32*=g;this.n33*=f;this.n41*=h;this.n42*=g;this.n43*=f;return this},extractPosition:function(c){this.n14=c.n14;this.n24=c.n24;this.n34=c.n34},extractRotation:function(h,n){var m=1/n.x,k=1/n.y,j=1/n.z;this.n11=h.n11*m;this.n21=h.n21*m;this.n31=h.n31*m;this.n12=h.n12*k;this.n22=h.n22*k;this.n32=h.n32*k;this.n13=h.n13*j;this.n23=h.n23*j;this.n33=h.n33*j}};THREE.Matrix4.makeInvert=function(Q,P){var O=Q.n11,N=Q.n12,M=Q.n13,K=Q.n14,L=Q.n21,J=Q.n22,I=Q.n23,H=Q.n24,G=Q.n31,D=Q.n32,z=Q.n33,C=Q.n34,x=Q.n41,E=Q.n42,F=Q.n43,j=Q.n44;P===void 0&&(P=new THREE.Matrix4);P.n11=I*C*E-H*z*E+H*D*F-J*C*F-I*D*j+J*z*j;P.n12=K*z*E-M*C*E-K*D*F+N*C*F+M*D*j-N*z*j;P.n13=M*H*E-K*I*E+K*J*F-N*H*F-M*J*j+N*I*j;P.n14=K*I*D-M*H*D-K*J*z+N*H*z+M*J*C-N*I*C;P.n21=H*z*x-I*C*x-H*G*F+L*C*F+I*G*j-L*z*j;P.n22=M*C*x-K*z*x+K*G*F-O*C*F-M*G*j+O*z*j;P.n23=K*I*x-M*H*x-K*L*F+O*H*F+M*L*j-O*I*j;P.n24=M*H*G-K*I*G+K*L*z-O*H*z-M*L*C+O*I*C;P.n31=J*C*x-H*D*x+H*G*E-L*C*E-J*G*j+L*D*j;P.n32=K*D*x-N*C*x-K*G*E+O*C*E+N*G*j-O*D*j;P.n33=M*H*x-K*J*x+K*L*E-O*H*E-N*L*j+O*J*j;P.n34=K*J*G-N*H*G-K*L*D+O*H*D+N*L*C-O*J*C;P.n41=I*D*x-J*z*x-I*G*E+L*z*E+J*G*F-L*D*F;P.n42=N*z*x-M*D*x+M*G*E-O*z*E-N*G*F+O*D*F;P.n43=M*J*x-N*I*x-M*L*E+O*I*E+N*L*F-O*J*F;P.n44=N*I*G-M*J*G+M*L*D-O*I*D-N*L*z+O*J*z;P.multiplyScalar(1/Q.determinant());return P};THREE.Matrix4.makeInvert3x3=function(D){var C=D.m33,B=C.m,A=D.n33*D.n22-D.n32*D.n23,z=-D.n33*D.n21+D.n31*D.n23,x=D.n32*D.n21-D.n31*D.n22,y=-D.n33*D.n12+D.n32*D.n13,w=D.n33*D.n11-D.n31*D.n13,v=-D.n32*D.n11+D.n31*D.n12,u=D.n23*D.n12-D.n22*D.n13,j=-D.n23*D.n11+D.n21*D.n13,E=D.n22*D.n11-D.n21*D.n12,D=D.n11*A+D.n21*y+D.n31*u;D==0&&console.error("THREE.Matrix4.makeInvert3x3: Matrix not invertible.");D=1/D;B[0]=D*A;B[1]=D*z;B[2]=D*x;B[3]=D*y;B[4]=D*w;B[5]=D*v;B[6]=D*u;B[7]=D*j;B[8]=D*E;return C};THREE.Matrix4.makeFrustum=function(j,u,t,p,o,m){var n;n=new THREE.Matrix4;n.n11=2*o/(u-j);n.n12=0;n.n13=(u+j)/(u-j);n.n14=0;n.n21=0;n.n22=2*o/(p-t);n.n23=(p+t)/(p-t);n.n24=0;n.n31=0;n.n32=0;n.n33=-(m+o)/(m-o);n.n34=-2*m*o/(m-o);n.n41=0;n.n42=0;n.n43=-1;n.n44=0;return n};THREE.Matrix4.makePerspective=function(h,n,m,k){var j,h=m*Math.tan(h*Math.PI/360);j=-h;return THREE.Matrix4.makeFrustum(j*n,h*n,j,h,m,k)};THREE.Matrix4.makeOrtho=function(A,z,y,x,w,u){var v,t,p,j;v=new THREE.Matrix4;t=z-A;p=y-x;j=u-w;v.n11=2/t;v.n12=0;v.n13=0;v.n14=-((z+A)/t);v.n21=0;v.n22=2/p;v.n23=0;v.n24=-((y+x)/p);v.n31=0;v.n32=0;v.n33=-2/j;v.n34=-((u+w)/j);v.n41=0;v.n42=0;v.n43=0;v.n44=1;return v};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;THREE.Object3D=function(){this.parent=void 0;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.eulerOrder="XYZ";this.scale=new THREE.Vector3(1,1,1);this.flipSided=this.doubleSided=this.dynamic=!1;this.renderDepth=null;this.rotationAutoUpdate=!0;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0;this.quaternion=new THREE.Quaternion;this.useQuaternion=!1;this.boundRadius=0;this.boundRadiusScale=1;this.visible=!0;this._vector=new THREE.Vector3;this.name=""};THREE.Object3D.prototype={translate:function(e,f){this.matrix.rotateAxis(f);this.position.addSelf(f.multiplyScalar(e))},translateX:function(c){this.translate(c,this._vector.set(1,0,0))},translateY:function(c){this.translate(c,this._vector.set(0,1,0))},translateZ:function(c){this.translate(c,this._vector.set(0,0,1))},lookAt:function(c){this.matrix.lookAt(c,this.position,this.up);this.rotationAutoUpdate&&this.rotation.setRotationFromMatrix(this.matrix)},addChild:function(e){if(this.children.indexOf(e)===-1){e.parent!==void 0&&e.parent.removeChild(e);e.parent=this;this.children.push(e);for(var f=this;f.parent!==void 0;){f=f.parent}f!==void 0&&f instanceof THREE.Scene&&f.addChildRecurse(e)}},removeChild:function(e){var f=this.children.indexOf(e);if(f!==-1){e.parent=void 0,this.children.splice(f,1)}},getChildByName:function(h,n){var m,k,j;m=0;for(k=this.children.length;m<k;m++){j=this.children[m];if(j.name===h){return j}if(n&&(j=j.getChildByName(h,n),j!==void 0)){return j}}},updateMatrix:function(){this.matrix.setPosition(this.position);this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=!0},update:function(g,k,j){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||k){g?this.matrixWorld.multiply(g,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixRotationWorld.extractRotation(this.matrixWorld,this.scale),this.matrixWorldNeedsUpdate=!1,k=!0}for(var g=0,h=this.children.length;g<h;g++){this.children[g].update(this.matrixWorld,k,j)}}};THREE.Quaternion=function(g,k,j,h){this.set(g||0,k||0,j||0,h!==void 0?h:1)};THREE.Quaternion.prototype={set:function(g,k,j,h){this.x=g;this.y=k;this.z=j;this.w=h;return this},copy:function(c){this.x=c.x;this.y=c.y;this.z=c.z;this.w=c.w;return this},setFromEuler:function(n){var w=0.5*Math.PI/360,v=n.x*w,u=n.y*w,t=n.z*w,n=Math.cos(u),u=Math.sin(u),w=Math.cos(-t),t=Math.sin(-t),o=Math.cos(v),v=Math.sin(v),p=n*w,j=u*t;this.w=p*o-j*v;this.x=p*v+j*o;this.y=u*w*o+n*t*v;this.z=n*t*o-u*w*v;return this},setFromAxisAngle:function(g,k){var j=k/2,h=Math.sin(j);this.x=g.x*h;this.y=g.y*h;this.z=g.z*h;this.w=Math.cos(j);return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var c=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);c==0?this.w=this.z=this.y=this.x=0:(c=1/c,this.x*=c,this.y*=c,this.z*=c,this.w*=c);return this},multiplySelf:function(n){var w=this.x,v=this.y,u=this.z,t=this.w,o=n.x,p=n.y,j=n.z,n=n.w;this.x=w*n+t*o+v*j-u*p;this.y=v*n+t*p+u*o-w*j;this.z=u*n+t*j+w*p-v*o;this.w=t*n-w*o-v*p-u*j;return this},multiply:function(e,f){this.x=e.x*f.w+e.y*f.z-e.z*f.y+e.w*f.x;this.y=-e.x*f.z+e.y*f.w+e.z*f.x+e.w*f.y;this.z=e.x*f.y-e.y*f.x+e.z*f.w+e.w*f.z;this.w=-e.x*f.x-e.y*f.y-e.z*f.z+e.w*f.w;return this},multiplyVector3:function(D,C){C||(C=D);var B=D.x,A=D.y,z=D.z,x=this.x,y=this.y,w=this.z,v=this.w,u=v*B+y*z-w*A,j=v*A+w*B-x*z,E=v*z+x*A-y*B,B=-x*B-y*A-w*z;C.x=u*v+B*-x+j*-w-E*-y;C.y=j*v+B*-y+E*-x-u*-w;C.z=E*v+B*-w+u*-y-j*-x;return C}};THREE.Quaternion.slerp=function(j,u,t,p){var o=j.w*u.w+j.x*u.x+j.y*u.y+j.z*u.z;if(Math.abs(o)>=1){return t.w=j.w,t.x=j.x,t.y=j.y,t.z=j.z,t}var m=Math.acos(o),n=Math.sqrt(1-o*o);if(Math.abs(n)<0.001){return t.w=0.5*(j.w+u.w),t.x=0.5*(j.x+u.x),t.y=0.5*(j.y+u.y),t.z=0.5*(j.z+u.z),t}o=Math.sin((1-p)*m)/n;p=Math.sin(p*m)/n;t.w=j.w*o+u.w*p;t.x=j.x*o+u.x*p;t.y=j.y*o+u.y*p;t.z=j.z*o+u.z*p;return t};THREE.Vertex=function(c){this.position=c||new THREE.Vector3};THREE.Face3=function(h,p,o,n,m,j){this.a=h;this.b=p;this.c=o;this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3;this.vertexNormals=n instanceof Array?n:[];this.color=m instanceof THREE.Color?m:new THREE.Color;this.vertexColors=m instanceof Array?m:[];this.vertexTangents=[];this.materials=j instanceof Array?j:[j];this.centroid=new THREE.Vector3};THREE.Face4=function(j,u,t,p,o,m,n){this.a=j;this.b=u;this.c=t;this.d=p;this.normal=o instanceof THREE.Vector3?o:new THREE.Vector3;this.vertexNormals=o instanceof Array?o:[];this.color=m instanceof THREE.Color?m:new THREE.Color;this.vertexColors=m instanceof Array?m:[];this.vertexTangents=[];this.materials=n instanceof Array?n:[n];this.centroid=new THREE.Vector3};THREE.UV=function(e,f){this.set(e||0,f||0)};THREE.UV.prototype={set:function(e,f){this.u=e;this.v=f;return this},copy:function(c){this.set(c.u,c.v);return this}};THREE.Geometry=function(){this.id="Geometry"+THREE.GeometryIdCounter++;this.vertices=[];this.colors=[];this.faces=[];this.edges=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.hasTangents=!1};THREE.Geometry.prototype={computeCentroids:function(){var f,h,g;f=0;for(h=this.faces.length;f<h;f++){g=this.faces[f],g.centroid.set(0,0,0),g instanceof THREE.Face3?(g.centroid.addSelf(this.vertices[g.a].position),g.centroid.addSelf(this.vertices[g.b].position),g.centroid.addSelf(this.vertices[g.c].position),g.centroid.divideScalar(3)):g instanceof THREE.Face4&&(g.centroid.addSelf(this.vertices[g.a].position),g.centroid.addSelf(this.vertices[g.b].position),g.centroid.addSelf(this.vertices[g.c].position),g.centroid.addSelf(this.vertices[g.d].position),g.centroid.divideScalar(4))}},computeFaceNormals:function(y){var x,w,v,u,p,t,o=new THREE.Vector3,j=new THREE.Vector3;v=0;for(u=this.faces.length;v<u;v++){p=this.faces[v];if(y&&p.vertexNormals.length){o.set(0,0,0);x=0;for(w=p.vertexNormals.length;x<w;x++){o.addSelf(p.vertexNormals[x])}o.divideScalar(3)}else{x=this.vertices[p.a],w=this.vertices[p.b],t=this.vertices[p.c],o.sub(t.position,w.position),j.sub(x.position,w.position),o.crossSelf(j)}o.isZero()||o.normalize();p.normal.copy(o)}},computeVertexNormals:function(){var g,k,j,h;if(this.__tmpVertices==void 0){h=this.__tmpVertices=Array(this.vertices.length);g=0;for(k=this.vertices.length;g<k;g++){h[g]=new THREE.Vector3}g=0;for(k=this.faces.length;g<k;g++){if(j=this.faces[g],j instanceof THREE.Face3){j.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}else{if(j instanceof THREE.Face4){j.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}}}else{h=this.__tmpVertices;g=0;for(k=this.vertices.length;g<k;g++){h[g].set(0,0,0)}}g=0;for(k=this.faces.length;g<k;g++){j=this.faces[g],j instanceof THREE.Face3?(h[j.a].addSelf(j.normal),h[j.b].addSelf(j.normal),h[j.c].addSelf(j.normal)):j instanceof THREE.Face4&&(h[j.a].addSelf(j.normal),h[j.b].addSelf(j.normal),h[j.c].addSelf(j.normal),h[j.d].addSelf(j.normal))}g=0;for(k=this.vertices.length;g<k;g++){h[g].normalize()}g=0;for(k=this.faces.length;g<k;g++){j=this.faces[g],j instanceof THREE.Face3?(j.vertexNormals[0].copy(h[j.a]),j.vertexNormals[1].copy(h[j.b]),j.vertexNormals[2].copy(h[j.c])):j instanceof THREE.Face4&&(j.vertexNormals[0].copy(h[j.a]),j.vertexNormals[1].copy(h[j.b]),j.vertexNormals[2].copy(h[j.c]),j.vertexNormals[3].copy(h[j.d]))}},computeTangents:function(){function at(h,t,u,n,p,o,m){ak=h.vertices[t].position;aj=h.vertices[u].position;ai=h.vertices[n].position;ag=an[p];ab=an[o];Y=an[m];aa=aj.x-ak.x;W=ai.x-ak.x;ae=aj.y-ak.y;af=ai.y-ak.y;R=aj.z-ak.z;X=ai.z-ak.z;O=ab.u-ag.u;ad=Y.u-ag.u;V=ab.v-ag.v;ac=Y.v-ag.v;L=1/(O*ac-ad*V);E.set((ac*aa-V*W)*L,(ac*ae-V*af)*L,(ac*R-V*X)*L);N.set((O*W-ad*aa)*L,(O*af-ad*ae)*L,(O*X-ad*R)*L);Z[t].addSelf(E);Z[u].addSelf(E);Z[n].addSelf(E);U[t].addSelf(N);U[u].addSelf(N);U[n].addSelf(N)}var ar,aq,ap,ao,al,an,ak,aj,ai,ag,ab,Y,aa,W,ae,af,R,X,O,ad,V,ac,L,P,Z=[],U=[],E=new THREE.Vector3,N=new THREE.Vector3,M=new THREE.Vector3,am=new THREE.Vector3,ah=new THREE.Vector3;ar=0;for(aq=this.vertices.length;ar<aq;ar++){Z[ar]=new THREE.Vector3,U[ar]=new THREE.Vector3}ar=0;for(aq=this.faces.length;ar<aq;ar++){al=this.faces[ar],an=this.faceVertexUvs[0][ar],al instanceof THREE.Face3?at(this,al.a,al.b,al.c,0,1,2):al instanceof THREE.Face4&&(at(this,al.a,al.b,al.c,0,1,2),at(this,al.a,al.b,al.d,0,1,3))}var x=["a","b","c","d"];ar=0;for(aq=this.faces.length;ar<aq;ar++){al=this.faces[ar];for(ap=0;ap<al.vertexNormals.length;ap++){ah.copy(al.vertexNormals[ap]),ao=al[x[ap]],P=Z[ao],M.copy(P),M.subSelf(ah.multiplyScalar(ah.dot(P))).normalize(),am.cross(al.vertexNormals[ap],P),ao=am.dot(U[ao]),ao=ao<0?-1:1,al.vertexTangents[ap]=new THREE.Vector4(M.x,M.y,M.z,ao)}}this.hasTangents=!0},computeBoundingBox:function(){var f;if(this.vertices.length>0){this.boundingBox={x:[this.vertices[0].position.x,this.vertices[0].position.x],y:[this.vertices[0].position.y,this.vertices[0].position.y],z:[this.vertices[0].position.z,this.vertices[0].position.z]};for(var h=1,g=this.vertices.length;h<g;h++){f=this.vertices[h];if(f.position.x<this.boundingBox.x[0]){this.boundingBox.x[0]=f.position.x}else{if(f.position.x>this.boundingBox.x[1]){this.boundingBox.x[1]=f.position.x}}if(f.position.y<this.boundingBox.y[0]){this.boundingBox.y[0]=f.position.y}else{if(f.position.y>this.boundingBox.y[1]){this.boundingBox.y[1]=f.position.y}}if(f.position.z<this.boundingBox.z[0]){this.boundingBox.z[0]=f.position.z}else{if(f.position.z>this.boundingBox.z[1]){this.boundingBox.z[1]=f.position.z}}}}},computeBoundingSphere:function(){for(var f=0,h=0,g=this.vertices.length;h<g;h++){f=Math.max(f,this.vertices[h].position.length())}this.boundingSphere={radius:f}},computeEdgeFaces:function(){function n(c,f){return Math.min(c,f)+"_"+Math.max(c,f)}function w(f,g,h){f[g]===void 0?(f[g]={set:{},array:[]},f[g].set[h]=1,f[g].array.push(h)):f[g].set[h]===void 0&&(f[g].set[h]=1,f[g].array.push(h))}var v,u,t,o,p,j={};v=0;for(u=this.faces.length;v<u;v++){p=this.faces[v],p instanceof THREE.Face3?(t=n(p.a,p.b),w(j,t,v),t=n(p.b,p.c),w(j,t,v),t=n(p.a,p.c),w(j,t,v)):p instanceof THREE.Face4&&(t=n(p.b,p.d),w(j,t,v),t=n(p.a,p.b),w(j,t,v),t=n(p.a,p.d),w(j,t,v),t=n(p.b,p.c),w(j,t,v),t=n(p.c,p.d),w(j,t,v))}v=0;for(u=this.edges.length;v<u;v++){p=this.edges[v];t=p.vertexIndices[0];o=p.vertexIndices[1];p.faceIndices=j[n(t,o)].array;for(t=0;t<p.faceIndices.length;t++){o=p.faceIndices[t],p.faces.push(this.faces[o])}}}};THREE.GeometryIdCounter=0;THREE.Spline=function(E){function D(m,v,H,t,p,o,n){m=(H-m)*0.5;t=(t-v)*0.5;return(2*(v-H)+m+t)*n+(-3*(v-H)-2*m-t)*o+m*p+v}this.points=E;var C=[],B={x:0,y:0,z:0},A,y,z,x,w,u,j,G,F;this.initFromArray=function(c){this.points=[];for(var f=0;f<c.length;f++){this.points[f]={x:c[f][0],y:c[f][1],z:c[f][2]}}};this.getPoint=function(c){A=(this.points.length-1)*c;y=Math.floor(A);z=A-y;C[0]=y==0?y:y-1;C[1]=y;C[2]=y>this.points.length-2?y:y+1;C[3]=y>this.points.length-3?y:y+2;u=this.points[C[0]];j=this.points[C[1]];G=this.points[C[2]];F=this.points[C[3]];x=z*z;w=z*x;B.x=D(u.x,j.x,G.x,F.x,z,x,w);B.y=D(u.y,j.y,G.y,F.y,z,x,w);B.z=D(u.z,j.z,G.z,F.z,z,x,w);return B};this.getControlPointsArray=function(){var g,k,m=this.points.length,h=[];for(g=0;g<m;g++){k=this.points[g],h[g]=[k.x,k.y,k.z]}return h};this.getLength=function(o){var I,J,H=I=I=0,v=new THREE.Vector3,t=new THREE.Vector3,p=[],n=0;p[0]=0;o||(o=100);J=this.points.length*o;v.copy(this.points[0]);for(o=1;o<J;o++){I=o/J,position=this.getPoint(I),t.copy(position),n+=t.distanceTo(v),v.copy(position),I*=this.points.length-1,I=Math.floor(I),I!=H&&(p[I]=n,H=I)}p[p.length]=n;return{chunks:p,total:n}};this.reparametrizeByArcLength=function(N){var L,M,K,J,I,H,v=[],t=new THREE.Vector3,p=this.getLength();v.push(t.copy(this.points[0]).clone());for(L=1;L<this.points.length;L++){M=p.chunks[L]-p.chunks[L-1];H=Math.ceil(N*M/p.total);J=(L-1)/(this.points.length-1);I=L/(this.points.length-1);for(M=1;M<H-1;M++){K=J+M*(1/H)*(I-J),position=this.getPoint(K),v.push(t.copy(position).clone())}v.push(t.copy(this.points[L]).clone())}this.points=v}};THREE.Edge=function(g,k,j,h){this.vertices=[g,k];this.vertexIndices=[j,h];this.faces=[];this.faceIndices=[]};THREE.Camera=function(h,n,m,k,j){THREE.Object3D.call(this);this.fov=h||50;this.aspect=n||1;this.near=m||0.1;this.far=k||2000;this.target=j||new THREE.Object3D;this.useTarget=!0;this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=null;this.updateProjectionMatrix()};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.supr=THREE.Object3D.prototype;THREE.Camera.prototype.translate=function(e,f){this.matrix.rotateAxis(f);f.multiplyScalar(e);this.position.addSelf(f);this.target.position.addSelf(f)};THREE.Camera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var g=this.fullWidth/this.fullHeight,k=Math.tan(this.fov*Math.PI/360)*this.near,j=-k,h=g*j,g=Math.abs(g*k-h),j=Math.abs(k-j);this.projectionMatrix=THREE.Matrix4.makeFrustum(h+this.x*g/this.fullWidth,h+(this.x+this.width)*g/this.fullWidth,k-(this.y+this.height)*j/this.fullHeight,k-this.y*j/this.fullHeight,this.near,this.far)}else{this.projectionMatrix=THREE.Matrix4.makePerspective(this.fov,this.aspect,this.near,this.far)}};THREE.Camera.prototype.setViewOffset=function(h,p,o,n,m,j){this.fullWidth=h;this.fullHeight=p;this.x=o;this.y=n;this.width=m;this.height=j;this.updateProjectionMatrix()};THREE.Camera.prototype.update=function(f,h,g){if(this.useTarget){this.matrix.lookAt(this.position,this.target.position,this.up),this.matrix.setPosition(this.position),f?this.matrixWorld.multiply(f,this.matrix):this.matrixWorld.copy(this.matrix),THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse),h=!0}else{if(this.matrixAutoUpdate&&this.updateMatrix(),h||this.matrixWorldNeedsUpdate){f?this.matrixWorld.multiply(f,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,h=!0,THREE.Matrix4.makeInvert(this.matrixWorld,this.matrixWorldInverse)}}for(f=0;f<this.children.length;f++){this.children[f].update(this.matrixWorld,h,g)}};THREE.Light=function(c){THREE.Object3D.call(this);this.color=new THREE.Color(c)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(c){THREE.Light.call(this,c)};THREE.AmbientLight.prototype=new THREE.Light;THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(g,k,j,h){THREE.Light.call(this,g);this.position=new THREE.Vector3(0,1,0);this.intensity=k||1;this.distance=j||0;this.castShadow=h!==void 0?h:!1};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(f,h,g){THREE.Light.call(this,f);this.position=new THREE.Vector3;this.intensity=h||1;this.distance=g||0};THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.LensFlare=function(g,k,j,h){THREE.Object3D.call(this);this.positionScreen=new THREE.Vector3;this.lensFlares=[];this.customUpdateCallback=void 0;g!==void 0&&this.add(g,k,j,h)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;THREE.LensFlare.prototype.add=function(g,k,j,h){k===void 0&&(k=-1);j===void 0&&(j=0);if(h===void 0){h=THREE.BillboardBlending}j=Math.min(j,Math.max(0,j));this.lensFlares.push({texture:g,size:k,distance:j,x:0,y:0,z:0,scale:1,rotation:1,opacity:1,blending:h})};THREE.LensFlare.prototype.updateLensFlares=function(){var h,n=this.lensFlares.length,m,k=-this.positionScreen.x*2,j=-this.positionScreen.y*2;for(h=0;h<n;h++){m=this.lensFlares[h],m.x=this.positionScreen.x+k*m.distance,m.y=this.positionScreen.y+j*m.distance,m.wantedRotation=m.x*Math.PI*0.25,m.rotation+=(m.wantedRotation-m.rotation)*0.25}};THREE.Material=function(c){this.id=THREE.MaterialCounter.value++;c=c||{};this.opacity=c.opacity!==void 0?c.opacity:1;this.transparent=c.transparent!==void 0?c.transparent:!1;this.blending=c.blending!==void 0?c.blending:THREE.NormalBlending;this.depthTest=c.depthTest!==void 0?c.depthTest:!0;this.polygonOffset=c.polygonOffset!==void 0?c.polygonOffset:!1;this.polygonOffsetFactor=c.polygonOffsetFactor!==void 0?c.polygonOffsetFactor:0;this.polygonOffsetUnits=c.polygonOffsetUnits!==void 0?c.polygonOffsetUnits:0};THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=0;THREE.AdditiveBlending=1;THREE.SubtractiveBlending=2;THREE.MultiplyBlending=3;THREE.AdditiveAlphaBlending=4;THREE.MaterialCounter={value:0};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.LatitudeReflectionMapping=function(){};THREE.LatitudeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.UVMapping=function(){};THREE.LineBasicMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.linewidth=c.linewidth!==void 0?c.linewidth:1;this.linecap=c.linecap!==void 0?c.linecap:"round";this.linejoin=c.linejoin!==void 0?c.linejoin:"round";this.vertexColors=c.vertexColors?c.vertexColors:!1};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.MeshBasicMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.map=c.map!==void 0?c.map:null;this.lightMap=c.lightMap!==void 0?c.lightMap:null;this.envMap=c.envMap!==void 0?c.envMap:null;this.combine=c.combine!==void 0?c.combine:THREE.MultiplyOperation;this.reflectivity=c.reflectivity!==void 0?c.reflectivity:1;this.refractionRatio=c.refractionRatio!==void 0?c.refractionRatio:0.98;this.shading=c.shading!==void 0?c.shading:THREE.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.wireframeLinecap=c.wireframeLinecap!==void 0?c.wireframeLinecap:"round";this.wireframeLinejoin=c.wireframeLinejoin!==void 0?c.wireframeLinejoin:"round";this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshLambertMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.map=c.map!==void 0?c.map:null;this.lightMap=c.lightMap!==void 0?c.lightMap:null;this.envMap=c.envMap!==void 0?c.envMap:null;this.combine=c.combine!==void 0?c.combine:THREE.MultiplyOperation;this.reflectivity=c.reflectivity!==void 0?c.reflectivity:1;this.refractionRatio=c.refractionRatio!==void 0?c.refractionRatio:0.98;this.shading=c.shading!==void 0?c.shading:THREE.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.wireframeLinecap=c.wireframeLinecap!==void 0?c.wireframeLinecap:"round";this.wireframeLinejoin=c.wireframeLinejoin!==void 0?c.wireframeLinejoin:"round";this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshPhongMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.ambient=c.ambient!==void 0?new THREE.Color(c.ambient):new THREE.Color(328965);this.specular=c.specular!==void 0?new THREE.Color(c.specular):new THREE.Color(1118481);this.shininess=c.shininess!==void 0?c.shininess:30;this.map=c.map!==void 0?c.map:null;this.lightMap=c.lightMap!==void 0?c.lightMap:null;this.envMap=c.envMap!==void 0?c.envMap:null;this.combine=c.combine!==void 0?c.combine:THREE.MultiplyOperation;this.reflectivity=c.reflectivity!==void 0?c.reflectivity:1;this.refractionRatio=c.refractionRatio!==void 0?c.refractionRatio:0.98;this.shading=c.shading!==void 0?c.shading:THREE.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.wireframeLinecap=c.wireframeLinecap!==void 0?c.wireframeLinecap:"round";this.wireframeLinejoin=c.wireframeLinejoin!==void 0?c.wireframeLinejoin:"round";this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshDepthMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.shading=c.shading!==void 0?c.shading:THREE.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshNormalMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.shading=c.shading?c.shading:THREE.FlatShading;this.wireframe=c.wireframe?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth?c.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};THREE.MeshShaderMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.fragmentShader=c.fragmentShader!==void 0?c.fragmentShader:"void main() {}";this.vertexShader=c.vertexShader!==void 0?c.vertexShader:"void main() {}";this.uniforms=c.uniforms!==void 0?c.uniforms:{};this.attributes=c.attributes;this.shading=c.shading!==void 0?c.shading:THREE.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.fog=c.fog!==void 0?c.fog:!1;this.lights=c.lights!==void 0?c.lights:!1;this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};THREE.MeshShaderMaterial.prototype=new THREE.Material;THREE.MeshShaderMaterial.prototype.constructor=THREE.MeshShaderMaterial;THREE.ShadowVolumeDynamicMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.map=c.map!==void 0?c.map:null;this.lightMap=c.lightMap!==void 0?c.lightMap:null;this.envMap=c.envMap!==void 0?c.envMap:null;this.combine=c.combine!==void 0?c.combine:THREE.MultiplyOperation;this.reflectivity=c.reflectivity!==void 0?c.reflectivity:1;this.refractionRatio=c.refractionRatio!==void 0?c.refractionRatio:0.98;this.shading=c.shading!==void 0?c.shading:THREE.SmoothShading;this.wireframe=c.wireframe!==void 0?c.wireframe:!1;this.wireframeLinewidth=c.wireframeLinewidth!==void 0?c.wireframeLinewidth:1;this.wireframeLinecap=c.wireframeLinecap!==void 0?c.wireframeLinecap:"round";this.wireframeLinejoin=c.wireframeLinejoin!==void 0?c.wireframeLinejoin:"round";this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1;this.skinning=c.skinning!==void 0?c.skinning:!1;this.morphTargets=c.morphTargets!==void 0?c.morphTargets:!1};THREE.ShadowVolumeDynamicMaterial.prototype=new THREE.Material;THREE.ShadowVolumeDynamicMaterial.prototype.constructor=THREE.ShadowVolumeDynamicMaterial;THREE.ParticleBasicMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.map=c.map!==void 0?c.map:null;this.size=c.size!==void 0?c.size:1;this.sizeAttenuation=c.sizeAttenuation!==void 0?c.sizeAttenuation:!0;this.vertexColors=c.vertexColors!==void 0?c.vertexColors:!1};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;THREE.ParticleCanvasMaterial=function(c){THREE.Material.call(this,c);c=c||{};this.color=c.color!==void 0?new THREE.Color(c.color):new THREE.Color(16777215);this.program=c.program!==void 0?c.program:function(){}};THREE.ParticleCanvasMaterial.prototype=new THREE.Material;THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial;THREE.ParticleDOMMaterial=function(c){THREE.Material.call(this);this.domElement=c};THREE.Texture=function(h,p,o,n,m,j){this.image=h;this.mapping=p!==void 0?p:new THREE.UVMapping;this.wrapS=o!==void 0?o:THREE.ClampToEdgeWrapping;this.wrapT=n!==void 0?n:THREE.ClampToEdgeWrapping;this.magFilter=m!==void 0?m:THREE.LinearFilter;this.minFilter=j!==void 0?j:THREE.LinearMipMapLinearFilter;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.needsUpdate=!1};THREE.Texture.prototype={clone:function(){return new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter)}};THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.Particle=function(c){THREE.Object3D.call(this);this.materials=c instanceof Array?c:[c]};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.ParticleSystem=function(e,f){THREE.Object3D.call(this);this.geometry=e;this.materials=f instanceof Array?f:[f];this.sortParticles=!1};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;THREE.Line=function(f,h,g){THREE.Object3D.call(this);this.geometry=f;this.materials=h instanceof Array?h:[h];this.type=g!=void 0?g:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;THREE.Mesh=function(f,h){THREE.Object3D.call(this);this.geometry=f;this.materials=h&&h.length?h:[h];this.overdraw=!1;if(this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere(),this.boundRadius=f.boundingSphere.radius,this.geometry.morphTargets.length)){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var g=0;g<this.geometry.morphTargets.length;g++){this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[g].name]=g}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(c){if(this.morphTargetDictionary[c]!==void 0){return this.morphTargetDictionary[c]}console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+c+" does not exist. Returning 0.");return 0};THREE.Bone=function(c){THREE.Object3D.call(this);this.skin=c;this.skinMatrix=new THREE.Matrix4;this.hasNoneBoneChildren=!1};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;THREE.Bone.prototype.update=function(h,n,m){this.matrixAutoUpdate&&(n|=this.updateMatrix());if(n||this.matrixWorldNeedsUpdate){h?this.skinMatrix.multiply(h,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,n=!0}var k,j=this.children.length;if(this.hasNoneBoneChildren){this.matrixWorld.multiply(this.skin.matrixWorld,this.skinMatrix);for(k=0;k<j;k++){h=this.children[k],h instanceof THREE.Bone?h.update(this.skinMatrix,n,m):h.update(this.matrixWorld,!0,m)}}else{for(k=0;k<j;k++){this.children[k].update(this.skinMatrix,n,m)}}};THREE.Bone.prototype.addChild=function(c){if(this.children.indexOf(c)===-1&&(c.parent!==void 0&&c.parent.removeChild(c),c.parent=this,this.children.push(c),!(c instanceof THREE.Bone))){this.hasNoneBoneChildren=!0}};THREE.SkinnedMesh=function(n,w){THREE.Mesh.call(this,n,w);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var v,u,t,o,p,j;if(this.geometry.bones!==void 0){for(v=0;v<this.geometry.bones.length;v++){t=this.geometry.bones[v],o=t.pos,p=t.rotq,j=t.scl,u=this.addBone(),u.name=t.name,u.position.set(o[0],o[1],o[2]),u.quaternion.set(p[0],p[1],p[2],p[3]),u.useQuaternion=!0,j!==void 0?u.scale.set(j[0],j[1],j[2]):u.scale.set(1,1,1)}for(v=0;v<this.bones.length;v++){t=this.geometry.bones[v],u=this.bones[v],t.parent===-1?this.addChild(u):this.bones[t.parent].addChild(u)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;THREE.SkinnedMesh.prototype.update=function(h,n,m){if(this.visible){this.matrixAutoUpdate&&(n|=this.updateMatrix());if(n||this.matrixWorldNeedsUpdate){h?this.matrixWorld.multiply(h,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,n=!0}var k,j=this.children.length;for(k=0;k<j;k++){h=this.children[k],h instanceof THREE.Bone?h.update(this.identityMatrix,!1,m):h.update(this.matrixWorld,n,m)}m=this.bones.length;ba=this.bones;bm=this.boneMatrices;for(n=0;n<m;n++){ba[n].skinMatrix.flattenToArrayOffset(bm,n*16)}}};THREE.SkinnedMesh.prototype.addBone=function(c){c===void 0&&(c=new THREE.Bone(this));this.bones.push(c);return c};THREE.SkinnedMesh.prototype.pose=function(){this.update(void 0,!0);for(var h,p=[],o=0;o<this.bones.length;o++){h=this.bones[o],p.push(THREE.Matrix4.makeInvert(h.skinMatrix)),h.skinMatrix.flattenToArrayOffset(this.boneMatrices,o*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];var n;for(h=0;h<this.geometry.skinIndices.length;h++){var o=this.geometry.vertices[h].position,m=this.geometry.skinIndices[h].x,j=this.geometry.skinIndices[h].y;n=new THREE.Vector3(o.x,o.y,o.z);this.geometry.skinVerticesA.push(p[m].multiplyVector3(n));n=new THREE.Vector3(o.x,o.y,o.z);this.geometry.skinVerticesB.push(p[j].multiplyVector3(n));this.geometry.skinWeights[h].x+this.geometry.skinWeights[h].y!==1&&(o=(1-(this.geometry.skinWeights[h].x+this.geometry.skinWeights[h].y))*0.5,this.geometry.skinWeights[h].x+=o,this.geometry.skinWeights[h].y+=o)}}};THREE.Ribbon=function(e,f){THREE.Object3D.call(this);this.geometry=e;this.materials=f instanceof Array?f:[f]};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.add=function(f,h){h===void 0&&(h=0);for(var h=Math.abs(h),g=0;g<this.LODs.length;g++){if(h<this.LODs[g].visibleAtDistance){break}}this.LODs.splice(g,0,{visibleAtDistance:h,object3D:f});this.addChild(f)};THREE.LOD.prototype.update=function(g,k,j){this.matrixAutoUpdate&&(k|=this.updateMatrix());if(k||this.matrixWorldNeedsUpdate){g?this.matrixWorld.multiply(g,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,k=!0}if(this.LODs.length>1){g=j.matrixWorldInverse;g=-(g.n31*this.position.x+g.n32*this.position.y+g.n33*this.position.z+g.n34);this.LODs[0].object3D.visible=!0;for(var h=1;h<this.LODs.length;h++){if(g>=this.LODs[h].visibleAtDistance){this.LODs[h-1].object3D.visible=!1,this.LODs[h].object3D.visible=!0}else{break}}for(;h<this.LODs.length;h++){this.LODs[h].object3D.visible=!1}}for(g=0;g<this.children.length;g++){this.children[g].update(this.matrixWorld,k,j)}};THREE.ShadowVolume=function(e,f){e instanceof THREE.Mesh?(THREE.Mesh.call(this,e.geometry,f?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]),e.addChild(this)):THREE.Mesh.call(this,e,f?[new THREE.ShadowVolumeDynamicMaterial]:[new THREE.ShadowVolumeDynamicMaterial]);this.calculateShadowVolumeGeometry()};THREE.ShadowVolume.prototype=new THREE.Mesh;THREE.ShadowVolume.prototype.constructor=THREE.ShadowVolume;THREE.ShadowVolume.prototype.supr=THREE.Mesh.prototype;THREE.ShadowVolume.prototype.calculateShadowVolumeGeometry=function(){if(this.geometry.edges&&this.geometry.edges.length){var Q,P,O,N,M,K,L,J,I,H,G,D,z,C,x=new THREE.Geometry;x.vertices=this.geometry.vertices;N=x.faces=this.geometry.faces;var E=x.egdes=this.geometry.edges,F=x.edgeFaces=[];M=0;var j=[];Q=0;for(P=N.length;Q<P;Q++){if(O=N[Q],j.push(M),M+=O instanceof THREE.Face3?3:4,O.vertexNormals[0]=O.normal,O.vertexNormals[1]=O.normal,O.vertexNormals[2]=O.normal,O instanceof THREE.Face4){O.vertexNormals[3]=O.normal}}Q=0;for(P=E.length;Q<P;Q++){J=E[Q],O=J.faces[0],N=J.faces[1],M=J.faceIndices[0],K=J.faceIndices[1],L=J.vertexIndices[0],J=J.vertexIndices[1],O.a===L?(I="a",G=j[M]+0):O.b===L?(I="b",G=j[M]+1):O.c===L?(I="c",G=j[M]+2):O.d===L&&(I="d",G=j[M]+3),O.a===J?(I+="a",D=j[M]+0):O.b===J?(I+="b",D=j[M]+1):O.c===J?(I+="c",D=j[M]+2):O.d===J&&(I+="d",D=j[M]+3),N.a===L?(H="a",z=j[K]+0):N.b===L?(H="b",z=j[K]+1):N.c===L?(H="c",z=j[K]+2):N.d===L&&(H="d",z=j[K]+3),N.a===J?(H+="a",C=j[K]+0):N.b===J?(H+="b",C=j[K]+1):N.c===J?(H+="c",C=j[K]+2):N.d===J&&(H+="d",C=j[K]+3),I==="ac"||I==="ad"||I==="ca"||I==="da"?G>D&&(O=G,G=D,D=O):G<D&&(O=G,G=D,D=O),H==="ac"||H==="ad"||H==="ca"||H==="da"?z>C&&(O=z,z=C,C=O):z<C&&(O=z,z=C,C=O),O=new THREE.Face4(G,D,z,C),O.normal.set(1,0,0),F.push(O)}this.geometry=x}else{this.calculateShadowVolumeGeometryWithoutEdgeInfo(this.geometry)}};THREE.ShadowVolume.prototype.calculateShadowVolumeGeometryWithoutEdgeInfo=function(D){this.geometry=new THREE.Geometry;this.geometry.boundingSphere=D.boundingSphere;this.geometry.edgeFaces=[];var C=this.geometry.vertices,B=this.geometry.faces,A=this.geometry.edgeFaces,z=D.faces,D=D.vertices,x=z.length,y,w,v,u,j,E=["a","b","c","d"];for(v=0;v<x;v++){w=C.length;y=z[v];y instanceof THREE.Face4?(u=4,w=new THREE.Face4(w,w+1,w+2,w+3)):(u=3,w=new THREE.Face3(w,w+1,w+2));w.normal.copy(y.normal);B.push(w);for(w=0;w<u;w++){j=D[y[E[w]]],C.push(new THREE.Vertex(j.position.clone()))}}for(x=0;x<z.length-1;x++){D=B[x];for(y=x+1;y<z.length;y++){w=B[y],w=this.facesShareEdge(C,D,w),w!==void 0&&(w=new THREE.Face4(w.indices[0],w.indices[3],w.indices[2],w.indices[1]),w.normal.set(1,0,0),A.push(w))}}};THREE.ShadowVolume.prototype.facesShareEdge=function(Q,P,O){var N,M,K,L,J,I,H,G,D,z,C,x,E,F=0,j=["a","b","c","d"];N=P instanceof THREE.Face4?4:3;M=O instanceof THREE.Face4?4:3;for(x=0;x<N;x++){K=P[j[x]];J=Q[K];for(E=0;E<M;E++){if(L=O[j[E]],I=Q[L],Math.abs(J.position.x-I.position.x)<0.0001&&Math.abs(J.position.y-I.position.y)<0.0001&&Math.abs(J.position.z-I.position.z)<0.0001&&(F++,F===1&&(H=J,G=I,D=K,z=L,C=j[x]),F===2)){return C+=j[x],C==="ad"||C==="ac"?{faces:[P,O],vertices:[H,G,I,J],indices:[D,z,L,K],vertexTypes:[1,2,2,1],extrudable:!0}:{faces:[P,O],vertices:[H,J,I,G],indices:[D,K,L,z],vertexTypes:[1,1,2,2],extrudable:!0}}}}};THREE.Sprite=function(c){THREE.Object3D.call(this);if(c.material!==void 0){this.material=c.material,this.map=void 0,this.blending=material.blending}else{if(c.map!==void 0){this.map=c.map instanceof THREE.Texture?c.map:THREE.ImageUtils.loadTexture(c.map),this.material=void 0,this.blending=c.blending!==void 0?c.blending:THREE.NormalBlending}}this.useScreenCoordinates=c.useScreenCoordinates!==void 0?c.useScreenCoordinates:!0;this.mergeWith3D=c.mergeWith3D!==void 0?c.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=c.affectedByDistance!==void 0?c.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=c.scaleByViewport!==void 0?c.scaleByViewport:!this.affectedByDistance;this.alignment=c.alignment instanceof THREE.Vector2?c.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.supr=THREE.Object3D.prototype;THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale),this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=!0};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);THREE.Scene=function(){THREE.Object3D.call(this);this.matrixAutoUpdate=!1;this.collisions=this.overrideMaterial=this.fog=null;this.objects=[];this.lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.supr=THREE.Object3D.prototype;THREE.Scene.prototype.addChild=function(c){this.supr.addChild.call(this,c);this.addChildRecurse(c)};THREE.Scene.prototype.addChildRecurse=function(e){if(e instanceof THREE.Light){this.lights.indexOf(e)===-1&&this.lights.push(e)}else{if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&this.objects.indexOf(e)===-1){this.objects.push(e),this.__objectsAdded.push(e)}}for(var f=0;f<e.children.length;f++){this.addChildRecurse(e.children[f])}};THREE.Scene.prototype.removeChild=function(c){this.supr.removeChild.call(this,c);this.removeChildRecurse(c)};THREE.Scene.prototype.removeChildRecurse=function(e){if(e instanceof THREE.Light){var f=this.lights.indexOf(e);f!==-1&&this.lights.splice(f,1)}else{e instanceof THREE.Camera||(f=this.objects.indexOf(e),f!==-1&&(this.objects.splice(f,1),this.__objectsRemoved.push(e)))}for(f=0;f<e.children.length;f++){this.removeChildRecurse(e.children[f])}};THREE.Scene.prototype.addObject=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeObject=THREE.Scene.prototype.removeChild;THREE.Scene.prototype.addLight=THREE.Scene.prototype.addChild;THREE.Scene.prototype.removeLight=THREE.Scene.prototype.removeChild;THREE.Fog=function(f,h,g){this.color=new THREE.Color(f);this.near=h||1;this.far=g||1000};THREE.FogExp2=function(e,f){this.color=new THREE.Color(e);this.density=f!==void 0?f:0.00025};THREE.Projector=function(){function ai(){var c=aa[ab]=aa[ab]||new THREE.RenderableVertex;ab++;return c}function ah(c,f){return f.z-c.z}function ag(m,v){var w=0,o=1,u=m.z+m.w,t=v.z+v.w,p=-m.z+m.w,n=-v.z+v.w;return u>=0&&t>=0&&p>=0&&n>=0?!0:u<0&&t<0||p<0&&n<0?!1:(u<0?w=Math.max(w,u/(u-t)):t<0&&(o=Math.min(o,u/(u-t))),p<0?w=Math.max(w,p/(p-n)):n<0&&(o=Math.min(o,p/(p-n))),o<w?!1:(m.lerpSelf(v,w),v.lerpSelf(m,1-o),!0))}var af,ae,ac=[],ad,ab,aa=[],Z,Y,T=[],P,S=[],N,W,X=[],K,O,x=[],V=new THREE.Vector4,M=new THREE.Vector4,U=new THREE.Matrix4,j=new THREE.Matrix4,E=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],R=new THREE.Vector4,L=new THREE.Vector4;this.projectVector=function(c,f){U.multiply(f.projectionMatrix,f.matrixWorldInverse);U.multiplyVector3(c);return c};this.unprojectVector=function(c,f){U.multiply(f.matrixWorld,THREE.Matrix4.makeInvert(f.projectionMatrix));U.multiplyVector3(c);return c};this.projectObjects=function(z,y,w){var y=[],v,k,g;ae=0;k=z.objects;z=0;for(v=k.length;z<v;z++){g=k[z];var f;if(!(f=!g.visible)){if(f=g instanceof THREE.Mesh){a:{f=void 0;for(var c=g.matrixWorld,B=-g.geometry.boundingSphere.radius*Math.max(g.scale.x,Math.max(g.scale.y,g.scale.z)),A=0;A<6;A++){if(f=E[A].x*c.n14+E[A].y*c.n24+E[A].z*c.n34+E[A].w,f<=B){f=!1;break a}}f=!0}f=!f}}if(!f){f=ac[ae]=ac[ae]||new THREE.RenderableObject,ae++,af=f,V.copy(g.position),U.multiplyVector3(V),af.object=g,af.z=V.z,y.push(af)}}w&&y.sort(ah);return y};this.projectScene=function(I,H,F){var G=[],z=H.near,o=H.far,c,t,Q,h,J,B,u,y,b,w,A,m,n,p,e,v,D;O=W=P=Y=0;H.matrixAutoUpdate&&H.update(void 0,!0);I.update(void 0,!1,H);U.multiply(H.projectionMatrix,H.matrixWorldInverse);E[0].set(U.n41-U.n11,U.n42-U.n12,U.n43-U.n13,U.n44-U.n14);E[1].set(U.n41+U.n11,U.n42+U.n12,U.n43+U.n13,U.n44+U.n14);E[2].set(U.n41+U.n21,U.n42+U.n22,U.n43+U.n23,U.n44+U.n24);E[3].set(U.n41-U.n21,U.n42-U.n22,U.n43-U.n23,U.n44-U.n24);E[4].set(U.n41-U.n31,U.n42-U.n32,U.n43-U.n33,U.n44-U.n34);E[5].set(U.n41+U.n31,U.n42+U.n32,U.n43+U.n33,U.n44+U.n34);for(c=0;c<6;c++){b=E[c],b.divideScalar(Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z))}b=this.projectObjects(I,H,!0);I=0;for(c=b.length;I<c;I++){if(w=b[I].object,w.visible){if(A=w.matrixWorld,m=w.matrixRotationWorld,n=w.materials,p=w.overdraw,ab=0,w instanceof THREE.Mesh){e=w.geometry;h=e.vertices;v=e.faces;e=e.faceVertexUvs;t=0;for(Q=h.length;t<Q;t++){ad=ai(),ad.positionWorld.copy(h[t].position),A.multiplyVector3(ad.positionWorld),ad.positionScreen.copy(ad.positionWorld),U.multiplyVector4(ad.positionScreen),ad.positionScreen.x/=ad.positionScreen.w,ad.positionScreen.y/=ad.positionScreen.w,ad.visible=ad.positionScreen.z>z&&ad.positionScreen.z<o}h=0;for(t=v.length;h<t;h++){Q=v[h];if(Q instanceof THREE.Face3){if(J=aa[Q.a],B=aa[Q.b],u=aa[Q.c],J.visible&&B.visible&&u.visible&&(w.doubleSided||w.flipSided!=(u.positionScreen.x-J.positionScreen.x)*(B.positionScreen.y-J.positionScreen.y)-(u.positionScreen.y-J.positionScreen.y)*(B.positionScreen.x-J.positionScreen.x)<0)){y=T[Y]=T[Y]||new THREE.RenderableFace3,Y++,Z=y,Z.v1.copy(J),Z.v2.copy(B),Z.v3.copy(u)}else{continue}}else{if(Q instanceof THREE.Face4){if(J=aa[Q.a],B=aa[Q.b],u=aa[Q.c],y=aa[Q.d],J.visible&&B.visible&&u.visible&&y.visible&&(w.doubleSided||w.flipSided!=((y.positionScreen.x-J.positionScreen.x)*(B.positionScreen.y-J.positionScreen.y)-(y.positionScreen.y-J.positionScreen.y)*(B.positionScreen.x-J.positionScreen.x)<0||(B.positionScreen.x-u.positionScreen.x)*(y.positionScreen.y-u.positionScreen.y)-(B.positionScreen.y-u.positionScreen.y)*(y.positionScreen.x-u.positionScreen.x)<0))){D=S[P]=S[P]||new THREE.RenderableFace4,P++,Z=D,Z.v1.copy(J),Z.v2.copy(B),Z.v3.copy(u),Z.v4.copy(y)}else{continue}}}Z.normalWorld.copy(Q.normal);m.multiplyVector3(Z.normalWorld);Z.centroidWorld.copy(Q.centroid);A.multiplyVector3(Z.centroidWorld);Z.centroidScreen.copy(Z.centroidWorld);U.multiplyVector3(Z.centroidScreen);u=Q.vertexNormals;J=0;for(B=u.length;J<B;J++){y=Z.vertexNormalsWorld[J],y.copy(u[J]),m.multiplyVector3(y)}J=0;for(B=e.length;J<B;J++){if(D=e[J][h]){u=0;for(y=D.length;u<y;u++){Z.uvs[J][u]=D[u]}}}Z.meshMaterials=n;Z.faceMaterials=Q.materials;Z.overdraw=p;Z.z=Z.centroidScreen.z;G.push(Z)}}else{if(w instanceof THREE.Line){j.multiply(U,A);h=w.geometry.vertices;J=ai();J.positionScreen.copy(h[0].position);j.multiplyVector4(J.positionScreen);t=1;for(Q=h.length;t<Q;t++){if(J=ai(),J.positionScreen.copy(h[t].position),j.multiplyVector4(J.positionScreen),B=aa[ab-2],R.copy(J.positionScreen),L.copy(B.positionScreen),ag(R,L)){R.multiplyScalar(1/R.w),L.multiplyScalar(1/L.w),A=X[W]=X[W]||new THREE.RenderableLine,W++,N=A,N.v1.positionScreen.copy(R),N.v2.positionScreen.copy(L),N.z=Math.max(R.z,L.z),N.materials=w.materials,G.push(N)}}}else{if(w instanceof THREE.Particle&&(M.set(w.matrixWorld.n14,w.matrixWorld.n24,w.matrixWorld.n34,1),U.multiplyVector4(M),M.z/=M.w,M.z>0&&M.z<1)){A=x[O]=x[O]||new THREE.RenderableParticle,O++,K=A,K.x=M.x/M.w,K.y=M.y/M.w,K.z=M.z,K.rotation=w.rotation.z,K.scale.x=w.scale.x*Math.abs(K.x-(M.x+H.projectionMatrix.n11)/(M.w+H.projectionMatrix.n14)),K.scale.y=w.scale.y*Math.abs(K.y-(M.y+H.projectionMatrix.n22)/(M.w+H.projectionMatrix.n24)),K.materials=w.materials,G.push(K)}}}}}F&&G.sort(ah);return G}};THREE.DOMRenderer=function(){THREE.Renderer.call(this);var h=null,p=new THREE.Projector,o,n,m,j;this.domElement=document.createElement("div");this.setSize=function(e,f){o=e;n=f;m=o/2;j=n/2};this.render=function(y,x){var k,g,c,D,A,C,z,b;h=p.projectScene(y,x);k=0;for(g=h.length;k<g;k++){if(A=h[k],A instanceof THREE.RenderableParticle){z=A.x*m+m;b=A.y*j+j;c=0;for(D=A.material.length;c<D;c++){if(C=A.material[c],C instanceof THREE.ParticleDOMMaterial){C=C.domElement,C.style.left=z+"px",C.style.top=b+"px"}}}}}};THREE.CanvasRenderer=function(aH){function aG(c){if(al!=c){an.globalAlpha=al=c}}function aE(c){if(a3!=c){switch(c){case THREE.NormalBlending:an.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:an.globalCompositeOperation="lighter";break;case THREE.SubtractiveBlending:an.globalCompositeOperation="darker"}a3=c}}function aD(c){if(ak!=c.hex){ak=c.hex,an.strokeStyle="#"+ax(ak.toString(16))}}function aC(c){if(a7!=c.hex){a7=c.hex,an.fillStyle="#"+ax(a7.toString(16))}}function ax(c){for(;c.length<6;){c="0"+c}return c}var aA=this,aw=null,au=new THREE.Projector,aH=aH||{},at=aH.canvas!==void 0?aH.canvas:document.createElement("canvas"),ar,aq,ao,ap,an=at.getContext("2d"),a8=new THREE.Color(0),a9=0,al=1,a3=0,ak=null,a7=null,a2=null,a6=null,aT=null,aZ,a4,a1,aR,aY=new THREE.RenderableVertex,M=new THREE.RenderableVertex,ay,av,aQ,aK,aW,af,aM,bc,az,a0,a5,ag,aX=new THREE.Color(0),bh=new THREE.Color(0),aN=new THREE.Color(0),aP=new THREE.Color(0),bf=new THREE.Color(0),aL,ab,bj,bd,aB,aI,bi,x,bb,bg,ai=new THREE.Rectangle,ac=new THREE.Rectangle,aS=new THREE.Rectangle,aV=!1,aF=new THREE.Color,aU=new THREE.Color,be=new THREE.Color,aO=new THREE.Color,ah=new THREE.Vector3,aJ,aj,am,ad,ae,E,aH=16;aJ=document.createElement("canvas");aJ.width=aJ.height=2;aj=aJ.getContext("2d");aj.fillStyle="rgba(0,0,0,1)";aj.fillRect(0,0,2,2);am=aj.getImageData(0,0,2,2);ad=am.data;ae=document.createElement("canvas");ae.width=ae.height=aH;E=ae.getContext("2d");E.translate(-aH/2,-aH/2);E.scale(aH,aH);aH--;this.domElement=at;this.sortElements=this.sortObjects=this.autoClear=!0;this.data={vertices:0,faces:0};this.setSize=function(c,f){ar=c;aq=f;ao=ar/2;ap=aq/2;at.width=ar;at.height=aq;ai.set(-ao,-ap,ao,ap);al=1;a3=0;aT=a6=a2=a7=ak=null};this.setClearColor=function(c,f){a8=c;a9=f};this.setClearColorHex=function(c,f){a8.setHex(c);a9=f};this.clear=function(){an.setTransform(1,0,0,-1,ao,ap);if(!ac.isEmpty()){ac.inflate(1),ac.minSelf(ai),a8.hex==0&&a9==0?an.clearRect(ac.getX(),ac.getY(),ac.getWidth(),ac.getHeight()):(aE(THREE.NormalBlending),aG(1),an.fillStyle="rgba("+Math.floor(a8.r*255)+","+Math.floor(a8.g*255)+","+Math.floor(a8.b*255)+","+a9+")",an.fillRect(ac.getX(),ac.getY(),ac.getWidth(),ac.getHeight())),ac.empty()}};this.render=function(T,P){function O(k){var t,y,o,p=k.lights;aU.setRGB(0,0,0);be.setRGB(0,0,0);aO.setRGB(0,0,0);k=0;for(t=p.length;k<t;k++){y=p[k],o=y.color,y instanceof THREE.AmbientLight?(aU.r+=o.r,aU.g+=o.g,aU.b+=o.b):y instanceof THREE.DirectionalLight?(be.r+=o.r,be.g+=o.g,be.b+=o.b):y instanceof THREE.PointLight&&(aO.r+=o.r,aO.g+=o.g,aO.b+=o.b)}}function N(G,B,C,t){var A,z,y,p,o=G.lights,G=0;for(A=o.length;G<A;G++){z=o[G],y=z.color,z instanceof THREE.DirectionalLight?(p=C.dot(z.position),p<=0||(p*=z.intensity,t.r+=y.r*p,t.g+=y.g*p,t.b+=y.b*p)):z instanceof THREE.PointLight&&(p=C.dot(ah.sub(z.position,B).normalize()),p<=0||(p*=z.distance==0?1:1-Math.min(B.distanceTo(z.position)/z.distance,1),p!=0&&(p*=z.intensity,t.r+=y.r*p,t.g+=y.g*p,t.b+=y.b*p)))}}function H(W,G,U){aG(U.opacity);aE(U.blending);var C,B,z,y,t,A;if(U instanceof THREE.ParticleBasicMaterial){if(U.map){y=U.map.image,t=y.width>>1,A=y.height>>1,U=G.scale.x*ao,z=G.scale.y*ap,C=U*t,B=z*A,aS.set(W.x-C,W.y-B,W.x+C,W.y+B),ai.instersects(aS)&&(an.save(),an.translate(W.x,W.y),an.rotate(-G.rotation),an.scale(U,-z),an.translate(-t,-A),an.drawImage(y,0,0),an.restore())}}else{U instanceof THREE.ParticleCanvasMaterial&&(C=G.scale.x*ao,B=G.scale.y*ap,aS.set(W.x-C,W.y-B,W.x+C,W.y+B),ai.instersects(aS)&&(aD(U.color),aC(U.color),an.save(),an.translate(W.x,W.y),an.rotate(-G.rotation),an.scale(C,B),U.program(an),an.restore()))}}function m(k,o,t,p){aG(p.opacity);aE(p.blending);an.beginPath();an.moveTo(k.positionScreen.x,k.positionScreen.y);an.lineTo(o.positionScreen.x,o.positionScreen.y);an.closePath();if(p instanceof THREE.LineBasicMaterial){k=p.linewidth;if(a2!=k){an.lineWidth=a2=k}k=p.linecap;if(a6!=k){an.lineCap=a6=k}k=p.linejoin;if(aT!=k){an.lineJoin=aT=k}aD(p.color);an.stroke();aS.inflate(p.linewidth*2)}}function L(C,B,A,z,p,k,y,U,G){aA.data.vertices+=3;aA.data.faces++;aG(U.opacity);aE(U.blending);ay=C.positionScreen.x;av=C.positionScreen.y;aQ=B.positionScreen.x;aK=B.positionScreen.y;aW=A.positionScreen.x;af=A.positionScreen.y;h(ay,av,aQ,aK,aW,af);if(U instanceof THREE.MeshBasicMaterial){if(U.map){U.map.mapping instanceof THREE.UVMapping&&(bd=y.uvs[0],j(ay,av,aQ,aK,aW,af,U.map.image,bd[z].u,bd[z].v,bd[p].u,bd[p].v,bd[k].u,bd[k].v))}else{if(U.envMap){if(U.envMap.mapping instanceof THREE.SphericalReflectionMapping){C=P.matrixWorldInverse,ah.copy(y.vertexNormalsWorld[0]),aB=(ah.x*C.n11+ah.y*C.n12+ah.z*C.n13)*0.5+0.5,aI=-(ah.x*C.n21+ah.y*C.n22+ah.z*C.n23)*0.5+0.5,ah.copy(y.vertexNormalsWorld[1]),bi=(ah.x*C.n11+ah.y*C.n12+ah.z*C.n13)*0.5+0.5,x=-(ah.x*C.n21+ah.y*C.n22+ah.z*C.n23)*0.5+0.5,ah.copy(y.vertexNormalsWorld[2]),bb=(ah.x*C.n11+ah.y*C.n12+ah.z*C.n13)*0.5+0.5,bg=-(ah.x*C.n21+ah.y*C.n22+ah.z*C.n23)*0.5+0.5,j(ay,av,aQ,aK,aW,af,U.envMap.image,aB,aI,bi,x,bb,bg)}}else{U.wireframe?J(U.color,U.wireframeLinewidth,U.wireframeLinecap,U.wireframeLinejoin):e(U.color)}}}else{if(U instanceof THREE.MeshLambertMaterial){U.map&&!U.wireframe&&(U.map.mapping instanceof THREE.UVMapping&&(bd=y.uvs[0],j(ay,av,aQ,aK,aW,af,U.map.image,bd[z].u,bd[z].v,bd[p].u,bd[p].v,bd[k].u,bd[k].v)),aE(THREE.SubtractiveBlending)),aV?!U.wireframe&&U.shading==THREE.SmoothShading&&y.vertexNormalsWorld.length==3?(bh.r=aN.r=aP.r=aU.r,bh.g=aN.g=aP.g=aU.g,bh.b=aN.b=aP.b=aU.b,N(G,y.v1.positionWorld,y.vertexNormalsWorld[0],bh),N(G,y.v2.positionWorld,y.vertexNormalsWorld[1],aN),N(G,y.v3.positionWorld,y.vertexNormalsWorld[2],aP),bf.r=(aN.r+aP.r)*0.5,bf.g=(aN.g+aP.g)*0.5,bf.b=(aN.b+aP.b)*0.5,bj=I(bh,aN,aP,bf),j(ay,av,aQ,aK,aW,af,bj,0,0,1,0,0,1)):(aF.r=aU.r,aF.g=aU.g,aF.b=aU.b,N(G,y.centroidWorld,y.normalWorld,aF),aX.r=Math.max(0,Math.min(U.color.r*aF.r,1)),aX.g=Math.max(0,Math.min(U.color.g*aF.g,1)),aX.b=Math.max(0,Math.min(U.color.b*aF.b,1)),aX.updateHex(),U.wireframe?J(aX,U.wireframeLinewidth,U.wireframeLinecap,U.wireframeLinejoin):e(aX)):U.wireframe?J(U.color,U.wireframeLinewidth,U.wireframeLinecap,U.wireframeLinejoin):e(U.color)}else{if(U instanceof THREE.MeshDepthMaterial){aL=P.near,ab=P.far,bh.r=bh.g=bh.b=1-f(C.positionScreen.z,aL,ab),aN.r=aN.g=aN.b=1-f(B.positionScreen.z,aL,ab),aP.r=aP.g=aP.b=1-f(A.positionScreen.z,aL,ab),bf.r=(aN.r+aP.r)*0.5,bf.g=(aN.g+aP.g)*0.5,bf.b=(aN.b+aP.b)*0.5,bj=I(bh,aN,aP,bf),j(ay,av,aQ,aK,aW,af,bj,0,0,1,0,0,1)}else{if(U instanceof THREE.MeshNormalMaterial){aX.r=D(y.normalWorld.x),aX.g=D(y.normalWorld.y),aX.b=D(y.normalWorld.z),aX.updateHex(),U.wireframe?J(aX,U.wireframeLinewidth,U.wireframeLinecap,U.wireframeLinejoin):e(aX)}}}}}function K(C,B,A,z,p,k,U,y,G){aA.data.vertices+=4;aA.data.faces++;aG(y.opacity);aE(y.blending);if(y.map||y.envMap){L(C,B,z,0,1,3,U,y,G),L(p,A,k,1,2,3,U,y,G)}else{if(ay=C.positionScreen.x,av=C.positionScreen.y,aQ=B.positionScreen.x,aK=B.positionScreen.y,aW=A.positionScreen.x,af=A.positionScreen.y,aM=z.positionScreen.x,bc=z.positionScreen.y,az=p.positionScreen.x,a0=p.positionScreen.y,a5=k.positionScreen.x,ag=k.positionScreen.y,y instanceof THREE.MeshBasicMaterial){w(ay,av,aQ,aK,aW,af,aM,bc),y.wireframe?J(y.color,y.wireframeLinewidth,y.wireframeLinecap,y.wireframeLinejoin):e(y.color)}else{if(y instanceof THREE.MeshLambertMaterial){aV?!y.wireframe&&y.shading==THREE.SmoothShading&&U.vertexNormalsWorld.length==4?(bh.r=aN.r=aP.r=bf.r=aU.r,bh.g=aN.g=aP.g=bf.g=aU.g,bh.b=aN.b=aP.b=bf.b=aU.b,N(G,U.v1.positionWorld,U.vertexNormalsWorld[0],bh),N(G,U.v2.positionWorld,U.vertexNormalsWorld[1],aN),N(G,U.v4.positionWorld,U.vertexNormalsWorld[3],aP),N(G,U.v3.positionWorld,U.vertexNormalsWorld[2],bf),bj=I(bh,aN,aP,bf),h(ay,av,aQ,aK,aM,bc),j(ay,av,aQ,aK,aM,bc,bj,0,0,1,0,0,1),h(az,a0,aW,af,a5,ag),j(az,a0,aW,af,a5,ag,bj,1,0,1,1,0,1)):(aF.r=aU.r,aF.g=aU.g,aF.b=aU.b,N(G,U.centroidWorld,U.normalWorld,aF),aX.r=Math.max(0,Math.min(y.color.r*aF.r,1)),aX.g=Math.max(0,Math.min(y.color.g*aF.g,1)),aX.b=Math.max(0,Math.min(y.color.b*aF.b,1)),aX.updateHex(),w(ay,av,aQ,aK,aW,af,aM,bc),y.wireframe?J(aX,y.wireframeLinewidth,y.wireframeLinecap,y.wireframeLinejoin):e(aX)):(w(ay,av,aQ,aK,aW,af,aM,bc),y.wireframe?J(y.color,y.wireframeLinewidth,y.wireframeLinecap,y.wireframeLinejoin):e(y.color))}else{if(y instanceof THREE.MeshNormalMaterial){aX.r=D(U.normalWorld.x),aX.g=D(U.normalWorld.y),aX.b=D(U.normalWorld.z),aX.updateHex(),w(ay,av,aQ,aK,aW,af,aM,bc),y.wireframe?J(aX,y.wireframeLinewidth,y.wireframeLinecap,y.wireframeLinejoin):e(aX)}else{if(y instanceof THREE.MeshDepthMaterial){aL=P.near,ab=P.far,bh.r=bh.g=bh.b=1-f(C.positionScreen.z,aL,ab),aN.r=aN.g=aN.b=1-f(B.positionScreen.z,aL,ab),aP.r=aP.g=aP.b=1-f(z.positionScreen.z,aL,ab),bf.r=bf.g=bf.b=1-f(A.positionScreen.z,aL,ab),bj=I(bh,aN,aP,bf),h(ay,av,aQ,aK,aM,bc),j(ay,av,aQ,aK,aM,bc,bj,0,0,1,0,0,1),h(az,a0,aW,af,a5,ag),j(az,a0,aW,af,a5,ag,bj,1,0,1,1,0,1)}}}}}}function h(k,y,z,o,t,p){an.beginPath();an.moveTo(k,y);an.lineTo(z,o);an.lineTo(t,p);an.lineTo(k,y);an.closePath()}function w(o,B,C,t,A,z,y,p){an.beginPath();an.moveTo(o,B);an.lineTo(C,t);an.lineTo(A,z);an.lineTo(y,p);an.lineTo(o,B);an.closePath()}function J(k,p,t,o){if(a2!=p){an.lineWidth=a2=p}if(a6!=t){an.lineCap=a6=t}if(aT!=o){an.lineJoin=aT=o}aD(k);an.stroke();aS.inflate(p*2)}function e(k){aC(k);an.fill()}function j(bk,Z,aa,U,Y,X,W,G,C,A,B,bn,z){var y,bl;y=W.width-1;bl=W.height-1;G*=y;C*=bl;A*=y;B*=bl;bn*=y;z*=bl;aa-=bk;U-=Z;Y-=bk;X-=Z;A-=G;B-=C;bn-=G;z-=C;y=A*z-bn*B;y!=0&&(bl=1/y,y=(z*aa-B*Y)*bl,B=(z*U-B*X)*bl,aa=(A*Y-bn*aa)*bl,U=(A*X-bn*U)*bl,bk=bk-y*G-aa*C,Z=Z-B*G-U*C,an.save(),an.transform(y,B,aa,U,bk,Z),an.clip(),an.drawImage(W,0,0),an.restore())}function I(X,U,W,A){var G=~~(X.r*255),C=~~(X.g*255),X=~~(X.b*255),B=~~(U.r*255),z=~~(U.g*255),U=~~(U.b*255),y=~~(W.r*255),o=~~(W.g*255),W=~~(W.b*255),p=~~(A.r*255),Y=~~(A.g*255),A=~~(A.b*255);ad[0]=G<0?0:G>255?255:G;ad[1]=C<0?0:C>255?255:C;ad[2]=X<0?0:X>255?255:X;ad[4]=B<0?0:B>255?255:B;ad[5]=z<0?0:z>255?255:z;ad[6]=U<0?0:U>255?255:U;ad[8]=y<0?0:y>255?255:y;ad[9]=o<0?0:o>255?255:o;ad[10]=W<0?0:W>255?255:W;ad[12]=p<0?0:p>255?255:p;ad[13]=Y<0?0:Y>255?255:Y;ad[14]=A<0?0:A>255?255:A;aj.putImageData(am,0,0);E.drawImage(aJ,0,0);return ae}function f(k,o,p){k=(k-o)/(p-o);return k*k*(3-2*k)}function D(k){k=(k+1)*0.5;return k<0?0:k>1?1:k}function F(k,t){var y=t.x-k.x,o=t.y-k.y,p=1/Math.sqrt(y*y+o*o);y*=p;o*=p;t.x+=y;t.y+=o;k.x-=y;k.y-=o}var S,u,c,v,n,R,g,Q;this.autoClear?this.clear():an.setTransform(1,0,0,-1,ao,ap);aA.data.vertices=0;aA.data.faces=0;aw=au.projectScene(T,P,this.sortElements);(aV=T.lights.length>0)&&O(T);S=0;for(u=aw.length;S<u;S++){c=aw[S];aS.empty();if(c instanceof THREE.RenderableParticle){aZ=c;aZ.x*=ao;aZ.y*=ap;v=0;for(n=c.materials.length;v<n;){Q=c.materials[v++],Q.opacity!=0&&H(aZ,c,Q,T)}}else{if(c instanceof THREE.RenderableLine){if(aZ=c.v1,a4=c.v2,aZ.positionScreen.x*=ao,aZ.positionScreen.y*=ap,a4.positionScreen.x*=ao,a4.positionScreen.y*=ap,aS.addPoint(aZ.positionScreen.x,aZ.positionScreen.y),aS.addPoint(a4.positionScreen.x,a4.positionScreen.y),ai.instersects(aS)){v=0;for(n=c.materials.length;v<n;){Q=c.materials[v++],Q.opacity!=0&&m(aZ,a4,c,Q,T)}}}else{if(c instanceof THREE.RenderableFace3){if(aZ=c.v1,a4=c.v2,a1=c.v3,aZ.positionScreen.x*=ao,aZ.positionScreen.y*=ap,a4.positionScreen.x*=ao,a4.positionScreen.y*=ap,a1.positionScreen.x*=ao,a1.positionScreen.y*=ap,c.overdraw&&(F(aZ.positionScreen,a4.positionScreen),F(a4.positionScreen,a1.positionScreen),F(a1.positionScreen,aZ.positionScreen)),aS.add3Points(aZ.positionScreen.x,aZ.positionScreen.y,a4.positionScreen.x,a4.positionScreen.y,a1.positionScreen.x,a1.positionScreen.y),ai.instersects(aS)){v=0;for(n=c.meshMaterials.length;v<n;){if(Q=c.meshMaterials[v++],Q instanceof THREE.MeshFaceMaterial){R=0;for(g=c.faceMaterials.length;R<g;){(Q=c.faceMaterials[R++])&&Q.opacity!=0&&L(aZ,a4,a1,0,1,2,c,Q,T)}}else{Q.opacity!=0&&L(aZ,a4,a1,0,1,2,c,Q,T)}}}}else{if(c instanceof THREE.RenderableFace4&&(aZ=c.v1,a4=c.v2,a1=c.v3,aR=c.v4,aZ.positionScreen.x*=ao,aZ.positionScreen.y*=ap,a4.positionScreen.x*=ao,a4.positionScreen.y*=ap,a1.positionScreen.x*=ao,a1.positionScreen.y*=ap,aR.positionScreen.x*=ao,aR.positionScreen.y*=ap,aY.positionScreen.copy(a4.positionScreen),M.positionScreen.copy(aR.positionScreen),c.overdraw&&(F(aZ.positionScreen,a4.positionScreen),F(a4.positionScreen,aR.positionScreen),F(aR.positionScreen,aZ.positionScreen),F(a1.positionScreen,aY.positionScreen),F(a1.positionScreen,M.positionScreen)),aS.addPoint(aZ.positionScreen.x,aZ.positionScreen.y),aS.addPoint(a4.positionScreen.x,a4.positionScreen.y),aS.addPoint(a1.positionScreen.x,a1.positionScreen.y),aS.addPoint(aR.positionScreen.x,aR.positionScreen.y),ai.instersects(aS))){v=0;for(n=c.meshMaterials.length;v<n;){if(Q=c.meshMaterials[v++],Q instanceof THREE.MeshFaceMaterial){R=0;for(g=c.faceMaterials.length;R<g;){(Q=c.faceMaterials[R++])&&Q.opacity!=0&&K(aZ,a4,a1,aR,aY,M,c,Q,T)}}else{Q.opacity!=0&&K(aZ,a4,a1,aR,aY,M,c,Q,T)}}}}}}ac.addRectangle(aS)}an.setTransform(1,0,0,1,0,0)}};THREE.SVGRenderer=function(){function av(k,t,u){var m,p,o,n;m=0;for(p=k.lights.length;m<p;m++){o=k.lights[m],o instanceof THREE.DirectionalLight?(n=t.normalWorld.dot(o.position)*o.intensity,n>0&&(u.r+=o.color.r*n,u.g+=o.color.g*n,u.b+=o.color.b*n)):o instanceof THREE.PointLight&&(L.sub(o.position,t.centroidWorld),L.normalize(),n=t.normalWorld.dot(L)*o.intensity,n>0&&(u.r+=o.color.r*n,u.g+=o.color.g*n,u.b+=o.color.b*n))}}function au(h,k,b,j,f,g){ap.data.vertices+=3;ap.data.faces++;ao=ar(aj++);ao.setAttribute("d","M "+h.positionScreen.x+" "+h.positionScreen.y+" L "+k.positionScreen.x+" "+k.positionScreen.y+" L "+b.positionScreen.x+","+b.positionScreen.y+"z");f instanceof THREE.MeshBasicMaterial?W.hex=f.color.hex:f instanceof THREE.MeshLambertMaterial?af?(ae.r=M.r,ae.g=M.g,ae.b=M.b,av(g,j,ae),W.r=Math.max(0,Math.min(f.color.r*ae.r,1)),W.g=Math.max(0,Math.min(f.color.g*ae.g,1)),W.b=Math.max(0,Math.min(f.color.b*ae.b,1)),W.updateHex()):W.hex=f.color.hex:f instanceof THREE.MeshDepthMaterial?(V=1-f.__2near/(f.__farPlusNear-j.z*f.__farMinusNear),W.setRGB(V,V,V)):f instanceof THREE.MeshNormalMaterial&&W.setRGB(aq(j.normalWorld.x),aq(j.normalWorld.y),aq(j.normalWorld.z));f.wireframe?ao.setAttribute("style","fill: none; stroke: #"+an(W.hex.toString(16))+"; stroke-width: "+f.wireframeLinewidth+"; stroke-opacity: "+f.opacity+"; stroke-linecap: "+f.wireframeLinecap+"; stroke-linejoin: "+f.wireframeLinejoin):ao.setAttribute("style","fill: #"+an(W.hex.toString(16))+"; fill-opacity: "+f.opacity);ak.appendChild(ao)}function at(j,o,b,k,g,h,f){ap.data.vertices+=4;ap.data.faces++;ao=ar(aj++);ao.setAttribute("d","M "+j.positionScreen.x+" "+j.positionScreen.y+" L "+o.positionScreen.x+" "+o.positionScreen.y+" L "+b.positionScreen.x+","+b.positionScreen.y+" L "+k.positionScreen.x+","+k.positionScreen.y+"z");h instanceof THREE.MeshBasicMaterial?W.hex=h.color.hex:h instanceof THREE.MeshLambertMaterial?af?(ae.r=M.r,ae.g=M.g,ae.b=M.b,av(f,g,ae),W.r=Math.max(0,Math.min(h.color.r*ae.r,1)),W.g=Math.max(0,Math.min(h.color.g*ae.g,1)),W.b=Math.max(0,Math.min(h.color.b*ae.b,1)),W.updateHex()):W.hex=h.color.hex:h instanceof THREE.MeshDepthMaterial?(V=1-h.__2near/(h.__farPlusNear-g.z*h.__farMinusNear),W.setRGB(V,V,V)):h instanceof THREE.MeshNormalMaterial&&W.setRGB(aq(g.normalWorld.x),aq(g.normalWorld.y),aq(g.normalWorld.z));h.wireframe?ao.setAttribute("style","fill: none; stroke: #"+an(W.hex.toString(16))+"; stroke-width: "+h.wireframeLinewidth+"; stroke-opacity: "+h.opacity+"; stroke-linecap: "+h.wireframeLinecap+"; stroke-linejoin: "+h.wireframeLinejoin):ao.setAttribute("style","fill: #"+an(W.hex.toString(16))+"; fill-opacity: "+h.opacity);ak.appendChild(ao)}function ar(c){O[c]==null&&(O[c]=document.createElementNS("http://www.w3.org/2000/svg","path"),x==0&&O[c].setAttribute("shape-rendering","crispEdges"));return O[c]}function aq(c){c=(c+1)*0.5;return c<0?0:c>1?1:c}function an(c){for(;c.length<6;){c="0"+c}return c}var ap=this,am=null,al=new THREE.Projector,ak=document.createElementNS("http://www.w3.org/2000/svg","svg"),ai,ad,aa,ac,X,ag,ah,U,Y=new THREE.Rectangle,P=new THREE.Rectangle,af=!1,W=new THREE.Color(16777215),ae=new THREE.Color(16777215),M=new THREE.Color(0),R=new THREE.Color(0),ab=new THREE.Color(0),V,L=new THREE.Vector3,O=[],N=[],ao,aj,E,x=1;this.domElement=ak;this.sortElements=this.sortObjects=this.autoClear=!0;this.data={vertices:0,faces:0};this.setQuality=function(c){switch(c){case"high":x=1;break;case"low":x=0}};this.setSize=function(c,f){ai=c;ad=f;aa=ai/2;ac=ad/2;ak.setAttribute("viewBox",-aa+" "+-ac+" "+ai+" "+ad);ak.setAttribute("width",ai);ak.setAttribute("height",ad);Y.set(-aa,-ac,aa,ac)};this.clear=function(){for(;ak.childNodes.length>0;){ak.removeChild(ak.childNodes[0])}};this.render=function(o,k){var j,w,e,v,c,u,m,n;this.autoClear&&this.clear();ap.data.vertices=0;ap.data.faces=0;am=al.projectScene(o,k,this.sortElements);E=aj=0;if(af=o.lights.length>0){m=o.lights;M.setRGB(0,0,0);R.setRGB(0,0,0);ab.setRGB(0,0,0);j=0;for(w=m.length;j<w;j++){e=m[j],v=e.color,e instanceof THREE.AmbientLight?(M.r+=v.r,M.g+=v.g,M.b+=v.b):e instanceof THREE.DirectionalLight?(R.r+=v.r,R.g+=v.g,R.b+=v.b):e instanceof THREE.PointLight&&(ab.r+=v.r,ab.g+=v.g,ab.b+=v.b)}}j=0;for(w=am.length;j<w;j++){if(m=am[j],P.empty(),m instanceof THREE.RenderableParticle){X=m;X.x*=aa;X.y*=-ac;e=0;for(v=m.materials.length;e<v;){e++}}else{if(m instanceof THREE.RenderableLine){if(X=m.v1,ag=m.v2,X.positionScreen.x*=aa,X.positionScreen.y*=-ac,ag.positionScreen.x*=aa,ag.positionScreen.y*=-ac,P.addPoint(X.positionScreen.x,X.positionScreen.y),P.addPoint(ag.positionScreen.x,ag.positionScreen.y),Y.instersects(P)){e=0;for(v=m.materials.length;e<v;){if((n=m.materials[e++])&&n.opacity!=0){c=X;u=ag;var h=E++;N[h]==null&&(N[h]=document.createElementNS("http://www.w3.org/2000/svg","line"),x==0&&N[h].setAttribute("shape-rendering","crispEdges"));ao=N[h];ao.setAttribute("x1",c.positionScreen.x);ao.setAttribute("y1",c.positionScreen.y);ao.setAttribute("x2",u.positionScreen.x);ao.setAttribute("y2",u.positionScreen.y);n instanceof THREE.LineBasicMaterial&&(ao.setAttribute("style","fill: none; stroke: ##"+an(n.color.hex.toString(16))+"; stroke-width: "+n.linewidth+"; stroke-opacity: "+n.opacity+"; stroke-linecap: "+n.linecap+"; stroke-linejoin: "+n.linejoin),ak.appendChild(ao))}}}}else{if(m instanceof THREE.RenderableFace3){if(X=m.v1,ag=m.v2,ah=m.v3,X.positionScreen.x*=aa,X.positionScreen.y*=-ac,ag.positionScreen.x*=aa,ag.positionScreen.y*=-ac,ah.positionScreen.x*=aa,ah.positionScreen.y*=-ac,P.addPoint(X.positionScreen.x,X.positionScreen.y),P.addPoint(ag.positionScreen.x,ag.positionScreen.y),P.addPoint(ah.positionScreen.x,ah.positionScreen.y),Y.instersects(P)){e=0;for(v=m.meshMaterials.length;e<v;){if(n=m.meshMaterials[e++],n instanceof THREE.MeshFaceMaterial){c=0;for(u=m.faceMaterials.length;c<u;){(n=m.faceMaterials[c++])&&n.opacity!=0&&au(X,ag,ah,m,n,o)}}else{n&&n.opacity!=0&&au(X,ag,ah,m,n,o)}}}}else{if(m instanceof THREE.RenderableFace4&&(X=m.v1,ag=m.v2,ah=m.v3,U=m.v4,X.positionScreen.x*=aa,X.positionScreen.y*=-ac,ag.positionScreen.x*=aa,ag.positionScreen.y*=-ac,ah.positionScreen.x*=aa,ah.positionScreen.y*=-ac,U.positionScreen.x*=aa,U.positionScreen.y*=-ac,P.addPoint(X.positionScreen.x,X.positionScreen.y),P.addPoint(ag.positionScreen.x,ag.positionScreen.y),P.addPoint(ah.positionScreen.x,ah.positionScreen.y),P.addPoint(U.positionScreen.x,U.positionScreen.y),Y.instersects(P))){e=0;for(v=m.meshMaterials.length;e<v;){if(n=m.meshMaterials[e++],n instanceof THREE.MeshFaceMaterial){c=0;for(u=m.faceMaterials.length;c<u;){(n=m.faceMaterials[c++])&&n.opacity!=0&&at(X,ag,ah,U,m,n,o)}}else{n&&n.opacity!=0&&at(X,ag,ah,U,m,n,o)}}}}}}}}};THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec4 cubeColor = textureCube( envMap, vec3( -vReflect.x, vReflect.yz ) );\nif ( combine == 1 ) {\ngl_FragColor = vec4( mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity ), opacity );\n} else {\ngl_FragColor = gl_FragColor * cubeColor;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_pars_vertex:"uniform bool enableLighting;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#ifdef PHONG\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif",lights_vertex:"if ( !enableLighting ) {\nvLightWeighting = vec3( 1.0 );\n} else {\nvLightWeighting = ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nfloat directionalLightWeighting = max( dot( transformedNormal, normalize( lDirection.xyz ) ), 0.0 );\nvLightWeighting += directionalLightColor[ i ] * directionalLightWeighting;\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat pointLightWeighting = max( dot( transformedNormal, lVector ), 0.0 );\nvLightWeighting += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef PHONG\nvPointLight[ i ] = vec4( lVector, lDistance );\n#endif\n}\n#endif\n}",lights_pars_fragment:"#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\nvec4 mColor = vec4( diffuse, opacity );\nvec4 mSpecular = vec4( specular, opacity );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointDiffuse  = vec4( 0.0 );\nvec4 pointSpecular = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = pow( pointDotNormalHalf, shininess );\npointDiffuse  += mColor * pointDiffuseWeight * pointDistance;\npointSpecular += mSpecular * pointSpecularWeight * pointDistance;\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirDiffuse  = vec4( 0.0 );\nvec4 dirSpecular = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = pow( dirDotNormalHalf, shininess );\ndirDiffuse  += mColor * dirDiffuseWeight;\ndirSpecular += mSpecular * dirSpecularWeight;\n}\n#endif\nvec4 totalLight = vec4( ambient, opacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirDiffuse + dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointDiffuse + pointSpecular;\n#endif\ngl_FragColor = gl_FragColor * totalLight;",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\nvColor = color;\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * viewMatrix * objectMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\nuniform float morphTargetInfluences[ 8 ];\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0, 0.0, 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif"};THREE.UniformsUtils={merge:function(h){var n,m,k,j={};for(n=0;n<h.length;n++){for(m in k=this.clone(h[n]),k){j[m]=k[m]}}return j},clone:function(h){var n,m,k,j={};for(n in h){for(m in j[n]={},h[n]){k=h[n][m],j[n][m]=k instanceof THREE.Color||k instanceof THREE.Vector3||k instanceof THREE.Texture?k.clone():k}}return j}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:0.98},combine:{type:"i",value:0},fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new THREE.Color(16777215)},morphTargetInfluences:{type:"f",value:0}},lights:{enableLighting:{type:"i",value:1},ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:0.00025},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2000},fogColor:{type:"c",value:new THREE.Color(16777215)}}};THREE.ShaderLib={lensFlareVertexTexture:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 UV;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * vVisibility;\ngl_FragColor = color;\n}\n}"},lensFlare:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 UV;\nvarying vec2 vUV;\nvoid main() {\nvUV = UV;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity * visibility;\ngl_FragColor = color;\n}\n}"},sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 color = texture2D( map, vUV );\ncolor.a *= opacity;\ngl_FragColor = color;\n}"},shadowPost:{vertexShader:"uniform \tmat4 \tprojectionMatrix;\nattribute \tvec3 \tposition;\nvoid main() {\ngl_Position = projectionMatrix * vec4( position, 1.0 );\n}",fragmentShader:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform \tfloat \tdarkness;\nvoid main() {\ngl_FragColor = vec4( 0, 0, 0, darkness );\n}"},shadowVolumeDynamic:{uniforms:{directionalLightDirection:{type:"fv",value:[]}},vertexShader:"uniform \tvec3 \tdirectionalLightDirection;\nvoid main() {\nvec4 pos      = objectMatrix * vec4( position, 1.0 );\nvec3 norm     = mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal;\nvec4 extruded = vec4( directionalLightDirection * 5000.0 * step( 0.0, dot( directionalLightDirection, norm ) ), 0.0 );\ngl_Position   = projectionMatrix * viewMatrix * ( pos + extruded );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0 );\n}"},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2000},opacity:{type:"f",value:1}},fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}",vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}",vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\ngl_Position = projectionMatrix * mvPosition;\n}"},basic:{uniforms:THREE.UniformsLib.common,fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights]),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );\ngl_FragColor = gl_FragColor * vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["varying vec3 vLightWeighting;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"vec3 transformedNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,{ambient:{type:"c",value:new THREE.Color(328965)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30}}]),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 specular;\nuniform float shininess;\nvarying vec3 vLightWeighting;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_pars_fragment,"void main() {\ngl_FragColor = vec4( vLightWeighting, 1.0 );",THREE.ShaderChunk.lights_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["#define PHONG\nvarying vec3 vLightWeighting;\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = cameraPosition - mPosition.xyz;\nvec3 transformedNormal = normalize( normalMatrix * normal );\nvNormal = transformedNormal;",THREE.ShaderChunk.lights_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsLib.particle,fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n")}};THREE.WebGLRenderer=function(a9){function a8(I,G,H){var F,D,C,B=I.vertices,A=B.length,z=I.colors,N=z.length,j=I.__vertexArray,y=I.__colorArray,L=I.__sortArray,K=I.__dirtyVertices,J=I.__dirtyColors;if(H.sortParticles){ab.multiplySelf(H.matrixWorld);for(F=0;F<A;F++){D=B[F].position,aD.copy(D),ab.multiplyVector3(aD),L[F]=[aD.z,F]}L.sort(function(c,f){return f[0]-c[0]});for(F=0;F<A;F++){D=B[L[F][1]].position,C=F*3,j[C]=D.x,j[C+1]=D.y,j[C+2]=D.z}for(F=0;F<N;F++){C=F*3,color=z[L[F][1]],y[C]=color.r,y[C+1]=color.g,y[C+2]=color.b}}else{if(K){for(F=0;F<A;F++){D=B[F].position,C=F*3,j[C]=D.x,j[C+1]=D.y,j[C+2]=D.z}}if(J){for(F=0;F<N;F++){color=z[F],C=F*3,y[C]=color.r,y[C+1]=color.g,y[C+2]=color.b}}}if(K||H.sortParticles){a3.bindBuffer(a3.ARRAY_BUFFER,I.__webglVertexBuffer),a3.bufferData(a3.ARRAY_BUFFER,j,G)}if(J||H.sortParticles){a3.bindBuffer(a3.ARRAY_BUFFER,I.__webglColorBuffer),a3.bufferData(a3.ARRAY_BUFFER,y,G)}}function a7(bj,bh,bi,bg,bf){bg.program||x.initMaterial(bg,bh,bi,bf);var be=bg.program,bd=be.uniforms,bc=bg.uniforms;be!=ah&&(a3.useProgram(be),ah=be);a3.uniformMatrix4fv(bd.projectionMatrix,!1,V);if(bi&&(bg instanceof THREE.MeshBasicMaterial||bg instanceof THREE.MeshLambertMaterial||bg instanceof THREE.MeshPhongMaterial||bg instanceof THREE.LineBasicMaterial||bg instanceof THREE.ParticleBasicMaterial||bg.fog)){if(bc.fogColor.value=bi.color,bi instanceof THREE.Fog){bc.fogNear.value=bi.near,bc.fogFar.value=bi.far}else{if(bi instanceof THREE.FogExp2){bc.fogDensity.value=bi.density}}}if(bg instanceof THREE.MeshPhongMaterial||bg instanceof THREE.MeshLambertMaterial||bg.lights){var bb,S,Z=0,aa=0,Q=0,O,L,J,X,W=aV,I=W.directional.colors,K=W.directional.positions,N=W.point.colors,T=W.point.positions,j=W.point.distances,U=0,R=0,bi=S=X=0;for(bb=bh.length;bi<bb;bi++){if(S=bh[bi],O=S.color,L=S.position,J=S.intensity,X=S.distance,S instanceof THREE.AmbientLight){Z+=O.r,aa+=O.g,Q+=O.b}else{if(S instanceof THREE.DirectionalLight){X=U*3,I[X]=O.r*J,I[X+1]=O.g*J,I[X+2]=O.b*J,K[X]=L.x,K[X+1]=L.y,K[X+2]=L.z,U+=1}else{if(S instanceof THREE.PointLight){S=R*3,N[S]=O.r*J,N[S+1]=O.g*J,N[S+2]=O.b*J,T[S]=L.x,T[S+1]=L.y,T[S+2]=L.z,j[R]=X,R+=1}}}}for(bi=U*3;bi<I.length;bi++){I[bi]=0}for(bi=R*3;bi<N.length;bi++){N[bi]=0}W.point.length=R;W.directional.length=U;W.ambient[0]=Z;W.ambient[1]=aa;W.ambient[2]=Q;bi=aV;bc.enableLighting.value=bi.directional.length+bi.point.length;bc.ambientLightColor.value=bi.ambient;bc.directionalLightColor.value=bi.directional.colors;bc.directionalLightDirection.value=bi.directional.positions;bc.pointLightColor.value=bi.point.colors;bc.pointLightPosition.value=bi.point.positions;bc.pointLightDistance.value=bi.point.distances}if(bg instanceof THREE.MeshBasicMaterial||bg instanceof THREE.MeshLambertMaterial||bg instanceof THREE.MeshPhongMaterial){bc.diffuse.value=bg.color,bc.opacity.value=bg.opacity,(bc.map.texture=bg.map)&&bc.offsetRepeat.value.set(bg.map.offset.x,bg.map.offset.y,bg.map.repeat.x,bg.map.repeat.y),bc.lightMap.texture=bg.lightMap,bc.envMap.texture=bg.envMap,bc.reflectivity.value=bg.reflectivity,bc.refractionRatio.value=bg.refractionRatio,bc.combine.value=bg.combine,bc.useRefract.value=bg.envMap&&bg.envMap.mapping instanceof THREE.CubeRefractionMapping}if(bg instanceof THREE.LineBasicMaterial){bc.diffuse.value=bg.color,bc.opacity.value=bg.opacity}else{if(bg instanceof THREE.ParticleBasicMaterial){bc.psColor.value=bg.color,bc.opacity.value=bg.opacity,bc.size.value=bg.size,bc.scale.value=aW.height/2,bc.map.texture=bg.map}else{if(bg instanceof THREE.MeshPhongMaterial){bc.ambient.value=bg.ambient,bc.specular.value=bg.specular,bc.shininess.value=bg.shininess}else{if(bg instanceof THREE.MeshDepthMaterial){bc.mNear.value=bj.near,bc.mFar.value=bj.far,bc.opacity.value=bg.opacity}else{if(bg instanceof THREE.MeshNormalMaterial){bc.opacity.value=bg.opacity}}}}}for(var P in bc){if(aa=be.uniforms[P]){if(bb=bc[P],Z=bb.type,bi=bb.value,Z=="i"){a3.uniform1i(aa,bi)}else{if(Z=="f"){a3.uniform1f(aa,bi)}else{if(Z=="fv1"){a3.uniform1fv(aa,bi)}else{if(Z=="fv"){a3.uniform3fv(aa,bi)}else{if(Z=="v2"){a3.uniform2f(aa,bi.x,bi.y)}else{if(Z=="v3"){a3.uniform3f(aa,bi.x,bi.y,bi.z)}else{if(Z=="v4"){a3.uniform4f(aa,bi.x,bi.y,bi.z,bi.w)}else{if(Z=="c"){a3.uniform3f(aa,bi.r,bi.g,bi.b)}else{if(Z=="t"&&(a3.uniform1i(aa,bi),bb=bb.texture)){if(bb.image instanceof Array&&bb.image.length==6){if(bb.image.length==6){if(bb.needsUpdate){if(bb.__webglInit){a3.bindTexture(a3.TEXTURE_CUBE_MAP,bb.image.__webglTextureCube);for(Z=0;Z<6;++Z){a3.texSubImage2D(a3.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,0,0,a3.RGBA,a3.UNSIGNED_BYTE,bb.image[Z])}}else{bb.image.__webglTextureCube=a3.createTexture();a3.bindTexture(a3.TEXTURE_CUBE_MAP,bb.image.__webglTextureCube);for(Z=0;Z<6;++Z){a3.texImage2D(a3.TEXTURE_CUBE_MAP_POSITIVE_X+Z,0,a3.RGBA,a3.RGBA,a3.UNSIGNED_BYTE,bb.image[Z])}bb.__webglInit=!0}al(a3.TEXTURE_CUBE_MAP,bb,bb.image[0]);a3.bindTexture(a3.TEXTURE_CUBE_MAP,null);bb.needsUpdate=!1}a3.activeTexture(a3.TEXTURE0+bi);a3.bindTexture(a3.TEXTURE_CUBE_MAP,bb.image.__webglTextureCube)}}else{ar(bb,bi)}}}}}}}}}}}}a3.uniformMatrix4fv(bd.modelViewMatrix,!1,bf._modelViewMatrixArray);a3.uniformMatrix3fv(bd.normalMatrix,!1,bf._normalMatrixArray);(bg instanceof THREE.MeshShaderMaterial||bg instanceof THREE.MeshPhongMaterial||bg.envMap)&&bd.cameraPosition!==null&&a3.uniform3f(bd.cameraPosition,bj.position.x,bj.position.y,bj.position.z);(bg instanceof THREE.MeshShaderMaterial||bg.envMap||bg.skinning)&&bd.objectMatrix!==null&&a3.uniformMatrix4fv(bd.objectMatrix,!1,bf._objectMatrixArray);(bg instanceof THREE.MeshPhongMaterial||bg instanceof THREE.MeshLambertMaterial||bg instanceof THREE.MeshShaderMaterial||bg.skinning)&&bd.viewMatrix!==null&&a3.uniformMatrix4fv(bd.viewMatrix,!1,aO);if(bg instanceof THREE.ShadowVolumeDynamicMaterial){bj=bc.directionalLightDirection.value,bj[0]=-bh[1].position.x,bj[1]=-bh[1].position.y,bj[2]=-bh[1].position.z,a3.uniform3fv(bd.directionalLightDirection,bj),a3.uniformMatrix4fv(bd.objectMatrix,!1,bf._objectMatrixArray),a3.uniformMatrix4fv(bd.viewMatrix,!1,aO)}bg.skinning&&(a3.uniformMatrix4fv(bd.cameraInverseMatrix,!1,aO),a3.uniformMatrix4fv(bd.boneGlobalMatrices,!1,bf.boneMatrices));return be}function a6(F,D,C,B,A,z){if(B.opacity!=0){var y,F=a7(F,D,C,B,z).attributes;if(!B.morphTargets&&F.position>=0){a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglVertexBuffer),a3.vertexAttribPointer(F.position,3,a3.FLOAT,!1,0,0)}else{D=B.program.attributes;z.morphTargetBase!==-1?(a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglMorphTargetsBuffers[z.morphTargetBase]),a3.vertexAttribPointer(D.position,3,a3.FLOAT,!1,0,0)):D.position>=0&&(a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglVertexBuffer),a3.vertexAttribPointer(D.position,3,a3.FLOAT,!1,0,0));if(z.morphTargetForcedOrder.length){for(var C=0,w=z.morphTargetForcedOrder,I=z.morphTargetInfluences;C<B.numSupportedMorphTargets&&C<w.length;){a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglMorphTargetsBuffers[w[C]]),a3.vertexAttribPointer(D["morphTarget"+C],3,a3.FLOAT,!1,0,0),z.__webglMorphTargetInfluences[C]=I[w[C]],C++}}else{var w=[],e=-1,j=0,I=z.morphTargetInfluences,H,G=I.length,C=0;for(z.morphTargetBase!==-1&&(w[z.morphTargetBase]=!0);C<B.numSupportedMorphTargets;){for(H=0;H<G;H++){!w[H]&&I[H]>e&&(j=H,e=I[j])}a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglMorphTargetsBuffers[j]);a3.vertexAttribPointer(D["morphTarget"+C],3,a3.FLOAT,!1,0,0);z.__webglMorphTargetInfluences[C]=e;w[j]=1;e=-1;C++}}B.program.uniforms.morphTargetInfluences!==null&&a3.uniform1fv(B.program.uniforms.morphTargetInfluences,z.__webglMorphTargetInfluences)}if(A.__webglCustomAttributes){for(y in A.__webglCustomAttributes){F[y]>=0&&(D=A.__webglCustomAttributes[y],a3.bindBuffer(a3.ARRAY_BUFFER,D.buffer),a3.vertexAttribPointer(F[y],D.size,a3.FLOAT,!1,0,0))}}F.color>=0&&(a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglColorBuffer),a3.vertexAttribPointer(F.color,3,a3.FLOAT,!1,0,0));F.normal>=0&&(a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglNormalBuffer),a3.vertexAttribPointer(F.normal,3,a3.FLOAT,!1,0,0));F.tangent>=0&&(a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglTangentBuffer),a3.vertexAttribPointer(F.tangent,4,a3.FLOAT,!1,0,0));F.uv>=0&&(A.__webglUVBuffer?(a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglUVBuffer),a3.vertexAttribPointer(F.uv,2,a3.FLOAT,!1,0,0),a3.enableVertexAttribArray(F.uv)):a3.disableVertexAttribArray(F.uv));F.uv2>=0&&(A.__webglUV2Buffer?(a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglUV2Buffer),a3.vertexAttribPointer(F.uv2,2,a3.FLOAT,!1,0,0),a3.enableVertexAttribArray(F.uv2)):a3.disableVertexAttribArray(F.uv2));B.skinning&&F.skinVertexA>=0&&F.skinVertexB>=0&&F.skinIndex>=0&&F.skinWeight>=0&&(a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglSkinVertexABuffer),a3.vertexAttribPointer(F.skinVertexA,4,a3.FLOAT,!1,0,0),a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglSkinVertexBBuffer),a3.vertexAttribPointer(F.skinVertexB,4,a3.FLOAT,!1,0,0),a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglSkinIndicesBuffer),a3.vertexAttribPointer(F.skinIndex,4,a3.FLOAT,!1,0,0),a3.bindBuffer(a3.ARRAY_BUFFER,A.__webglSkinWeightsBuffer),a3.vertexAttribPointer(F.skinWeight,4,a3.FLOAT,!1,0,0));z instanceof THREE.Mesh?(B.wireframe?(a3.lineWidth(B.wireframeLinewidth),a3.bindBuffer(a3.ELEMENT_ARRAY_BUFFER,A.__webglLineBuffer),a3.drawElements(a3.LINES,A.__webglLineCount,a3.UNSIGNED_SHORT,0)):(a3.bindBuffer(a3.ELEMENT_ARRAY_BUFFER,A.__webglFaceBuffer),a3.drawElements(a3.TRIANGLES,A.__webglFaceCount,a3.UNSIGNED_SHORT,0)),x.data.vertices+=A.__webglFaceCount,x.data.faces+=A.__webglFaceCount/3,x.data.drawCalls++):z instanceof THREE.Line?(z=z.type==THREE.LineStrip?a3.LINE_STRIP:a3.LINES,a3.lineWidth(B.linewidth),a3.drawArrays(z,0,A.__webglLineCount),x.data.drawCalls++):z instanceof THREE.ParticleSystem?(a3.drawArrays(a3.POINTS,0,A.__webglParticleCount),x.data.drawCalls++):z instanceof THREE.Ribbon&&(a3.drawArrays(a3.TRIANGLE_STRIP,0,A.__webglVertexCount),x.data.drawCalls++)}}function a5(H,F,G){if(!H.__webglVertexBuffer){H.__webglVertexBuffer=a3.createBuffer()}if(!H.__webglNormalBuffer){H.__webglNormalBuffer=a3.createBuffer()}H.hasPos&&(a3.bindBuffer(a3.ARRAY_BUFFER,H.__webglVertexBuffer),a3.bufferData(a3.ARRAY_BUFFER,H.positionArray,a3.DYNAMIC_DRAW),a3.enableVertexAttribArray(F.attributes.position),a3.vertexAttribPointer(F.attributes.position,3,a3.FLOAT,!1,0,0));if(H.hasNormal){a3.bindBuffer(a3.ARRAY_BUFFER,H.__webglNormalBuffer);if(G==THREE.FlatShading){var D,C,B,A,z,y,K,j,w,J,I=H.count*3;for(J=0;J<I;J+=9){G=H.normalArray,D=G[J],C=G[J+1],B=G[J+2],A=G[J+3],y=G[J+4],j=G[J+5],z=G[J+6],K=G[J+7],w=G[J+8],D=(D+A+z)/3,C=(C+y+K)/3,B=(B+j+w)/3,G[J]=D,G[J+1]=C,G[J+2]=B,G[J+3]=D,G[J+4]=C,G[J+5]=B,G[J+6]=D,G[J+7]=C,G[J+8]=B}}a3.bufferData(a3.ARRAY_BUFFER,H.normalArray,a3.DYNAMIC_DRAW);a3.enableVertexAttribArray(F.attributes.normal);a3.vertexAttribPointer(F.attributes.normal,3,a3.FLOAT,!1,0,0)}a3.drawArrays(a3.TRIANGLES,0,H.count);H.count=0}function a2(c){if(aC!=c.doubleSided){c.doubleSided?a3.disable(a3.CULL_FACE):a3.enable(a3.CULL_FACE),aC=c.doubleSided}if(ac!=c.flipSided){c.flipSided?a3.frontFace(a3.CW):a3.frontFace(a3.CCW),ac=c.flipSided}}function a4(c){aL!=c&&(c?a3.enable(a3.DEPTH_TEST):a3.disable(a3.DEPTH_TEST),aL=c)}function a1(f,g,h){E!=f&&(f?a3.enable(a3.POLYGON_OFFSET_FILL):a3.disable(a3.POLYGON_OFFSET_FILL),E=f);if(f&&(ae!=g||aE!=h)){a3.polygonOffset(g,h),ae=g,aE=h}}function a0(c){aI[0].set(c.n41-c.n11,c.n42-c.n12,c.n43-c.n13,c.n44-c.n14);aI[1].set(c.n41+c.n11,c.n42+c.n12,c.n43+c.n13,c.n44+c.n14);aI[2].set(c.n41+c.n21,c.n42+c.n22,c.n43+c.n23,c.n44+c.n24);aI[3].set(c.n41-c.n21,c.n42-c.n22,c.n43-c.n23,c.n44-c.n24);aI[4].set(c.n41-c.n31,c.n42-c.n32,c.n43-c.n33,c.n44-c.n34);aI[5].set(c.n41+c.n31,c.n42+c.n32,c.n43+c.n33,c.n44+c.n34);for(var f,c=0;c<6;c++){f=aI[c],f.divideScalar(Math.sqrt(f.x*f.x+f.y*f.y+f.z*f.z))}}function aZ(g){for(var j=g.matrixWorld,k=-g.geometry.boundingSphere.radius*Math.max(g.scale.x,Math.max(g.scale.y,g.scale.z)),h=0;h<6;h++){if(g=aI[h].x*j.n14+aI[h].y*j.n24+aI[h].z*j.n34+aI[h].w,g<=k){return !1}}return !0}function aY(c,f){c.list[c.count]=f;c.count+=1}function aU(h){var o,p,n=h.object,k=h.opaque,m=h.transparent;m.count=0;h=k.count=0;for(o=n.materials.length;h<o;h++){p=n.materials[h],p.transparent?aY(m,p):aY(k,p)}}function aR(z){var w,y,v,p,u=z.object,t=z.buffer,o=z.opaque,n=z.transparent;n.count=0;z=o.count=0;for(v=u.materials.length;z<v;z++){if(w=u.materials[z],w instanceof THREE.MeshFaceMaterial){w=0;for(y=t.materials.length;w<y;w++){(p=t.materials[w])&&(p.transparent?aY(n,p):aY(o,p))}}else{(p=w)&&(p.transparent?aY(n,p):aY(o,p))}}}function aT(c,f){return f.z-c.z}function aP(F){a3.enable(a3.POLYGON_OFFSET_FILL);a3.polygonOffset(0.1,1);a3.enable(a3.STENCIL_TEST);a3.enable(a3.DEPTH_TEST);a3.depthMask(!1);a3.colorMask(!1,!1,!1,!1);a3.stencilFunc(a3.ALWAYS,1,255);a3.stencilOpSeparate(a3.BACK,a3.KEEP,a3.INCR,a3.KEEP);a3.stencilOpSeparate(a3.FRONT,a3.KEEP,a3.DECR,a3.KEEP);var C,D=F.lights.length,B,A=F.lights,z=[],y,w,v,G,j,u=F.__webglShadowVolumes.length;for(C=0;C<D;C++){if(B=F.lights[C],B instanceof THREE.DirectionalLight&&B.castShadow){z[0]=-B.position.x;z[1]=-B.position.y;z[2]=-B.position.z;for(j=0;j<u;j++){B=F.__webglShadowVolumes[j].object,y=F.__webglShadowVolumes[j].buffer,w=B.materials[0],w.program||x.initMaterial(w,A,void 0,B),w=w.program,v=w.uniforms,G=w.attributes,ah!==w&&(a3.useProgram(w),ah=w,a3.uniformMatrix4fv(v.projectionMatrix,!1,V),a3.uniformMatrix4fv(v.viewMatrix,!1,aO),a3.uniform3fv(v.directionalLightDirection,z)),B.matrixWorld.flattenToArray(B._objectMatrixArray),a3.uniformMatrix4fv(v.objectMatrix,!1,B._objectMatrixArray),a3.bindBuffer(a3.ARRAY_BUFFER,y.__webglVertexBuffer),a3.vertexAttribPointer(G.position,3,a3.FLOAT,!1,0,0),a3.bindBuffer(a3.ARRAY_BUFFER,y.__webglNormalBuffer),a3.vertexAttribPointer(G.normal,3,a3.FLOAT,!1,0,0),a3.bindBuffer(a3.ELEMENT_ARRAY_BUFFER,y.__webglFaceBuffer),a3.cullFace(a3.FRONT),a3.drawElements(a3.TRIANGLES,y.__webglFaceCount,a3.UNSIGNED_SHORT,0),a3.cullFace(a3.BACK),a3.drawElements(a3.TRIANGLES,y.__webglFaceCount,a3.UNSIGNED_SHORT,0)}}}a3.disable(a3.POLYGON_OFFSET_FILL);a3.colorMask(!0,!0,!0,!0);a3.stencilFunc(a3.NOTEQUAL,0,255);a3.stencilOp(a3.KEEP,a3.KEEP,a3.KEEP);a3.disable(a3.DEPTH_TEST);aB=-1;ah=ak.program;a3.useProgram(ak.program);a3.uniformMatrix4fv(ak.projectionLocation,!1,V);a3.uniform1f(ak.darknessLocation,ak.darkness);a3.bindBuffer(a3.ARRAY_BUFFER,ak.vertexBuffer);a3.vertexAttribPointer(ak.vertexLocation,3,a3.FLOAT,!1,0,0);a3.enableVertexAttribArray(ak.vertexLocation);a3.blendFunc(a3.ONE,a3.ONE_MINUS_SRC_ALPHA);a3.blendEquation(a3.FUNC_ADD);a3.bindBuffer(a3.ELEMENT_ARRAY_BUFFER,ak.elementBuffer);a3.drawElements(a3.TRIANGLES,6,a3.UNSIGNED_SHORT,0);a3.disable(a3.STENCIL_TEST);a3.enable(a3.DEPTH_TEST);a3.depthMask(ao)}function az(F,C){var D,B,A;D=am.attributes;var z=am.uniforms,y=ag/ad,w,v=[],G=ad*0.5,j=ag*0.5,u=!0;a3.useProgram(am.program);ah=am.program;aB=-1;aF||(a3.enableVertexAttribArray(am.attributes.position),a3.enableVertexAttribArray(am.attributes.uv),aF=!0);a3.disable(a3.CULL_FACE);a3.enable(a3.BLEND);a3.depthMask(!0);a3.bindBuffer(a3.ARRAY_BUFFER,am.vertexBuffer);a3.vertexAttribPointer(D.position,2,a3.FLOAT,!1,16,0);a3.vertexAttribPointer(D.uv,2,a3.FLOAT,!1,16,8);a3.bindBuffer(a3.ELEMENT_ARRAY_BUFFER,am.elementBuffer);a3.uniformMatrix4fv(z.projectionMatrix,!1,V);a3.activeTexture(a3.TEXTURE0);a3.uniform1i(z.map,0);D=0;for(B=F.__webglSprites.length;D<B;D++){A=F.__webglSprites[D],A.useScreenCoordinates?A.z=-A.position.z:(A._modelViewMatrix.multiplyToArray(C.matrixWorldInverse,A.matrixWorld,A._modelViewMatrixArray),A.z=-A._modelViewMatrix.n34)}F.__webglSprites.sort(aT);D=0;for(B=F.__webglSprites.length;D<B;D++){A=F.__webglSprites[D],A.material===void 0&&A.map&&A.map.image&&A.map.image.width&&(A.useScreenCoordinates?(a3.uniform1i(z.useScreenCoordinates,1),a3.uniform3f(z.screenPosition,(A.position.x-G)/G,(j-A.position.y)/j,Math.max(0,Math.min(1,A.position.z)))):(a3.uniform1i(z.useScreenCoordinates,0),a3.uniform1i(z.affectedByDistance,A.affectedByDistance?1:0),a3.uniformMatrix4fv(z.modelViewMatrix,!1,A._modelViewMatrixArray)),w=A.map.image.width/(A.scaleByViewport?ag:1),v[0]=w*y*A.scale.x,v[1]=w*A.scale.y,a3.uniform2f(z.uvScale,A.uvScale.x,A.uvScale.y),a3.uniform2f(z.uvOffset,A.uvOffset.x,A.uvOffset.y),a3.uniform2f(z.alignment,A.alignment.x,A.alignment.y),a3.uniform1f(z.opacity,A.opacity),a3.uniform1f(z.rotation,A.rotation),a3.uniform2fv(z.scale,v),A.mergeWith3D&&!u?(a3.enable(a3.DEPTH_TEST),u=!0):!A.mergeWith3D&&u&&(a3.disable(a3.DEPTH_TEST),u=!1),ax(A.blending),ar(A.map,0),a3.drawElements(a3.TRIANGLES,6,a3.UNSIGNED_SHORT,0))}a3.enable(a3.CULL_FACE);a3.enable(a3.DEPTH_TEST);a3.depthMask(ao)}function aA(N,J){var K,I,H=N.__webglLensFlares.length,G,F,D,C=new THREE.Vector3,R=ag/ad,j=ad*0.5,B=ag*0.5,Q=16/ag,P=[Q*R,Q],O=[1,1,0],L=[1,1],z=an.uniforms;K=an.attributes;a3.useProgram(an.program);ah=an.program;aB=-1;aQ||(a3.enableVertexAttribArray(an.attributes.vertex),a3.enableVertexAttribArray(an.attributes.uv),aQ=!0);a3.uniform1i(z.occlusionMap,0);a3.uniform1i(z.map,1);a3.bindBuffer(a3.ARRAY_BUFFER,an.vertexBuffer);a3.vertexAttribPointer(K.vertex,2,a3.FLOAT,!1,16,0);a3.vertexAttribPointer(K.uv,2,a3.FLOAT,!1,16,8);a3.bindBuffer(a3.ELEMENT_ARRAY_BUFFER,an.elementBuffer);a3.disable(a3.CULL_FACE);a3.depthMask(!1);a3.activeTexture(a3.TEXTURE0);a3.bindTexture(a3.TEXTURE_2D,an.occlusionTexture);a3.activeTexture(a3.TEXTURE1);for(I=0;I<H;I++){if(K=N.__webglLensFlares[I].object,C.set(K.matrixWorld.n14,K.matrixWorld.n24,K.matrixWorld.n34),J.matrixWorldInverse.multiplyVector3(C),J.projectionMatrix.multiplyVector3(C),O[0]=C.x,O[1]=C.y,O[2]=C.z,L[0]=O[0]*j+j,L[1]=O[1]*B+B,an.hasVertexTexture||L[0]>0&&L[0]<ad&&L[1]>0&&L[1]<ag){a3.bindTexture(a3.TEXTURE_2D,an.tempTexture);a3.copyTexImage2D(a3.TEXTURE_2D,0,a3.RGB,L[0]-8,L[1]-8,16,16,0);a3.uniform1i(z.renderType,0);a3.uniform2fv(z.scale,P);a3.uniform3fv(z.screenPosition,O);a3.disable(a3.BLEND);a3.enable(a3.DEPTH_TEST);a3.drawElements(a3.TRIANGLES,6,a3.UNSIGNED_SHORT,0);a3.bindTexture(a3.TEXTURE_2D,an.occlusionTexture);a3.copyTexImage2D(a3.TEXTURE_2D,0,a3.RGBA,L[0]-8,L[1]-8,16,16,0);a3.uniform1i(z.renderType,1);a3.disable(a3.DEPTH_TEST);a3.bindTexture(a3.TEXTURE_2D,an.tempTexture);a3.drawElements(a3.TRIANGLES,6,a3.UNSIGNED_SHORT,0);K.positionScreen.x=O[0];K.positionScreen.y=O[1];K.positionScreen.z=O[2];K.customUpdateCallback?K.customUpdateCallback(K):K.updateLensFlares();a3.uniform1i(z.renderType,2);a3.enable(a3.BLEND);G=0;for(F=K.lensFlares.length;G<F;G++){if(D=K.lensFlares[G],D.opacity>0.001&&D.scale>0.001){O[0]=D.x,O[1]=D.y,O[2]=D.z,Q=D.size*D.scale/ag,P[0]=Q*R,P[1]=Q,a3.uniform3fv(z.screenPosition,O),a3.uniform2fv(z.scale,P),a3.uniform1f(z.rotation,D.rotation),a3.uniform1f(z.opacity,D.opacity),ax(D.blending),ar(D.texture,1),a3.drawElements(a3.TRIANGLES,6,a3.UNSIGNED_SHORT,0)}}}}a3.enable(a3.CULL_FACE);a3.enable(a3.DEPTH_TEST);a3.depthMask(ao)}function aN(c,f){c._modelViewMatrix.multiplyToArray(f.matrixWorldInverse,c.matrixWorld,c._modelViewMatrixArray);THREE.Matrix4.makeInvert3x3(c._modelViewMatrix).transposeIntoArray(c._normalMatrixArray)}function av(bG){var bE,bD,bC,bA;if(bG instanceof THREE.Mesh){bD=bG.geometry;for(bE in bD.geometryGroups){bC=bD.geometryGroups[bE];a:{for(var by=bA=void 0,bx=void 0,bv=void 0,bs=void 0,bs=bC.__materials,by=0,bx=bs.length;by<bx;by++){if(bv=bs[by],bv.attributes){for(bA in bv.attributes){if(bv.attributes[bA].needsUpdate){bA=!0;break a}}}}bA=!1}if(bD.__dirtyVertices||bD.__dirtyMorphTargets||bD.__dirtyElements||bD.__dirtyUvs||bD.__dirtyNormals||bD.__dirtyColors||bD.__dirtyTangents||bA){if(bA=bC,by=bG,bx=a3.DYNAMIC_DRAW,bA.__inittedArrays){var bt=bs=bv=void 0,bu=void 0,br=bt=void 0,bq=void 0,bp=void 0,bn=void 0,cb=void 0,b9=void 0,bl=void 0,b1=void 0,b2=void 0,b7=void 0,bJ=void 0,b8=void 0,bc=void 0,b4=bu=bn=bu=bp=bq=void 0,b3=void 0,bo=b3=b4=bq=void 0,bW=void 0,bX=bo=b3=b4=bt=bt=br=bn=bu=bo=b3=b4=bW=bo=b3=b4=bW=bo=b3=b4=void 0,b0=0,bV=0,bT=0,bR=0,cm=0,bS=0,ce=0,cd=0,bQ=0,bU=0,bP=0,b3=b4=0,bO=bA.__vertexArray,bw=bA.__uvArray,bb=bA.__uv2Array,bh=bA.__normalArray,bN=bA.__tangentArray,bI=bA.__colorArray,bM=bA.__skinVertexAArray,bL=bA.__skinVertexBArray,bK=bA.__skinIndexArray,cg=bA.__skinWeightArray,bB=bA.__morphTargetsArrays,bz=bA.__webglCustomAttributes,bo=void 0,ck=bA.__faceArray,bY=bA.__lineArray,b5=bA.__needsSmoothNormals,b9=bA.__vertexColorType,cb=bA.__uvType,bl=bA.__normalType,bi=by.geometry,bH=bi.__dirtyVertices,cc=bi.__dirtyElements,bF=bi.__dirtyUvs,be=bi.__dirtyNormals,cl=bi.__dirtyTangents,bk=bi.__dirtyColors,ci=bi.__dirtyMorphTargets,c=bi.vertices,cf=bA.faces,cj=bi.faces,bg=bi.faceVertexUvs[0],j=bi.faceVertexUvs[1],bj=bi.skinVerticesA,bf=bi.skinVerticesB,cn=bi.skinIndices,bd=bi.skinWeights,b6=by instanceof THREE.ShadowVolume?bi.edgeFaces:void 0,bZ=bi.morphTargets;if(bz){for(bX in bz){bz[bX].offset=0,bz[bX].offsetSrc=0}}bv=0;for(bs=cf.length;bv<bs;bv++){if(bt=cf[bv],bu=cj[bt],bg&&(b1=bg[bt]),j&&(b2=j[bt]),bt=bu.vertexNormals,br=bu.normal,bq=bu.vertexColors,bp=bu.color,bn=bu.vertexTangents,bu instanceof THREE.Face3){if(bH){b7=c[bu.a].position,bJ=c[bu.b].position,b8=c[bu.c].position,bO[bV]=b7.x,bO[bV+1]=b7.y,bO[bV+2]=b7.z,bO[bV+3]=bJ.x,bO[bV+4]=bJ.y,bO[bV+5]=bJ.z,bO[bV+6]=b8.x,bO[bV+7]=b8.y,bO[bV+8]=b8.z,bV+=9}if(bz){for(bX in bz){if(bo=bz[bX],bo.__original.needsUpdate){b4=bo.offset,b3=bo.offsetSrc,bo.size===1?(bo.boundTo===void 0||bo.boundTo==="vertices"?(bo.array[b4+0]=bo.value[bu.a],bo.array[b4+1]=bo.value[bu.b],bo.array[b4+2]=bo.value[bu.c]):bo.boundTo==="faces"?(bo.array[b4+0]=bo.value[b3],bo.array[b4+1]=bo.value[b3],bo.array[b4+2]=bo.value[b3],bo.offsetSrc++):bo.boundTo==="faceVertices"&&(bo.array[b4+0]=bo.value[b3+0],bo.array[b4+1]=bo.value[b3+1],bo.array[b4+2]=bo.value[b3+2],bo.offsetSrc+=3),bo.offset+=3):(bo.boundTo===void 0||bo.boundTo==="vertices"?(b7=bo.value[bu.a],bJ=bo.value[bu.b],b8=bo.value[bu.c]):bo.boundTo==="faces"?(b7=bo.value[b3],bJ=bo.value[b3],b8=bo.value[b3],bo.offsetSrc++):bo.boundTo==="faceVertices"&&(b7=bo.value[b3+0],bJ=bo.value[b3+1],b8=bo.value[b3+2],bo.offsetSrc+=3),bo.size===2?(bo.array[b4+0]=b7.x,bo.array[b4+1]=b7.y,bo.array[b4+2]=bJ.x,bo.array[b4+3]=bJ.y,bo.array[b4+4]=b8.x,bo.array[b4+5]=b8.y,bo.offset+=6):bo.size===3?(bo.type==="c"?(bo.array[b4+0]=b7.r,bo.array[b4+1]=b7.g,bo.array[b4+2]=b7.b,bo.array[b4+3]=bJ.r,bo.array[b4+4]=bJ.g,bo.array[b4+5]=bJ.b,bo.array[b4+6]=b8.r,bo.array[b4+7]=b8.g,bo.array[b4+8]=b8.b):(bo.array[b4+0]=b7.x,bo.array[b4+1]=b7.y,bo.array[b4+2]=b7.z,bo.array[b4+3]=bJ.x,bo.array[b4+4]=bJ.y,bo.array[b4+5]=bJ.z,bo.array[b4+6]=b8.x,bo.array[b4+7]=b8.y,bo.array[b4+8]=b8.z),bo.offset+=9):(bo.array[b4+0]=b7.x,bo.array[b4+1]=b7.y,bo.array[b4+2]=b7.z,bo.array[b4+3]=b7.w,bo.array[b4+4]=bJ.x,bo.array[b4+5]=bJ.y,bo.array[b4+6]=bJ.z,bo.array[b4+7]=bJ.w,bo.array[b4+8]=b8.x,bo.array[b4+9]=b8.y,bo.array[b4+10]=b8.z,bo.array[b4+11]=b8.w,bo.offset+=12))}}}if(ci){b4=0;for(b3=bZ.length;b4<b3;b4++){b7=bZ[b4].vertices[bu.a].position,bJ=bZ[b4].vertices[bu.b].position,b8=bZ[b4].vertices[bu.c].position,bo=bB[b4],bo[bP+0]=b7.x,bo[bP+1]=b7.y,bo[bP+2]=b7.z,bo[bP+3]=bJ.x,bo[bP+4]=bJ.y,bo[bP+5]=bJ.z,bo[bP+6]=b8.x,bo[bP+7]=b8.y,bo[bP+8]=b8.z}bP+=9}if(bd.length){b4=bd[bu.a],b3=bd[bu.b],bo=bd[bu.c],cg[bU]=b4.x,cg[bU+1]=b4.y,cg[bU+2]=b4.z,cg[bU+3]=b4.w,cg[bU+4]=b3.x,cg[bU+5]=b3.y,cg[bU+6]=b3.z,cg[bU+7]=b3.w,cg[bU+8]=bo.x,cg[bU+9]=bo.y,cg[bU+10]=bo.z,cg[bU+11]=bo.w,b4=cn[bu.a],b3=cn[bu.b],bo=cn[bu.c],bK[bU]=b4.x,bK[bU+1]=b4.y,bK[bU+2]=b4.z,bK[bU+3]=b4.w,bK[bU+4]=b3.x,bK[bU+5]=b3.y,bK[bU+6]=b3.z,bK[bU+7]=b3.w,bK[bU+8]=bo.x,bK[bU+9]=bo.y,bK[bU+10]=bo.z,bK[bU+11]=bo.w,b4=bj[bu.a],b3=bj[bu.b],bo=bj[bu.c],bM[bU]=b4.x,bM[bU+1]=b4.y,bM[bU+2]=b4.z,bM[bU+3]=1,bM[bU+4]=b3.x,bM[bU+5]=b3.y,bM[bU+6]=b3.z,bM[bU+7]=1,bM[bU+8]=bo.x,bM[bU+9]=bo.y,bM[bU+10]=bo.z,bM[bU+11]=1,b4=bf[bu.a],b3=bf[bu.b],bo=bf[bu.c],bL[bU]=b4.x,bL[bU+1]=b4.y,bL[bU+2]=b4.z,bL[bU+3]=1,bL[bU+4]=b3.x,bL[bU+5]=b3.y,bL[bU+6]=b3.z,bL[bU+7]=1,bL[bU+8]=bo.x,bL[bU+9]=bo.y,bL[bU+10]=bo.z,bL[bU+11]=1,bU+=12}if(bk&&b9){bq.length==3&&b9==THREE.VertexColors?(bu=bq[0],b4=bq[1],b3=bq[2]):b3=b4=bu=bp,bI[bQ]=bu.r,bI[bQ+1]=bu.g,bI[bQ+2]=bu.b,bI[bQ+3]=b4.r,bI[bQ+4]=b4.g,bI[bQ+5]=b4.b,bI[bQ+6]=b3.r,bI[bQ+7]=b3.g,bI[bQ+8]=b3.b,bQ+=9}if(cl&&bi.hasTangents){bq=bn[0],bp=bn[1],bu=bn[2],bN[ce]=bq.x,bN[ce+1]=bq.y,bN[ce+2]=bq.z,bN[ce+3]=bq.w,bN[ce+4]=bp.x,bN[ce+5]=bp.y,bN[ce+6]=bp.z,bN[ce+7]=bp.w,bN[ce+8]=bu.x,bN[ce+9]=bu.y,bN[ce+10]=bu.z,bN[ce+11]=bu.w,ce+=12}if(be&&bl){if(bt.length==3&&b5){for(bn=0;bn<3;bn++){br=bt[bn],bh[bS]=br.x,bh[bS+1]=br.y,bh[bS+2]=br.z,bS+=3}}else{for(bn=0;bn<3;bn++){bh[bS]=br.x,bh[bS+1]=br.y,bh[bS+2]=br.z,bS+=3}}}if(bF&&b1!==void 0&&cb){for(bn=0;bn<3;bn++){bt=b1[bn],bw[bT]=bt.u,bw[bT+1]=bt.v,bT+=2}}if(bF&&b2!==void 0&&cb){for(bn=0;bn<3;bn++){bt=b2[bn],bb[bR]=bt.u,bb[bR+1]=bt.v,bR+=2}}cc&&(ck[cm]=b0,ck[cm+1]=b0+1,ck[cm+2]=b0+2,cm+=3,bY[cd]=b0,bY[cd+1]=b0+1,bY[cd+2]=b0,bY[cd+3]=b0+2,bY[cd+4]=b0+1,bY[cd+5]=b0+2,cd+=6,b0+=3)}else{if(bu instanceof THREE.Face4){if(bH){b7=c[bu.a].position,bJ=c[bu.b].position,b8=c[bu.c].position,bc=c[bu.d].position,bO[bV]=b7.x,bO[bV+1]=b7.y,bO[bV+2]=b7.z,bO[bV+3]=bJ.x,bO[bV+4]=bJ.y,bO[bV+5]=bJ.z,bO[bV+6]=b8.x,bO[bV+7]=b8.y,bO[bV+8]=b8.z,bO[bV+9]=bc.x,bO[bV+10]=bc.y,bO[bV+11]=bc.z,bV+=12}if(bz){for(bX in bz){if(bo=bz[bX],bo.__original.needsUpdate){b4=bo.offset,b3=bo.offsetSrc,bo.size===1?(bo.boundTo===void 0||bo.boundTo==="vertices"?(bo.array[b4+0]=bo.value[bu.a],bo.array[b4+1]=bo.value[bu.b],bo.array[b4+2]=bo.value[bu.c],bo.array[b4+3]=bo.value[bu.d]):bo.boundTo==="faces"?(bo.array[b4+0]=bo.value[b3],bo.array[b4+1]=bo.value[b3],bo.array[b4+2]=bo.value[b3],bo.array[b4+3]=bo.value[b3],bo.offsetSrc++):bo.boundTo==="faceVertices"&&(bo.array[b4+0]=bo.value[b3+0],bo.array[b4+1]=bo.value[b3+1],bo.array[b4+2]=bo.value[b3+2],bo.array[b4+3]=bo.value[b3+3],bo.offsetSrc+=4),bo.offset+=4):(bo.boundTo===void 0||bo.boundTo==="vertices"?(b7=bo.value[bu.a],bJ=bo.value[bu.b],b8=bo.value[bu.c],bc=bo.value[bu.d]):bo.boundTo==="faces"?(b7=bo.value[b3],bJ=bo.value[b3],b8=bo.value[b3],bc=bo.value[b3],bo.offsetSrc++):bo.boundTo==="faceVertices"&&(b7=bo.value[b3+0],bJ=bo.value[b3+1],b8=bo.value[b3+2],bc=bo.value[b3+3],bo.offsetSrc+=4),bo.size===2?(bo.array[b4+0]=b7.x,bo.array[b4+1]=b7.y,bo.array[b4+2]=bJ.x,bo.array[b4+3]=bJ.y,bo.array[b4+4]=b8.x,bo.array[b4+5]=b8.y,bo.array[b4+6]=bc.x,bo.array[b4+7]=bc.y,bo.offset+=8):bo.size===3?(bo.type==="c"?(bo.array[b4+0]=b7.r,bo.array[b4+1]=b7.g,bo.array[b4+2]=b7.b,bo.array[b4+3]=bJ.r,bo.array[b4+4]=bJ.g,bo.array[b4+5]=bJ.b,bo.array[b4+6]=b8.r,bo.array[b4+7]=b8.g,bo.array[b4+8]=b8.b,bo.array[b4+9]=bc.r,bo.array[b4+10]=bc.g,bo.array[b4+11]=bc.b):(bo.array[b4+0]=b7.x,bo.array[b4+1]=b7.y,bo.array[b4+2]=b7.z,bo.array[b4+3]=bJ.x,bo.array[b4+4]=bJ.y,bo.array[b4+5]=bJ.z,bo.array[b4+6]=b8.x,bo.array[b4+7]=b8.y,bo.array[b4+8]=b8.z,bo.array[b4+9]=bc.x,bo.array[b4+10]=bc.y,bo.array[b4+11]=bc.z),bo.offset+=12):(bo.array[b4+0]=b7.x,bo.array[b4+1]=b7.y,bo.array[b4+2]=b7.z,bo.array[b4+3]=b7.w,bo.array[b4+4]=bJ.x,bo.array[b4+5]=bJ.y,bo.array[b4+6]=bJ.z,bo.array[b4+7]=bJ.w,bo.array[b4+8]=b8.x,bo.array[b4+9]=b8.y,bo.array[b4+10]=b8.z,bo.array[b4+11]=b8.w,bo.array[b4+12]=bc.x,bo.array[b4+13]=bc.y,bo.array[b4+14]=bc.z,bo.array[b4+15]=bc.w,bo.offset+=16))}}}if(ci){b4=0;for(b3=bZ.length;b4<b3;b4++){b7=bZ[b4].vertices[bu.a].position,bJ=bZ[b4].vertices[bu.b].position,b8=bZ[b4].vertices[bu.c].position,bc=bZ[b4].vertices[bu.d].position,bo=bB[b4],bo[bP+0]=b7.x,bo[bP+1]=b7.y,bo[bP+2]=b7.z,bo[bP+3]=bJ.x,bo[bP+4]=bJ.y,bo[bP+5]=bJ.z,bo[bP+6]=b8.x,bo[bP+7]=b8.y,bo[bP+8]=b8.z,bo[bP+9]=bc.x,bo[bP+10]=bc.y,bo[bP+11]=bc.z}bP+=12}if(bd.length){b4=bd[bu.a],b3=bd[bu.b],bo=bd[bu.c],bW=bd[bu.d],cg[bU]=b4.x,cg[bU+1]=b4.y,cg[bU+2]=b4.z,cg[bU+3]=b4.w,cg[bU+4]=b3.x,cg[bU+5]=b3.y,cg[bU+6]=b3.z,cg[bU+7]=b3.w,cg[bU+8]=bo.x,cg[bU+9]=bo.y,cg[bU+10]=bo.z,cg[bU+11]=bo.w,cg[bU+12]=bW.x,cg[bU+13]=bW.y,cg[bU+14]=bW.z,cg[bU+15]=bW.w,b4=cn[bu.a],b3=cn[bu.b],bo=cn[bu.c],bW=cn[bu.d],bK[bU]=b4.x,bK[bU+1]=b4.y,bK[bU+2]=b4.z,bK[bU+3]=b4.w,bK[bU+4]=b3.x,bK[bU+5]=b3.y,bK[bU+6]=b3.z,bK[bU+7]=b3.w,bK[bU+8]=bo.x,bK[bU+9]=bo.y,bK[bU+10]=bo.z,bK[bU+11]=bo.w,bK[bU+12]=bW.x,bK[bU+13]=bW.y,bK[bU+14]=bW.z,bK[bU+15]=bW.w,b4=bj[bu.a],b3=bj[bu.b],bo=bj[bu.c],bW=bj[bu.d],bM[bU]=b4.x,bM[bU+1]=b4.y,bM[bU+2]=b4.z,bM[bU+3]=1,bM[bU+4]=b3.x,bM[bU+5]=b3.y,bM[bU+6]=b3.z,bM[bU+7]=1,bM[bU+8]=bo.x,bM[bU+9]=bo.y,bM[bU+10]=bo.z,bM[bU+11]=1,bM[bU+12]=bW.x,bM[bU+13]=bW.y,bM[bU+14]=bW.z,bM[bU+15]=1,b4=bf[bu.a],b3=bf[bu.b],bo=bf[bu.c],bu=bf[bu.d],bL[bU]=b4.x,bL[bU+1]=b4.y,bL[bU+2]=b4.z,bL[bU+3]=1,bL[bU+4]=b3.x,bL[bU+5]=b3.y,bL[bU+6]=b3.z,bL[bU+7]=1,bL[bU+8]=bo.x,bL[bU+9]=bo.y,bL[bU+10]=bo.z,bL[bU+11]=1,bL[bU+12]=bu.x,bL[bU+13]=bu.y,bL[bU+14]=bu.z,bL[bU+15]=1,bU+=16}if(bk&&b9){bq.length==4&&b9==THREE.VertexColors?(bu=bq[0],b4=bq[1],b3=bq[2],bq=bq[3]):bq=b3=b4=bu=bp,bI[bQ]=bu.r,bI[bQ+1]=bu.g,bI[bQ+2]=bu.b,bI[bQ+3]=b4.r,bI[bQ+4]=b4.g,bI[bQ+5]=b4.b,bI[bQ+6]=b3.r,bI[bQ+7]=b3.g,bI[bQ+8]=b3.b,bI[bQ+9]=bq.r,bI[bQ+10]=bq.g,bI[bQ+11]=bq.b,bQ+=12}if(cl&&bi.hasTangents){bq=bn[0],bp=bn[1],bu=bn[2],bn=bn[3],bN[ce]=bq.x,bN[ce+1]=bq.y,bN[ce+2]=bq.z,bN[ce+3]=bq.w,bN[ce+4]=bp.x,bN[ce+5]=bp.y,bN[ce+6]=bp.z,bN[ce+7]=bp.w,bN[ce+8]=bu.x,bN[ce+9]=bu.y,bN[ce+10]=bu.z,bN[ce+11]=bu.w,bN[ce+12]=bn.x,bN[ce+13]=bn.y,bN[ce+14]=bn.z,bN[ce+15]=bn.w,ce+=16}if(be&&bl){if(bt.length==4&&b5){for(bn=0;bn<4;bn++){br=bt[bn],bh[bS]=br.x,bh[bS+1]=br.y,bh[bS+2]=br.z,bS+=3}}else{for(bn=0;bn<4;bn++){bh[bS]=br.x,bh[bS+1]=br.y,bh[bS+2]=br.z,bS+=3}}}if(bF&&b1!==void 0&&cb){for(bn=0;bn<4;bn++){bt=b1[bn],bw[bT]=bt.u,bw[bT+1]=bt.v,bT+=2}}if(bF&&b2!==void 0&&cb){for(bn=0;bn<4;bn++){bt=b2[bn],bb[bR]=bt.u,bb[bR+1]=bt.v,bR+=2}}cc&&(ck[cm]=b0,ck[cm+1]=b0+1,ck[cm+2]=b0+3,ck[cm+3]=b0+1,ck[cm+4]=b0+2,ck[cm+5]=b0+3,cm+=6,bY[cd]=b0,bY[cd+1]=b0+1,bY[cd+2]=b0,bY[cd+3]=b0+3,bY[cd+4]=b0+1,bY[cd+5]=b0+2,bY[cd+6]=b0+2,bY[cd+7]=b0+3,cd+=8,b0+=4)}}}if(b6){bv=0;for(bs=b6.length;bv<bs;bv++){ck[cm]=b6[bv].a,ck[cm+1]=b6[bv].b,ck[cm+2]=b6[bv].c,ck[cm+3]=b6[bv].a,ck[cm+4]=b6[bv].c,ck[cm+5]=b6[bv].d,cm+=6}}bH&&(a3.bindBuffer(a3.ARRAY_BUFFER,bA.__webglVertexBuffer),a3.bufferData(a3.ARRAY_BUFFER,bO,bx));if(bz){for(bX in bz){bo=bz[bX],bo.__original.needsUpdate&&(a3.bindBuffer(a3.ARRAY_BUFFER,bo.buffer),a3.bufferData(a3.ARRAY_BUFFER,bo.array,bx))}}if(ci){b4=0;for(b3=bZ.length;b4<b3;b4++){a3.bindBuffer(a3.ARRAY_BUFFER,bA.__webglMorphTargetsBuffers[b4]),a3.bufferData(a3.ARRAY_BUFFER,bB[b4],bx)}}bk&&bQ>0&&(a3.bindBuffer(a3.ARRAY_BUFFER,bA.__webglColorBuffer),a3.bufferData(a3.ARRAY_BUFFER,bI,bx));be&&(a3.bindBuffer(a3.ARRAY_BUFFER,bA.__webglNormalBuffer),a3.bufferData(a3.ARRAY_BUFFER,bh,bx));cl&&bi.hasTangents&&(a3.bindBuffer(a3.ARRAY_BUFFER,bA.__webglTangentBuffer),a3.bufferData(a3.ARRAY_BUFFER,bN,bx));bF&&bT>0&&(a3.bindBuffer(a3.ARRAY_BUFFER,bA.__webglUVBuffer),a3.bufferData(a3.ARRAY_BUFFER,bw,bx));bF&&bR>0&&(a3.bindBuffer(a3.ARRAY_BUFFER,bA.__webglUV2Buffer),a3.bufferData(a3.ARRAY_BUFFER,bb,bx));cc&&(a3.bindBuffer(a3.ELEMENT_ARRAY_BUFFER,bA.__webglFaceBuffer),a3.bufferData(a3.ELEMENT_ARRAY_BUFFER,ck,bx),a3.bindBuffer(a3.ELEMENT_ARRAY_BUFFER,bA.__webglLineBuffer),a3.bufferData(a3.ELEMENT_ARRAY_BUFFER,bY,bx));bU>0&&(a3.bindBuffer(a3.ARRAY_BUFFER,bA.__webglSkinVertexABuffer),a3.bufferData(a3.ARRAY_BUFFER,bM,bx),a3.bindBuffer(a3.ARRAY_BUFFER,bA.__webglSkinVertexBBuffer),a3.bufferData(a3.ARRAY_BUFFER,bL,bx),a3.bindBuffer(a3.ARRAY_BUFFER,bA.__webglSkinIndicesBuffer),a3.bufferData(a3.ARRAY_BUFFER,bK,bx),a3.bindBuffer(a3.ARRAY_BUFFER,bA.__webglSkinWeightsBuffer),a3.bufferData(a3.ARRAY_BUFFER,cg,bx));by.dynamic||(delete bA.__inittedArrays,delete bA.__colorArray,delete bA.__normalArray,delete bA.__tangentArray,delete bA.__uvArray,delete bA.__uv2Array,delete bA.__faceArray,delete bA.__vertexArray,delete bA.__lineArray,delete bA.__skinVertexAArray,delete bA.__skinVertexBArray,delete bA.__skinIndexArray,delete bA.__skinWeightArray)}}}bD.__dirtyVertices=!1;bD.__dirtyMorphTargets=!1;bD.__dirtyElements=!1;bD.__dirtyUvs=!1;bD.__dirtyNormals=!1;bD.__dirtyTangents=!1;bD.__dirtyColors=!1;var ch;bC=bC.__materials;bD=0;for(bG=bC.length;bD<bG;bD++){if(bE=bC[bD],bE.attributes){for(ch in bE.attributes){bE.attributes[ch].needsUpdate=!1}}}}else{if(bG instanceof THREE.Ribbon){bD=bG.geometry;if(bD.__dirtyVertices||bD.__dirtyColors){ch=bD;bG=a3.DYNAMIC_DRAW;bs=ch.vertices;bC=ch.colors;cb=bs.length;bA=bC.length;b9=ch.__vertexArray;by=ch.__colorArray;bl=ch.__dirtyColors;if(ch.__dirtyVertices){for(bx=0;bx<cb;bx++){bv=bs[bx].position,bE=bx*3,b9[bE]=bv.x,b9[bE+1]=bv.y,b9[bE+2]=bv.z}a3.bindBuffer(a3.ARRAY_BUFFER,ch.__webglVertexBuffer);a3.bufferData(a3.ARRAY_BUFFER,b9,bG)}if(bl){for(bx=0;bx<bA;bx++){color=bC[bx],bE=bx*3,by[bE]=color.r,by[bE+1]=color.g,by[bE+2]=color.b}a3.bindBuffer(a3.ARRAY_BUFFER,ch.__webglColorBuffer);a3.bufferData(a3.ARRAY_BUFFER,by,bG)}}bD.__dirtyVertices=!1;bD.__dirtyColors=!1}else{if(bG instanceof THREE.Line){bD=bG.geometry;if(bD.__dirtyVertices||bD.__dirtyColors){ch=bD;bG=a3.DYNAMIC_DRAW;bs=ch.vertices;bC=ch.colors;cb=bs.length;bA=bC.length;b9=ch.__vertexArray;by=ch.__colorArray;bl=ch.__dirtyColors;if(ch.__dirtyVertices){for(bx=0;bx<cb;bx++){bv=bs[bx].position,bE=bx*3,b9[bE]=bv.x,b9[bE+1]=bv.y,b9[bE+2]=bv.z}a3.bindBuffer(a3.ARRAY_BUFFER,ch.__webglVertexBuffer);a3.bufferData(a3.ARRAY_BUFFER,b9,bG)}if(bl){for(bx=0;bx<bA;bx++){color=bC[bx],bE=bx*3,by[bE]=color.r,by[bE+1]=color.g,by[bE+2]=color.b}a3.bindBuffer(a3.ARRAY_BUFFER,ch.__webglColorBuffer);a3.bufferData(a3.ARRAY_BUFFER,by,bG)}}bD.__dirtyVertices=!1;bD.__dirtyColors=!1}else{if(bG instanceof THREE.ParticleSystem){bD=bG.geometry,(bD.__dirtyVertices||bD.__dirtyColors||bG.sortParticles)&&a8(bD,a3.DYNAMIC_DRAW,bG),bD.__dirtyVertices=!1,bD.__dirtyColors=!1}}}}}function aM(f,g){var h;for(h=f.length-1;h>=0;h--){f[h].object==g&&f.splice(h,1)}}function ay(F){function C(c){var e=[];D=0;for(B=c.length;D<B;D++){c[D]==void 0?e.push("undefined"):e.push(c[D].id)}return e.join("_")}var D,B,A,z,y,w,v,p,u={},G=F.morphTargets!==void 0?F.morphTargets.length:0;F.geometryGroups={};A=0;for(z=F.faces.length;A<z;A++){y=F.faces[A],w=y.materials,v=C(w),u[v]==void 0&&(u[v]={hash:v,counter:0}),p=u[v].hash+"_"+u[v].counter,F.geometryGroups[p]==void 0&&(F.geometryGroups[p]={faces:[],materials:w,vertices:0,numMorphTargets:G}),y=y instanceof THREE.Face3?3:4,F.geometryGroups[p].vertices+y>65535&&(u[v].counter+=1,p=u[v].hash+"_"+u[v].counter,F.geometryGroups[p]==void 0&&(F.geometryGroups[p]={faces:[],materials:w,vertices:0,numMorphTargets:G})),F.geometryGroups[p].faces.push(A),F.geometryGroups[p].vertices+=y}}function au(f,g,h){f.push({buffer:g,object:h,opaque:{list:[],count:0},transparent:{list:[],count:0}})}function ax(c){if(c!=aB){switch(c){case THREE.AdditiveBlending:a3.blendEquation(a3.FUNC_ADD);a3.blendFunc(a3.SRC_ALPHA,a3.ONE);break;case THREE.SubtractiveBlending:a3.blendEquation(a3.FUNC_ADD);a3.blendFunc(a3.ZERO,a3.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:a3.blendEquation(a3.FUNC_ADD);a3.blendFunc(a3.ZERO,a3.SRC_COLOR);break;default:a3.blendEquationSeparate(a3.FUNC_ADD,a3.FUNC_ADD),a3.blendFuncSeparate(a3.SRC_ALPHA,a3.ONE_MINUS_SRC_ALPHA,a3.ONE,a3.ONE_MINUS_SRC_ALPHA)}aB=c}}function al(f,g,h){(h.width&h.width-1)==0&&(h.height&h.height-1)==0?(a3.texParameteri(f,a3.TEXTURE_WRAP_S,aq(g.wrapS)),a3.texParameteri(f,a3.TEXTURE_WRAP_T,aq(g.wrapT)),a3.texParameteri(f,a3.TEXTURE_MAG_FILTER,aq(g.magFilter)),a3.texParameteri(f,a3.TEXTURE_MIN_FILTER,aq(g.minFilter)),a3.generateMipmap(f)):(a3.texParameteri(f,a3.TEXTURE_WRAP_S,a3.CLAMP_TO_EDGE),a3.texParameteri(f,a3.TEXTURE_WRAP_T,a3.CLAMP_TO_EDGE),a3.texParameteri(f,a3.TEXTURE_MAG_FILTER,aj(g.magFilter)),a3.texParameteri(f,a3.TEXTURE_MIN_FILTER,aj(g.minFilter)))}function ar(c,f){if(c.needsUpdate){c.__webglInit?(a3.bindTexture(a3.TEXTURE_2D,c.__webglTexture),a3.texImage2D(a3.TEXTURE_2D,0,a3.RGBA,a3.RGBA,a3.UNSIGNED_BYTE,c.image)):(c.__webglTexture=a3.createTexture(),a3.bindTexture(a3.TEXTURE_2D,c.__webglTexture),a3.texImage2D(a3.TEXTURE_2D,0,a3.RGBA,a3.RGBA,a3.UNSIGNED_BYTE,c.image),c.__webglInit=!0),al(a3.TEXTURE_2D,c,c.image),a3.bindTexture(a3.TEXTURE_2D,null),c.needsUpdate=!1}a3.activeTexture(a3.TEXTURE0+f);a3.bindTexture(a3.TEXTURE_2D,c.__webglTexture)}function aw(f){if(f&&!f.__webglFramebuffer){if(f.depthBuffer===void 0){f.depthBuffer=!0}if(f.stencilBuffer===void 0){f.stencilBuffer=!0}f.__webglFramebuffer=a3.createFramebuffer();f.__webglRenderbuffer=a3.createRenderbuffer();f.__webglTexture=a3.createTexture();a3.bindTexture(a3.TEXTURE_2D,f.__webglTexture);a3.texParameteri(a3.TEXTURE_2D,a3.TEXTURE_WRAP_S,aq(f.wrapS));a3.texParameteri(a3.TEXTURE_2D,a3.TEXTURE_WRAP_T,aq(f.wrapT));a3.texParameteri(a3.TEXTURE_2D,a3.TEXTURE_MAG_FILTER,aq(f.magFilter));a3.texParameteri(a3.TEXTURE_2D,a3.TEXTURE_MIN_FILTER,aq(f.minFilter));a3.texImage2D(a3.TEXTURE_2D,0,aq(f.format),f.width,f.height,0,aq(f.format),aq(f.type),null);a3.bindRenderbuffer(a3.RENDERBUFFER,f.__webglRenderbuffer);a3.bindFramebuffer(a3.FRAMEBUFFER,f.__webglFramebuffer);a3.framebufferTexture2D(a3.FRAMEBUFFER,a3.COLOR_ATTACHMENT0,a3.TEXTURE_2D,f.__webglTexture,0);f.depthBuffer&&!f.stencilBuffer?(a3.renderbufferStorage(a3.RENDERBUFFER,a3.DEPTH_COMPONENT16,f.width,f.height),a3.framebufferRenderbuffer(a3.FRAMEBUFFER,a3.DEPTH_ATTACHMENT,a3.RENDERBUFFER,f.__webglRenderbuffer)):f.depthBuffer&&f.stencilBuffer?(a3.renderbufferStorage(a3.RENDERBUFFER,a3.DEPTH_STENCIL,f.width,f.height),a3.framebufferRenderbuffer(a3.FRAMEBUFFER,a3.DEPTH_STENCIL_ATTACHMENT,a3.RENDERBUFFER,f.__webglRenderbuffer)):a3.renderbufferStorage(a3.RENDERBUFFER,a3.RGBA4,f.width,f.height);a3.bindTexture(a3.TEXTURE_2D,null);a3.bindRenderbuffer(a3.RENDERBUFFER,null);a3.bindFramebuffer(a3.FRAMEBUFFER,null)}var g,h;f?(g=f.__webglFramebuffer,h=f.width,f=f.height):(g=null,h=ad,f=ag);g!=M&&(a3.bindFramebuffer(a3.FRAMEBUFFER,g),a3.viewport(ap,aK,h,f),M=g)}function at(f,g){var h;f=="fragment"?h=a3.createShader(a3.FRAGMENT_SHADER):f=="vertex"&&(h=a3.createShader(a3.VERTEX_SHADER));a3.shaderSource(h,g);a3.compileShader(h);if(!a3.getShaderParameter(h,a3.COMPILE_STATUS)){return console.error(a3.getShaderInfoLog(h)),console.error(g),null}return h}function aj(c){switch(c){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return a3.NEAREST;default:return a3.LINEAR}}function aq(c){switch(c){case THREE.RepeatWrapping:return a3.REPEAT;case THREE.ClampToEdgeWrapping:return a3.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return a3.MIRRORED_REPEAT;case THREE.NearestFilter:return a3.NEAREST;case THREE.NearestMipMapNearestFilter:return a3.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return a3.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return a3.LINEAR;case THREE.LinearMipMapNearestFilter:return a3.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return a3.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return a3.BYTE;case THREE.UnsignedByteType:return a3.UNSIGNED_BYTE;case THREE.ShortType:return a3.SHORT;case THREE.UnsignedShortType:return a3.UNSIGNED_SHORT;case THREE.IntType:return a3.INT;case THREE.UnsignedShortType:return a3.UNSIGNED_INT;case THREE.FloatType:return a3.FLOAT;case THREE.AlphaFormat:return a3.ALPHA;case THREE.RGBFormat:return a3.RGB;case THREE.RGBAFormat:return a3.RGBA;case THREE.LuminanceFormat:return a3.LUMINANCE;case THREE.LuminanceAlphaFormat:return a3.LUMINANCE_ALPHA}return 0}var x=this,a3,aJ=[],ah=null,M=null,ao=!0,aC=null,ac=null,aB=null,aL=null,E=null,ae=null,aE=null,ap=0,aK=0,ad=0,ag=0,aI=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4],ab=new THREE.Matrix4,V=new Float32Array(16),aO=new Float32Array(16),aD=new THREE.Vector4,aV={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]}},a9=a9||{},aW=a9.canvas!==void 0?a9.canvas:document.createElement("canvas"),aS=a9.stencil!==void 0?a9.stencil:!0,aX=a9.antialias!==void 0?a9.antialias:!1,ai=a9.clearColor!==void 0?new THREE.Color(a9.clearColor):new THREE.Color(0),aH=a9.clearAlpha!==void 0?a9.clearAlpha:0;this.data={vertices:0,faces:0,drawCalls:0};this.maxMorphTargets=8;this.domElement=aW;this.sortObjects=this.autoClear=!0;try{if(!(a3=aW.getContext("experimental-webgl",{antialias:aX,stencil:aS}))){throw"Error creating WebGL context."}console.log(navigator.userAgent+" | "+a3.getParameter(a3.VERSION)+" | "+a3.getParameter(a3.VENDOR)+" | "+a3.getParameter(a3.RENDERER)+" | "+a3.getParameter(a3.SHADING_LANGUAGE_VERSION))}catch(aG){console.error(aG)}a3.clearColor(0,0,0,1);a3.clearDepth(1);a3.enable(a3.DEPTH_TEST);a3.depthFunc(a3.LEQUAL);a3.frontFace(a3.CCW);a3.cullFace(a3.BACK);a3.enable(a3.CULL_FACE);a3.enable(a3.BLEND);a3.blendEquation(a3.FUNC_ADD);a3.blendFunc(a3.SRC_ALPHA,a3.ONE_MINUS_SRC_ALPHA);a3.clearColor(ai.r,ai.g,ai.b,aH);this.context=a3;var af=a3.getParameter(a3.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;if(aS){var ak={};ak.vertices=new Float32Array(12);ak.faces=new Uint16Array(6);ak.darkness=0.5;ak.vertices[0]=-20;ak.vertices[1]=-20;ak.vertices[2]=-1;ak.vertices[3]=20;ak.vertices[4]=-20;ak.vertices[5]=-1;ak.vertices[6]=20;ak.vertices[7]=20;ak.vertices[8]=-1;ak.vertices[9]=-20;ak.vertices[10]=20;ak.vertices[11]=-1;ak.faces[0]=0;ak.faces[1]=1;ak.faces[2]=2;ak.faces[3]=0;ak.faces[4]=2;ak.faces[5]=3;ak.vertexBuffer=a3.createBuffer();ak.elementBuffer=a3.createBuffer();a3.bindBuffer(a3.ARRAY_BUFFER,ak.vertexBuffer);a3.bufferData(a3.ARRAY_BUFFER,ak.vertices,a3.STATIC_DRAW);a3.bindBuffer(a3.ELEMENT_ARRAY_BUFFER,ak.elementBuffer);a3.bufferData(a3.ELEMENT_ARRAY_BUFFER,ak.faces,a3.STATIC_DRAW);ak.program=a3.createProgram();a3.attachShader(ak.program,at("fragment",THREE.ShaderLib.shadowPost.fragmentShader));a3.attachShader(ak.program,at("vertex",THREE.ShaderLib.shadowPost.vertexShader));a3.linkProgram(ak.program);ak.vertexLocation=a3.getAttribLocation(ak.program,"position");ak.projectionLocation=a3.getUniformLocation(ak.program,"projectionMatrix");ak.darknessLocation=a3.getUniformLocation(ak.program,"darkness")}var an={};an.vertices=new Float32Array(16);an.faces=new Uint16Array(6);a9=0;an.vertices[a9++]=-1;an.vertices[a9++]=-1;an.vertices[a9++]=0;an.vertices[a9++]=0;an.vertices[a9++]=1;an.vertices[a9++]=-1;an.vertices[a9++]=1;an.vertices[a9++]=0;an.vertices[a9++]=1;an.vertices[a9++]=1;an.vertices[a9++]=1;an.vertices[a9++]=1;an.vertices[a9++]=-1;an.vertices[a9++]=1;an.vertices[a9++]=0;an.vertices[a9++]=1;a9=0;an.faces[a9++]=0;an.faces[a9++]=1;an.faces[a9++]=2;an.faces[a9++]=0;an.faces[a9++]=2;an.faces[a9++]=3;an.vertexBuffer=a3.createBuffer();an.elementBuffer=a3.createBuffer();an.tempTexture=a3.createTexture();an.occlusionTexture=a3.createTexture();a3.bindBuffer(a3.ARRAY_BUFFER,an.vertexBuffer);a3.bufferData(a3.ARRAY_BUFFER,an.vertices,a3.STATIC_DRAW);a3.bindBuffer(a3.ELEMENT_ARRAY_BUFFER,an.elementBuffer);a3.bufferData(a3.ELEMENT_ARRAY_BUFFER,an.faces,a3.STATIC_DRAW);a3.bindTexture(a3.TEXTURE_2D,an.tempTexture);a3.texImage2D(a3.TEXTURE_2D,0,a3.RGB,16,16,0,a3.RGB,a3.UNSIGNED_BYTE,null);a3.texParameteri(a3.TEXTURE_2D,a3.TEXTURE_WRAP_S,a3.CLAMP_TO_EDGE);a3.texParameteri(a3.TEXTURE_2D,a3.TEXTURE_WRAP_T,a3.CLAMP_TO_EDGE);a3.texParameteri(a3.TEXTURE_2D,a3.TEXTURE_MAG_FILTER,a3.NEAREST);a3.texParameteri(a3.TEXTURE_2D,a3.TEXTURE_MIN_FILTER,a3.NEAREST);a3.bindTexture(a3.TEXTURE_2D,an.occlusionTexture);a3.texImage2D(a3.TEXTURE_2D,0,a3.RGBA,16,16,0,a3.RGBA,a3.UNSIGNED_BYTE,null);a3.texParameteri(a3.TEXTURE_2D,a3.TEXTURE_WRAP_S,a3.CLAMP_TO_EDGE);a3.texParameteri(a3.TEXTURE_2D,a3.TEXTURE_WRAP_T,a3.CLAMP_TO_EDGE);a3.texParameteri(a3.TEXTURE_2D,a3.TEXTURE_MAG_FILTER,a3.NEAREST);a3.texParameteri(a3.TEXTURE_2D,a3.TEXTURE_MIN_FILTER,a3.NEAREST);a3.getParameter(a3.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(an.hasVertexTexture=!1,an.program=a3.createProgram(),a3.attachShader(an.program,at("fragment",THREE.ShaderLib.lensFlare.fragmentShader)),a3.attachShader(an.program,at("vertex",THREE.ShaderLib.lensFlare.vertexShader))):(an.hasVertexTexture=!0,an.program=a3.createProgram(),a3.attachShader(an.program,at("fragment",THREE.ShaderLib.lensFlareVertexTexture.fragmentShader)),a3.attachShader(an.program,at("vertex",THREE.ShaderLib.lensFlareVertexTexture.vertexShader)));a3.linkProgram(an.program);an.attributes={};an.uniforms={};an.attributes.vertex=a3.getAttribLocation(an.program,"position");an.attributes.uv=a3.getAttribLocation(an.program,"UV");an.uniforms.renderType=a3.getUniformLocation(an.program,"renderType");an.uniforms.map=a3.getUniformLocation(an.program,"map");an.uniforms.occlusionMap=a3.getUniformLocation(an.program,"occlusionMap");an.uniforms.opacity=a3.getUniformLocation(an.program,"opacity");an.uniforms.scale=a3.getUniformLocation(an.program,"scale");an.uniforms.rotation=a3.getUniformLocation(an.program,"rotation");an.uniforms.screenPosition=a3.getUniformLocation(an.program,"screenPosition");var aQ=!1,am={};am.vertices=new Float32Array(16);am.faces=new Uint16Array(6);a9=0;am.vertices[a9++]=-1;am.vertices[a9++]=-1;am.vertices[a9++]=0;am.vertices[a9++]=1;am.vertices[a9++]=1;am.vertices[a9++]=-1;am.vertices[a9++]=1;am.vertices[a9++]=1;am.vertices[a9++]=1;am.vertices[a9++]=1;am.vertices[a9++]=1;am.vertices[a9++]=0;am.vertices[a9++]=-1;am.vertices[a9++]=1;am.vertices[a9++]=0;a9=am.vertices[a9++]=0;am.faces[a9++]=0;am.faces[a9++]=1;am.faces[a9++]=2;am.faces[a9++]=0;am.faces[a9++]=2;am.faces[a9++]=3;am.vertexBuffer=a3.createBuffer();am.elementBuffer=a3.createBuffer();a3.bindBuffer(a3.ARRAY_BUFFER,am.vertexBuffer);a3.bufferData(a3.ARRAY_BUFFER,am.vertices,a3.STATIC_DRAW);a3.bindBuffer(a3.ELEMENT_ARRAY_BUFFER,am.elementBuffer);a3.bufferData(a3.ELEMENT_ARRAY_BUFFER,am.faces,a3.STATIC_DRAW);am.program=a3.createProgram();a3.attachShader(am.program,at("fragment",THREE.ShaderLib.sprite.fragmentShader));a3.attachShader(am.program,at("vertex",THREE.ShaderLib.sprite.vertexShader));a3.linkProgram(am.program);am.attributes={};am.uniforms={};am.attributes.position=a3.getAttribLocation(am.program,"position");am.attributes.uv=a3.getAttribLocation(am.program,"uv");am.uniforms.uvOffset=a3.getUniformLocation(am.program,"uvOffset");am.uniforms.uvScale=a3.getUniformLocation(am.program,"uvScale");am.uniforms.rotation=a3.getUniformLocation(am.program,"rotation");am.uniforms.scale=a3.getUniformLocation(am.program,"scale");am.uniforms.alignment=a3.getUniformLocation(am.program,"alignment");am.uniforms.map=a3.getUniformLocation(am.program,"map");am.uniforms.opacity=a3.getUniformLocation(am.program,"opacity");am.uniforms.useScreenCoordinates=a3.getUniformLocation(am.program,"useScreenCoordinates");am.uniforms.affectedByDistance=a3.getUniformLocation(am.program,"affectedByDistance");am.uniforms.screenPosition=a3.getUniformLocation(am.program,"screenPosition");am.uniforms.modelViewMatrix=a3.getUniformLocation(am.program,"modelViewMatrix");am.uniforms.projectionMatrix=a3.getUniformLocation(am.program,"projectionMatrix");var aF=!1;this.setSize=function(c,f){aW.width=c;aW.height=f;this.setViewport(0,0,aW.width,aW.height)};this.setViewport=function(g,j,k,h){ap=g;aK=j;ad=k;ag=h;a3.viewport(ap,aK,ad,ag)};this.setScissor=function(g,j,k,h){a3.scissor(g,j,k,h)};this.enableScissorTest=function(c){c?a3.enable(a3.SCISSOR_TEST):a3.disable(a3.SCISSOR_TEST)};this.enableDepthBufferWrite=function(c){ao=c;a3.depthMask(c)};this.setClearColorHex=function(c,f){ai.setHex(c);aH=f;a3.clearColor(ai.r,ai.g,ai.b,aH)};this.setClearColor=function(c,f){ai.copy(c);aH=f;a3.clearColor(ai.r,ai.g,ai.b,aH)};this.clear=function(){a3.clear(a3.COLOR_BUFFER_BIT|a3.DEPTH_BUFFER_BIT|a3.STENCIL_BUFFER_BIT)};this.setStencilShadowDarkness=function(c){ak.darkness=c};this.getContext=function(){return a3};this.initMaterial=function(H,F,G,D){var C,B,A;H instanceof THREE.MeshDepthMaterial?A="depth":H instanceof THREE.ShadowVolumeDynamicMaterial?A="shadowVolumeDynamic":H instanceof THREE.MeshNormalMaterial?A="normal":H instanceof THREE.MeshBasicMaterial?A="basic":H instanceof THREE.MeshLambertMaterial?A="lambert":H instanceof THREE.MeshPhongMaterial?A="phong":H instanceof THREE.LineBasicMaterial?A="basic":H instanceof THREE.ParticleBasicMaterial&&(A="particle_basic");if(A){var z=THREE.ShaderLib[A];H.uniforms=THREE.UniformsUtils.clone(z.uniforms);H.vertexShader=z.vertexShader;H.fragmentShader=z.fragmentShader}var w,y,K;w=K=z=0;for(y=F.length;w<y;w++){B=F[w],B instanceof THREE.DirectionalLight&&K++,B instanceof THREE.PointLight&&z++}z+K<=4?F=K:(F=Math.ceil(4*K/(z+K)),z=4-F);B={directional:F,point:z};K=50;if(D!==void 0&&D instanceof THREE.SkinnedMesh){K=D.bones.length}var j;a:{w=H.fragmentShader;y=H.vertexShader;var z=H.uniforms,F=H.attributes,G={map:!!H.map,envMap:!!H.envMap,lightMap:!!H.lightMap,vertexColors:H.vertexColors,fog:G,sizeAttenuation:H.sizeAttenuation,skinning:H.skinning,morphTargets:H.morphTargets,maxMorphTargets:this.maxMorphTargets,maxDirLights:B.directional,maxPointLights:B.point,maxBones:K},J;B=[];A?B.push(A):(B.push(w),B.push(y));for(J in G){B.push(J),B.push(G[J])}A=B.join();J=0;for(B=aJ.length;J<B;J++){if(aJ[J].code==A){j=aJ[J].program;break a}}J=a3.createProgram();B=[af?"#define VERTEX_TEXTURES":"","#define MAX_DIR_LIGHTS "+G.maxDirLights,"#define MAX_POINT_LIGHTS "+G.maxPointLights,"#define MAX_BONES "+G.maxBones,G.map?"#define USE_MAP":"",G.envMap?"#define USE_ENVMAP":"",G.lightMap?"#define USE_LIGHTMAP":"",G.vertexColors?"#define USE_COLOR":"",G.skinning?"#define USE_SKINNING":"",G.morphTargets?"#define USE_MORPHTARGETS":"",G.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nuniform mat4 cameraInverseMatrix;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");K=["#ifdef GL_ES\nprecision highp float;\n#endif","#define MAX_DIR_LIGHTS "+G.maxDirLights,"#define MAX_POINT_LIGHTS "+G.maxPointLights,G.fog?"#define USE_FOG":"",G.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",G.map?"#define USE_MAP":"",G.envMap?"#define USE_ENVMAP":"",G.lightMap?"#define USE_LIGHTMAP":"",G.vertexColors?"#define USE_COLOR":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");a3.attachShader(J,at("fragment",K+w));a3.attachShader(J,at("vertex",B+y));a3.linkProgram(J);a3.getProgramParameter(J,a3.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+a3.getProgramParameter(J,a3.VALIDATE_STATUS)+", gl error ["+a3.getError()+"]");J.uniforms={};J.attributes={};var I;w=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","cameraInverseMatrix","boneGlobalMatrices","morphTargetInfluences"];for(I in z){w.push(I)}I=w;z=0;for(w=I.length;z<w;z++){y=I[z],J.uniforms[y]=a3.getUniformLocation(J,y)}w=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(I=0;I<G.maxMorphTargets;I++){w.push("morphTarget"+I)}for(j in F){w.push(j)}j=w;I=0;for(F=j.length;I<F;I++){G=j[I],J.attributes[G]=a3.getAttribLocation(J,G)}aJ.push({program:J,code:A});j=J}H.program=j;j=H.program.attributes;j.position>=0&&a3.enableVertexAttribArray(j.position);j.color>=0&&a3.enableVertexAttribArray(j.color);j.normal>=0&&a3.enableVertexAttribArray(j.normal);j.tangent>=0&&a3.enableVertexAttribArray(j.tangent);H.skinning&&j.skinVertexA>=0&&j.skinVertexB>=0&&j.skinIndex>=0&&j.skinWeight>=0&&(a3.enableVertexAttribArray(j.skinVertexA),a3.enableVertexAttribArray(j.skinVertexB),a3.enableVertexAttribArray(j.skinIndex),a3.enableVertexAttribArray(j.skinWeight));if(H.attributes){for(C in H.attributes){j[C]!==void 0&&j[C]>=0&&a3.enableVertexAttribArray(j[C])}}if(H.morphTargets){H.numSupportedMorphTargets=0;j.morphTarget0>=0&&(a3.enableVertexAttribArray(j.morphTarget0),H.numSupportedMorphTargets++);j.morphTarget1>=0&&(a3.enableVertexAttribArray(j.morphTarget1),H.numSupportedMorphTargets++);j.morphTarget2>=0&&(a3.enableVertexAttribArray(j.morphTarget2),H.numSupportedMorphTargets++);j.morphTarget3>=0&&(a3.enableVertexAttribArray(j.morphTarget3),H.numSupportedMorphTargets++);j.morphTarget4>=0&&(a3.enableVertexAttribArray(j.morphTarget4),H.numSupportedMorphTargets++);j.morphTarget5>=0&&(a3.enableVertexAttribArray(j.morphTarget5),H.numSupportedMorphTargets++);j.morphTarget6>=0&&(a3.enableVertexAttribArray(j.morphTarget6),H.numSupportedMorphTargets++);j.morphTarget7>=0&&(a3.enableVertexAttribArray(j.morphTarget7),H.numSupportedMorphTargets++);D.__webglMorphTargetInfluences=new Float32Array(this.maxMorphTargets);H=0;for(C=this.maxMorphTargets;H<C;H++){D.__webglMorphTargetInfluences[H]=0}}};this.render=function(t,m,f,n){var e,w,y,v,o,k,u,j,h=t.lights,g=t.fog;x.data.vertices=0;x.data.faces=0;x.data.drawCalls=0;m.matrixAutoUpdate&&m.update(void 0,!0);t.update(void 0,!1,m);m.matrixWorldInverse.flattenToArray(aO);m.projectionMatrix.flattenToArray(V);ab.multiply(m.projectionMatrix,m.matrixWorldInverse);a0(ab);this.initWebGLObjects(t);aw(f);(this.autoClear||n)&&this.clear();o=t.__webglObjects.length;for(n=0;n<o;n++){if(e=t.__webglObjects[n],u=e.object,u.visible){if(!(u instanceof THREE.Mesh)||aZ(u)){if(u.matrixWorld.flattenToArray(u._objectMatrixArray),aN(u,m),aR(e),e.render=!0,this.sortObjects){e.object.renderDepth?e.z=e.object.renderDepth:(aD.copy(u.position),ab.multiplyVector3(aD),e.z=aD.z)}}else{e.render=!1}}else{e.render=!1}}this.sortObjects&&t.__webglObjects.sort(aT);k=t.__webglObjectsImmediate.length;for(n=0;n<k;n++){e=t.__webglObjectsImmediate[n],u=e.object,u.visible&&(u.matrixAutoUpdate&&u.matrixWorld.flattenToArray(u._objectMatrixArray),aN(u,m),aU(e))}if(t.overrideMaterial){a4(t.overrideMaterial.depthTest);ax(t.overrideMaterial.blending);for(n=0;n<o;n++){if(e=t.__webglObjects[n],e.render){u=e.object,j=e.buffer,a2(u),a6(m,h,g,t.overrideMaterial,j,u)}}for(n=0;n<k;n++){e=t.__webglObjectsImmediate[n],u=e.object,u.visible&&(a2(u),w=a7(m,h,g,t.overrideMaterial,u),u.render(function(b){a5(b,w,t.overrideMaterial.shading)}))}}else{ax(THREE.NormalBlending);for(n=0;n<o;n++){if(e=t.__webglObjects[n],e.render){u=e.object;j=e.buffer;y=e.opaque;a2(u);for(e=0;e<y.count;e++){v=y.list[e],a4(v.depthTest),a1(v.polygonOffset,v.polygonOffsetFactor,v.polygonOffsetUnits),a6(m,h,g,v,j,u)}}}for(n=0;n<k;n++){if(e=t.__webglObjectsImmediate[n],u=e.object,u.visible){y=e.opaque;a2(u);for(e=0;e<y.count;e++){v=y.list[e],a4(v.depthTest),a1(v.polygonOffset,v.polygonOffsetFactor,v.polygonOffsetUnits),w=a7(m,h,g,v,u),u.render(function(c){a5(c,w,v.shading)})}}}for(n=0;n<o;n++){if(e=t.__webglObjects[n],e.render){u=e.object;j=e.buffer;y=e.transparent;a2(u);for(e=0;e<y.count;e++){v=y.list[e],ax(v.blending),a4(v.depthTest),a1(v.polygonOffset,v.polygonOffsetFactor,v.polygonOffsetUnits),a6(m,h,g,v,j,u)}}}for(n=0;n<k;n++){if(e=t.__webglObjectsImmediate[n],u=e.object,u.visible){y=e.transparent;a2(u);for(e=0;e<y.count;e++){v=y.list[e],ax(v.blending),a4(v.depthTest),a1(v.polygonOffset,v.polygonOffsetFactor,v.polygonOffsetUnits),w=a7(m,h,g,v,u),u.render(function(c){a5(c,w,v.shading)})}}}}t.__webglSprites.length&&az(t,m);aS&&t.__webglShadowVolumes.length&&t.lights.length&&aP(t);t.__webglLensFlares.length&&aA(t,m);f&&f.minFilter!==THREE.NearestFilter&&f.minFilter!==THREE.LinearFilter&&(a3.bindTexture(a3.TEXTURE_2D,f.__webglTexture),a3.generateMipmap(a3.TEXTURE_2D),a3.bindTexture(a3.TEXTURE_2D,null))};this.initWebGLObjects=function(Y){if(!Y.__webglObjects){Y.__webglObjects=[],Y.__webglObjectsImmediate=[],Y.__webglShadowVolumes=[],Y.__webglLensFlares=[],Y.__webglSprites=[]}for(;Y.__objectsAdded.length;){var W=Y.__objectsAdded[0],X=Y,U=void 0,S=void 0,T=void 0;if(W._modelViewMatrix==void 0){W._modelViewMatrix=new THREE.Matrix4,W._normalMatrixArray=new Float32Array(9),W._modelViewMatrixArray=new Float32Array(16),W._objectMatrixArray=new Float32Array(16),W.matrixWorld.flattenToArray(W._objectMatrixArray)}if(W instanceof THREE.Mesh){for(U in S=W.geometry,S.geometryGroups==void 0&&ay(S),S.geometryGroups){T=S.geometryGroups[U];if(!T.__webglVertexBuffer){var R=T;R.__webglVertexBuffer=a3.createBuffer();R.__webglNormalBuffer=a3.createBuffer();R.__webglTangentBuffer=a3.createBuffer();R.__webglColorBuffer=a3.createBuffer();R.__webglUVBuffer=a3.createBuffer();R.__webglUV2Buffer=a3.createBuffer();R.__webglSkinVertexABuffer=a3.createBuffer();R.__webglSkinVertexBBuffer=a3.createBuffer();R.__webglSkinIndicesBuffer=a3.createBuffer();R.__webglSkinWeightsBuffer=a3.createBuffer();R.__webglFaceBuffer=a3.createBuffer();R.__webglLineBuffer=a3.createBuffer();if(R.numMorphTargets){var Q=void 0,O=void 0;R.__webglMorphTargetsBuffers=[];Q=0;for(O=R.numMorphTargets;Q<O;Q++){R.__webglMorphTargetsBuffers.push(a3.createBuffer())}}for(var R=T,Q=W,P=void 0,N=void 0,I=void 0,H=I=void 0,C=void 0,z=void 0,j=z=O=0,L=I=N=void 0,K=L=N=P=void 0,I=void 0,H=Q.geometry,C=H.faces,L=R.faces,P=0,N=L.length;P<N;P++){I=L[P],I=C[I],I instanceof THREE.Face3?(O+=3,z+=1,j+=3):I instanceof THREE.Face4&&(O+=4,z+=2,j+=4)}for(var P=R,N=Q,J=L=C=void 0,G=void 0,J=void 0,I=[],C=0,L=N.materials.length;C<L;C++){if(J=N.materials[C],J instanceof THREE.MeshFaceMaterial){J=0;for(l=P.materials.length;J<l;J++){(G=P.materials[J])&&I.push(G)}}else{(G=J)&&I.push(G)}}P=I;R.__materials=P;a:{C=N=void 0;L=P.length;for(N=0;N<L;N++){if(C=P[N],C.map||C.lightMap||C instanceof THREE.MeshShaderMaterial){N=!0;break a}}N=!1}a:{L=C=void 0;I=P.length;for(C=0;C<I;C++){if(L=P[C],!(L instanceof THREE.MeshBasicMaterial&&!L.envMap||L instanceof THREE.MeshDepthMaterial)){L=L&&L.shading!=void 0&&L.shading==THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading;break a}}L=!1}a:{I=C=void 0;J=P.length;for(C=0;C<J;C++){if(I=P[C],I.vertexColors){I=I.vertexColors;break a}}I=!1}R.__vertexArray=new Float32Array(O*3);if(L){R.__normalArray=new Float32Array(O*3)}if(H.hasTangents){R.__tangentArray=new Float32Array(O*4)}if(I){R.__colorArray=new Float32Array(O*3)}if(N){if(H.faceUvs.length>0||H.faceVertexUvs.length>0){R.__uvArray=new Float32Array(O*2)}if(H.faceUvs.length>1||H.faceVertexUvs.length>1){R.__uv2Array=new Float32Array(O*2)}}if(Q.geometry.skinWeights.length&&Q.geometry.skinIndices.length){R.__skinVertexAArray=new Float32Array(O*4),R.__skinVertexBArray=new Float32Array(O*4),R.__skinIndexArray=new Float32Array(O*4),R.__skinWeightArray=new Float32Array(O*4)}R.__faceArray=new Uint16Array(z*3+(Q.geometry.edgeFaces?Q.geometry.edgeFaces.length*6:0));R.__lineArray=new Uint16Array(j*2);if(R.numMorphTargets){R.__morphTargetsArrays=[];H=0;for(C=R.numMorphTargets;H<C;H++){R.__morphTargetsArrays.push(new Float32Array(O*3))}}R.__needsSmoothNormals=L==THREE.SmoothShading;R.__uvType=N;R.__vertexColorType=I;R.__normalType=L;R.__webglFaceCount=z*3+(Q.geometry.edgeFaces?Q.geometry.edgeFaces.length*6:0);R.__webglLineCount=j*2;H=0;for(C=P.length;H<C;H++){if(N=P[H],N.attributes){for(a in R.__webglCustomAttributes={},N.attributes){I=N.attributes[a];L={};for(K in I){L[K]=I[K]}if(!L.__webglInitialized||L.createUniqueBuffers){L.__webglInitialized=!0,z=1,L.type==="v2"?z=2:L.type==="v3"?z=3:L.type==="v4"?z=4:L.type==="c"&&(z=3),L.size=z,L.array=new Float32Array(O*z),L.buffer=a3.createBuffer(),L.buffer.belongsToAttribute=a,I.needsUpdate=!0,L.__original=I}R.__webglCustomAttributes[a]=L}}}R.__inittedArrays=!0;S.__dirtyVertices=!0;S.__dirtyMorphTargets=!0;S.__dirtyElements=!0;S.__dirtyUvs=!0;S.__dirtyNormals=!0;S.__dirtyTangents=!0;S.__dirtyColors=!0}W instanceof THREE.ShadowVolume?au(X.__webglShadowVolumes,T,W):au(X.__webglObjects,T,W)}}else{if(W instanceof THREE.LensFlare){au(X.__webglLensFlares,void 0,W)}else{if(W instanceof THREE.Ribbon){S=W.geometry;if(!S.__webglVertexBuffer){U=S,U.__webglVertexBuffer=a3.createBuffer(),U.__webglColorBuffer=a3.createBuffer(),U=S,T=U.vertices.length,U.__vertexArray=new Float32Array(T*3),U.__colorArray=new Float32Array(T*3),U.__webglVertexCount=T,S.__dirtyVertices=!0,S.__dirtyColors=!0}au(X.__webglObjects,S,W)}else{if(W instanceof THREE.Line){S=W.geometry;if(!S.__webglVertexBuffer){U=S,U.__webglVertexBuffer=a3.createBuffer(),U.__webglColorBuffer=a3.createBuffer(),U=S,T=U.vertices.length,U.__vertexArray=new Float32Array(T*3),U.__colorArray=new Float32Array(T*3),U.__webglLineCount=T,S.__dirtyVertices=!0,S.__dirtyColors=!0}au(X.__webglObjects,S,W)}else{if(W instanceof THREE.ParticleSystem){S=W.geometry;if(!S.__webglVertexBuffer){U=S,U.__webglVertexBuffer=a3.createBuffer(),U.__webglColorBuffer=a3.createBuffer(),U=S,T=U.vertices.length,U.__vertexArray=new Float32Array(T*3),U.__colorArray=new Float32Array(T*3),U.__sortArray=[],U.__webglParticleCount=T,S.__dirtyVertices=!0,S.__dirtyColors=!0}au(X.__webglObjects,S,W)}else{THREE.MarchingCubes!==void 0&&W instanceof THREE.MarchingCubes?X.__webglObjectsImmediate.push({object:W,opaque:{list:[],count:0},transparent:{list:[],count:0}}):W instanceof THREE.Sprite&&X.__webglSprites.push(W)}}}}}Y.__objectsAdded.splice(0,1)}for(;Y.__objectsRemoved.length;){X=Y.__objectsRemoved[0];W=Y;if(X instanceof THREE.ShadowVolume){aM(W.__webglShadowVolumes,X)}else{if(X instanceof THREE.Mesh||X instanceof THREE.ParticleSystem||X instanceof THREE.Ribbon||X instanceof THREE.Line){aM(W.__webglObjects,X)}else{if(X instanceof THREE.Sprite){W=W.__webglSprites;S=void 0;for(S=W.length-1;S>=0;S--){W[S]==X&&W.splice(S,1)}}else{X instanceof THREE.LensFlare?aM(W.__webglLensFlares,X):X instanceof THREE.MarchingCubes&&aM(W.__webglObjectsImmediate,X)}}}Y.__objectsRemoved.splice(0,1)}W=0;for(X=Y.__webglObjects.length;W<X;W++){av(Y.__webglObjects[W].object,Y)}W=0;for(X=Y.__webglShadowVolumes.length;W<X;W++){av(Y.__webglShadowVolumes[W].object,Y)}W=0;for(X=Y.__webglLensFlares.length;W<X;W++){av(Y.__webglLensFlares[W].object,Y)}};this.setFaceCulling=function(c,f){c?(!f||f=="ccw"?a3.frontFace(a3.CCW):a3.frontFace(a3.CW),c=="back"?a3.cullFace(a3.BACK):c=="front"?a3.cullFace(a3.FRONT):a3.cullFace(a3.FRONT_AND_BACK),a3.enable(a3.CULL_FACE)):a3.disable(a3.CULL_FACE)};this.supportsVertexTextures=function(){return af}};THREE.WebGLRenderTarget=function(f,h,g){this.width=f;this.height=h;g=g||{};this.wrapS=g.wrapS!==void 0?g.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=g.wrapT!==void 0?g.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=g.magFilter!==void 0?g.magFilter:THREE.LinearFilter;this.minFilter=g.minFilter!==void 0?g.minFilter:THREE.LinearMipMapLinearFilter;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=g.format!==void 0?g.format:THREE.RGBAFormat;this.type=g.type!==void 0?g.type:THREE.UnsignedByteType;this.depthBuffer=g.depthBuffer!==void 0?g.depthBuffer:!0;this.stencilBuffer=g.stencilBuffer!==void 0?g.stencilBuffer:!0};THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=!0};THREE.RenderableVertex.prototype.copy=function(c){this.positionWorld.copy(c.positionWorld);this.positionScreen.copy(c.positionScreen)};THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterials=this.meshMaterials=null;this.overdraw=!1;this.uvs=[[]];this.z=null};THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.materials=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.materials=null};THREE.ColorUtils={adjustHSV:function(h,n,m,k){var j=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(h,j);j.h=THREE.ColorUtils.clamp(j.h+n,0,1);j.s=THREE.ColorUtils.clamp(j.s+m,0,1);j.v=THREE.ColorUtils.clamp(j.v+k,0,1);h.setHSV(j.h,j.s,j.v)},rgbToHsv:function(n,w){var v=n.r,u=n.g,t=n.b,o=Math.max(Math.max(v,u),t),p=Math.min(Math.min(v,u),t);if(p==o){p=v=0}else{var j=o-p,p=j/o,v=v==o?(u-t)/j:u==o?2+(t-v)/j:4+(v-u)/j;v/=6;v<0&&(v+=1);v>1&&(v-=1)}w===void 0&&(w={h:0,s:0,v:0});w.h=v;w.s=p;w.v=o;return w},clamp:function(f,h,g){return f<h?h:f>g?g:f}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};var GeometryUtils={merge:function(I,H){var G=H instanceof THREE.Mesh,F=I.vertices.length,E=G?H.geometry:H,C=I.vertices,D=E.vertices,A=I.faces,z=E.faces,y=I.faceVertexUvs[0],E=E.faceVertexUvs[0];G&&H.matrixAutoUpdate&&H.updateMatrix();for(var x=0,M=D.length;x<M;x++){var K=new THREE.Vertex(D[x].position.clone());G&&H.matrix.multiplyVector3(K.position);C.push(K)}x=0;for(M=z.length;x<M;x++){var D=z[x],L,J,j=D.vertexNormals,K=D.vertexColors;D instanceof THREE.Face3?L=new THREE.Face3(D.a+F,D.b+F,D.c+F):D instanceof THREE.Face4&&(L=new THREE.Face4(D.a+F,D.b+F,D.c+F,D.d+F));L.normal.copy(D.normal);G=0;for(C=j.length;G<C;G++){J=j[G],L.vertexNormals.push(J.clone())}L.color.copy(D.color);G=0;for(C=K.length;G<C;G++){J=K[G],L.vertexColors.push(J.clone())}L.materials=D.materials.slice();L.centroid.copy(D.centroid);A.push(L)}x=0;for(M=E.length;x<M;x++){F=E[x];A=[];G=0;for(C=F.length;G<C;G++){A.push(new THREE.UV(F[G].u,F[G].v))}y.push(A)}}};THREE.ImageUtils={loadTexture:function(h,n,m){var k=new Image,j=new THREE.Texture(k,n);k.onload=function(){j.needsUpdate=!0;m&&m(this)};k.src=h;return j},loadTextureCube:function(h,p,o){var n,m=[],j=new THREE.Texture(m,p),p=m.loadCount=0;for(n=h.length;p<n;++p){m[p]=new Image,m[p].onload=function(){m.loadCount+=1;if(m.loadCount==6){j.needsUpdate=!0}o&&o(this)},m[p].src=h[p]}return j}};THREE.SceneUtils={showHierarchy:function(e,f){THREE.SceneUtils.traverseHierarchy(e,function(c){c.visible=f})},traverseHierarchy:function(h,n){var m,k,j=h.children.length;for(k=0;k<j;k++){m=h.children[k],n(m),THREE.SceneUtils.traverseHierarchy(m,n)}}};if(THREE.WebGLRenderer){THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:0.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.lights,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},uNormalScale:{type:"f",value:1},tDisplacement:{type:"t",value:5,texture:null},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(15658734)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(328965)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1}}]),fragmentShader:"uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform float uNormalScale;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvoid main() {\ngl_FragColor = vec4( 1.0 );\nvec4 mColor = vec4( uDiffuseColor, uOpacity );\nvec4 mSpecular = vec4( uSpecularColor, uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse )\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\nif( enableAO )\ngl_FragColor = gl_FragColor * texture2D( tAO, vUv );\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( vTangent, vBinormal, vNormal );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec4 pointTotal  = vec4( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nvec3 pointHalfVector = normalize( vPointLight[ i ].xyz + vViewPosition );\nfloat pointDistance = vPointLight[ i ].w;\nfloat pointDotNormalHalf = dot( normal, pointHalfVector );\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\nfloat pointSpecularWeight = 0.0;\nif ( pointDotNormalHalf >= 0.0 )\npointSpecularWeight = specularTex.r * pow( pointDotNormalHalf, uShininess );\npointTotal  += pointDistance * vec4( pointLightColor[ i ], 1.0 ) * ( mColor * pointDiffuseWeight + mSpecular * pointSpecularWeight * pointDiffuseWeight );\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec4 dirTotal  = vec4( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nvec3 dirHalfVector = normalize( lDirection.xyz + vViewPosition );\nfloat dirDotNormalHalf = dot( normal, dirHalfVector );\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\nfloat dirSpecularWeight = 0.0;\nif ( dirDotNormalHalf >= 0.0 )\ndirSpecularWeight = specularTex.r * pow( dirDotNormalHalf, uShininess );\ndirTotal  += vec4( directionalLightColor[ i ], 1.0 ) * ( mColor * dirDiffuseWeight + mSpecular * dirSpecularWeight * dirDiffuseWeight );\n}\n#endif\nvec4 totalLight = vec4( ambientLightColor * uAmbientColor, uOpacity );\n#if MAX_DIR_LIGHTS > 0\ntotalLight += dirTotal;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalLight += pointTotal;\n#endif\ngl_FragColor = gl_FragColor * totalLight;\n}",vertexShader:"attribute vec4 tangent;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvBinormal = normalize( vBinormal );\nvUv = uv;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( vNormal.xyz * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif\n}"},cube:{uniforms:{tCube:{type:"t",value:1,texture:null}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( - wPos.x, wPos.yz ) );\n}"},convolution:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(0.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:"varying vec2 vUv;\nuniform vec2 uImageIncrement;\nvoid main(void) {\nvUv = uv - ((KERNEL_SIZE - 1.0) / 2.0) * uImageIncrement;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform vec2 uImageIncrement;\nuniform float cKernel[KERNEL_SIZE];\nvoid main(void) {\nvec2 imageCoord = vUv;\nvec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );\nfor( int i=0; i<KERNEL_SIZE; ++i ) {\nsum += texture2D( tDiffuse, imageCoord ) * cKernel[i];\nimageCoord += uImageIncrement;\n}\ngl_FragColor = sum;\n}"},film:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},time:{type:"f",value:0},nIntensity:{type:"f",value:0.5},sIntensity:{type:"f",value:0.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float time;\nuniform bool grayscale;\nuniform float nIntensity;\nuniform float sIntensity;\nuniform float sCount;\nvoid main() {\nvec4 cTextureScreen = texture2D( tDiffuse, vUv );\nfloat x = vUv.x * vUv.y * time *  1000.0;\nx = mod( x, 13.0 ) * mod( x, 123.0 );\nfloat dx = mod( x, 0.01 );\nvec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\nvec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );\ncResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;\ncResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );\nif( grayscale ) {\ncResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );\n}\ngl_FragColor =  vec4( cResult, cTextureScreen.a );\n}"},screen:{uniforms:{tDiffuse:{type:"t",value:0,texture:null},opacity:{type:"f",value:1}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"varying vec2 vUv;\nuniform sampler2D tDiffuse;\nuniform float opacity;\nvoid main() {\nvec4 texel = texture2D( tDiffuse, vUv );\ngl_FragColor = opacity * texel;\n}"},basic:{uniforms:{},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"void main() {\ngl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );\n}"}},buildKernel:function(h){var p,o,n,m,j=2*Math.ceil(h*3)+1;j>25&&(j=25);m=(j-1)*0.5;o=Array(j);for(p=n=0;p<j;++p){o[p]=Math.exp(-((p-m)*(p-m))/(2*h*h)),n+=o[p]}for(p=0;p<j;++p){o[p]/=n}return o}}}THREE.AnimationHandler=function(){var g=[],k={},j={update:function(b){for(var f=0;f<g.length;f++){g[f].update(b)}},addToUpdate:function(b){g.indexOf(b)===-1&&g.push(b)},removeFromUpdate:function(b){b=g.indexOf(b);b!==-1&&g.splice(b,1)},add:function(t){k[t.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+t.name+" already exists in library. Overwriting.");k[t.name]=t;if(t.initialized!==!0){for(var w=0;w<t.hierarchy.length;w++){for(var u=0;u<t.hierarchy[w].keys.length;u++){if(t.hierarchy[w].keys[u].time<0){t.hierarchy[w].keys[u].time=0}if(t.hierarchy[w].keys[u].rot!==void 0&&!(t.hierarchy[w].keys[u].rot instanceof THREE.Quaternion)){var c=t.hierarchy[w].keys[u].rot;t.hierarchy[w].keys[u].rot=new THREE.Quaternion(c[0],c[1],c[2],c[3])}}if(t.hierarchy[w].keys[0].morphTargets!==void 0){c={};for(u=0;u<t.hierarchy[w].keys.length;u++){for(var y=0;y<t.hierarchy[w].keys[u].morphTargets.length;y++){var x=t.hierarchy[w].keys[u].morphTargets[y];c[x]=-1}}t.hierarchy[w].usedMorphTargets=c;for(u=0;u<t.hierarchy[w].keys.length;u++){var v={};for(x in c){for(y=0;y<t.hierarchy[w].keys[u].morphTargets.length;y++){if(t.hierarchy[w].keys[u].morphTargets[y]===x){v[x]=t.hierarchy[w].keys[u].morphTargetsInfluences[y];break}}y===t.hierarchy[w].keys[u].morphTargets.length&&(v[x]=0)}t.hierarchy[w].keys[u].morphTargetsInfluences=v}}for(u=1;u<t.hierarchy[w].keys.length;u++){t.hierarchy[w].keys[u].time===t.hierarchy[w].keys[u-1].time&&(t.hierarchy[w].keys.splice(u,1),u--)}for(u=1;u<t.hierarchy[w].keys.length;u++){t.hierarchy[w].keys[u].index=u}}u=parseInt(t.length*t.fps,10);t.JIT={};t.JIT.hierarchy=[];for(w=0;w<t.hierarchy.length;w++){t.JIT.hierarchy.push(Array(u))}t.initialized=!0}},get:function(c){if(typeof c==="string"){return k[c]?k[c]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+c),null)}},parse:function(f){var m=[];if(f instanceof THREE.SkinnedMesh){for(var n=0;n<f.bones.length;n++){m.push(f.bones[n])}}else{h(f,m)}return m}},h=function(f,m){m.push(f);for(var n=0;n<f.children.length;n++){h(f.children[n],m)}};j.LINEAR=0;j.CATMULLROM=1;j.CATMULLROM_FORWARD=2;return j}();THREE.Animation=function(g,k,j,h){this.root=g;this.data=THREE.AnimationHandler.get(k);this.hierarchy=THREE.AnimationHandler.parse(g);this.currentTime=0;this.timeScale=1;this.isPlaying=!1;this.loop=this.isPaused=!0;this.interpolationType=j!==void 0?j:THREE.AnimationHandler.LINEAR;this.JITCompile=h!==void 0?h:!0;this.points=[];this.target=new THREE.Vector3};THREE.Animation.prototype.play=function(h,p){if(!this.isPlaying){this.isPlaying=!0;this.loop=h!==void 0?h:!0;this.currentTime=p!==void 0?p:0;var o,n=this.hierarchy.length,m;for(o=0;o<n;o++){m=this.hierarchy[o];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD){m.useQuaternion=!0}m.matrixAutoUpdate=!0;if(m.animationCache===void 0){m.animationCache={},m.animationCache.prevKey={pos:0,rot:0,scl:0},m.animationCache.nextKey={pos:0,rot:0,scl:0},m.animationCache.originalMatrix=m instanceof THREE.Bone?m.skinMatrix:m.matrix}var j=m.animationCache.prevKey;m=m.animationCache.nextKey;j.pos=this.data.hierarchy[o].keys[0];j.rot=this.data.hierarchy[o].keys[0];j.scl=this.data.hierarchy[o].keys[0];m.pos=this.getNextKeyWith("pos",o,1);m.rot=this.getNextKeyWith("rot",o,1);m.scl=this.getNextKeyWith("scl",o,1)}this.update(0)}this.isPaused=!1;THREE.AnimationHandler.addToUpdate(this)};THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1;THREE.AnimationHandler.removeFromUpdate(this);for(var c=0;c<this.hierarchy.length;c++){if(this.hierarchy[c].animationCache!==void 0){this.hierarchy[c] instanceof THREE.Bone?this.hierarchy[c].skinMatrix=this.hierarchy[c].animationCache.originalMatrix:this.hierarchy[c].matrix=this.hierarchy[c].animationCache.originalMatrix,delete this.hierarchy[c].animationCache}}};THREE.Animation.prototype.update=function(I){if(this.isPlaying){var H=["pos","rot","scl"],G,F,E,C,D,A,z,y,x=this.data.JIT.hierarchy,M,K;this.currentTime+=I*this.timeScale;K=this.currentTime;M=this.currentTime%=this.data.length;y=parseInt(Math.min(M*this.data.fps,this.data.length*this.data.fps),10);for(var L=0,J=this.hierarchy.length;L<J;L++){if(I=this.hierarchy[L],z=I.animationCache,this.JITCompile&&x[L][y]!==void 0){I instanceof THREE.Bone?(I.skinMatrix=x[L][y],I.matrixAutoUpdate=!1,I.matrixWorldNeedsUpdate=!1):(I.matrix=x[L][y],I.matrixAutoUpdate=!1,I.matrixWorldNeedsUpdate=!0)}else{if(this.JITCompile){I instanceof THREE.Bone?I.skinMatrix=I.animationCache.originalMatrix:I.matrix=I.animationCache.originalMatrix}for(var j=0;j<3;j++){G=H[j];D=z.prevKey[G];A=z.nextKey[G];if(A.time<=K){if(M<K){if(this.loop){D=this.data.hierarchy[L].keys[0];for(A=this.getNextKeyWith(G,L,1);A.time<M;){D=A,A=this.getNextKeyWith(G,L,A.index+1)}}else{this.stop();return}}else{do{D=A,A=this.getNextKeyWith(G,L,A.index+1)}while(A.time<M)}z.prevKey[G]=D;z.nextKey[G]=A}I.matrixAutoUpdate=!0;I.matrixWorldNeedsUpdate=!0;F=(M-D.time)/(A.time-D.time);E=D[G];C=A[G];if(F<0||F>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+F+" on bone "+L),F=F<0?0:1}if(G==="pos"){if(G=I.position,this.interpolationType===THREE.AnimationHandler.LINEAR){G.x=E[0]+(C[0]-E[0])*F,G.y=E[1]+(C[1]-E[1])*F,G.z=E[2]+(C[2]-E[2])*F}else{if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){if(this.points[0]=this.getPrevKeyWith("pos",L,D.index-1).pos,this.points[1]=E,this.points[2]=C,this.points[3]=this.getNextKeyWith("pos",L,A.index+1).pos,F=F*0.33+0.33,E=this.interpolateCatmullRom(this.points,F),G.x=E[0],G.y=E[1],G.z=E[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){F=this.interpolateCatmullRom(this.points,F*1.01),this.target.set(F[0],F[1],F[2]),this.target.subSelf(G),this.target.y=0,this.target.normalize(),F=Math.atan2(this.target.x,this.target.z),I.rotation.set(0,F,0)}}}}else{if(G==="rot"){THREE.Quaternion.slerp(E,C,I.quaternion,F)}else{if(G==="scl"){G=I.scale,G.x=E[0]+(C[0]-E[0])*F,G.y=E[1]+(C[1]-E[1])*F,G.z=E[2]+(C[2]-E[2])*F}}}}}}if(this.JITCompile&&x[0][y]===void 0){this.hierarchy[0].update(void 0,!0);for(L=0;L<this.hierarchy.length;L++){x[L][y]=this.hierarchy[L] instanceof THREE.Bone?this.hierarchy[L].skinMatrix.clone():this.hierarchy[L].matrix.clone()}}}};THREE.Animation.prototype.interpolateCatmullRom=function(A,z){var y=[],x=[],w,u,v,t,p,j;w=(A.length-1)*z;u=Math.floor(w);w-=u;y[0]=u==0?u:u-1;y[1]=u;y[2]=u>A.length-2?u:u+1;y[3]=u>A.length-3?u:u+2;u=A[y[0]];t=A[y[1]];p=A[y[2]];j=A[y[3]];y=w*w;v=w*y;x[0]=this.interpolate(u[0],t[0],p[0],j[0],w,y,v);x[1]=this.interpolate(u[1],t[1],p[1],j[1],w,y,v);x[2]=this.interpolate(u[2],t[2],p[2],j[2],w,y,v);return x};THREE.Animation.prototype.interpolate=function(j,u,t,p,o,m,n){j=(t-j)*0.5;p=(p-u)*0.5;return(2*(u-t)+j+p)*n+(-3*(u-t)-2*j-p)*m+j*o+u};THREE.Animation.prototype.getNextKeyWith=function(g,k,j){var h=this.data.hierarchy[k].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?j=j<h.length-1?j:h.length-1:j%=h.length;j<h.length;j++){if(h[j][g]!==void 0){return h[j]}}return this.data.hierarchy[k].keys[0]};THREE.Animation.prototype.getPrevKeyWith=function(g,k,j){for(var h=this.data.hierarchy[k].keys,j=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?j>0?j:0:j>=0?j:j+h.length;j>=0;j--){if(h[j][g]!==void 0){return h[j]}}return this.data.hierarchy[k].keys[h.length-1]};THREE.FirstPersonCamera=function(e){function f(g,h){return function(){h.apply(g,arguments)}}THREE.Camera.call(this,e.fov,e.aspect,e.near,e.far,e.target);this.movementSpeed=1;this.lookSpeed=0.005;this.noFly=!1;this.lookVertical=!0;this.autoForward=!1;this.activeLook=!0;this.heightSpeed=!1;this.heightCoef=1;this.heightMin=0;this.constrainVertical=!1;this.verticalMin=0;this.verticalMax=3.14;this.domElement=document;this.lastUpdate=(new Date).getTime();this.tdiff=0;if(e){if(e.movementSpeed!==void 0){this.movementSpeed=e.movementSpeed}if(e.lookSpeed!==void 0){this.lookSpeed=e.lookSpeed}if(e.noFly!==void 0){this.noFly=e.noFly}if(e.lookVertical!==void 0){this.lookVertical=e.lookVertical}if(e.autoForward!==void 0){this.autoForward=e.autoForward}if(e.activeLook!==void 0){this.activeLook=e.activeLook}if(e.heightSpeed!==void 0){this.heightSpeed=e.heightSpeed}if(e.heightCoef!==void 0){this.heightCoef=e.heightCoef}if(e.heightMin!==void 0){this.heightMin=e.heightMin}if(e.heightMax!==void 0){this.heightMax=e.heightMax}if(e.constrainVertical!==void 0){this.constrainVertical=e.constrainVertical}if(e.verticalMin!==void 0){this.verticalMin=e.verticalMin}if(e.verticalMax!==void 0){this.verticalMax=e.verticalMax}if(e.domElement!==void 0){this.domElement=e.domElement}}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=!1;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2;this.onMouseDown=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook){switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}}this.mouseDragOn=!0};this.onMouseUp=function(c){c.preventDefault();c.stopPropagation();if(this.activeLook){switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.mouseDragOn=!1};this.onMouseMove=function(c){this.mouseX=c.clientX-this.windowHalfX;this.mouseY=c.clientY-this.windowHalfY};this.onKeyDown=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!0;break;case 37:case 65:this.moveLeft=!0;break;case 40:case 83:this.moveBackward=!0;break;case 39:case 68:this.moveRight=!0;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(c){switch(c.keyCode){case 38:case 87:this.moveForward=!1;break;case 37:case 65:this.moveLeft=!1;break;case 40:case 83:this.moveBackward=!1;break;case 39:case 68:this.moveRight=!1}};this.update=function(){var h=(new Date).getTime();this.tdiff=(h-this.lastUpdate)/1000;this.lastUpdate=h;if(!this.freeze){this.autoSpeedFactor=this.heightSpeed?this.tdiff*((this.position.y<this.heightMin?this.heightMin:this.position.y>this.heightMax?this.heightMax:this.position.y)-this.heightMin)*this.heightCoef:0;var k=this.tdiff*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.translateZ(-(k+this.autoSpeedFactor));this.moveBackward&&this.translateZ(k);this.moveLeft&&this.translateX(-k);this.moveRight&&this.translateX(k);k=this.tdiff*this.lookSpeed;this.activeLook||(k=0);this.lon+=this.mouseX*k;this.lookVertical&&(this.lat-=this.mouseY*k);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;var h=this.target.position,j=this.position;h.x=j.x+100*Math.sin(this.phi)*Math.cos(this.theta);h.y=j.y+100*Math.cos(this.phi);h.z=j.z+100*Math.sin(this.phi)*Math.sin(this.theta)}this.lon+=this.mouseX*k;this.lookVertical&&(this.lat-=this.mouseY*k);this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical){this.phi=(this.phi-0)*(this.verticalMax-this.verticalMin)/3.14+this.verticalMin}h=this.target.position;j=this.position;h.x=j.x+100*Math.sin(this.phi)*Math.cos(this.theta);h.y=j.y+100*Math.cos(this.phi);h.z=j.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this)};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",f(this,this.onMouseMove),!1);this.domElement.addEventListener("mousedown",f(this,this.onMouseDown),!1);this.domElement.addEventListener("mouseup",f(this,this.onMouseUp),!1);this.domElement.addEventListener("keydown",f(this,this.onKeyDown),!1);this.domElement.addEventListener("keyup",f(this,this.onKeyUp),!1)};THREE.FirstPersonCamera.prototype=new THREE.Camera;THREE.FirstPersonCamera.prototype.constructor=THREE.FirstPersonCamera;THREE.FirstPersonCamera.prototype.supr=THREE.Camera.prototype;THREE.FirstPersonCamera.prototype.translate=function(e,f){this.matrix.rotateAxis(f);if(this.noFly){f.y=0}this.position.addSelf(f.multiplyScalar(e));this.target.position.addSelf(f.multiplyScalar(e))};THREE.PathCamera=function(y){function x(I,F,H,E){var C={name:H,fps:0.6,length:E,hierarchy:[]},D,B=F.getControlPointsArray(),A=F.getLength(),z=B.length,J=0;D=z-1;F={parent:-1,keys:[]};F.keys[0]={time:0,pos:B[0],rot:[0,0,0,1],scl:[1,1,1]};F.keys[D]={time:E,pos:B[D],rot:[0,0,0,1],scl:[1,1,1]};for(D=1;D<z-1;D++){J=E*A.chunks[D]/A.total,F.keys[D]={time:J,pos:B[D]}}C.hierarchy[0]=F;THREE.AnimationHandler.add(C);return new THREE.Animation(I,H,THREE.AnimationHandler.CATMULLROM_FORWARD,!1)}function w(g,n){var z,m,k=new THREE.Geometry;for(z=0;z<g.points.length*n;z++){m=z/(g.points.length*n),m=g.getPoint(m),k.vertices[z]=new THREE.Vertex(new THREE.Vector3(m.x,m.y,m.z))}return k}function v(e,z){var n=w(z,10),k=w(z,10),m=new THREE.LineBasicMaterial({color:16711680,linewidth:3});lineObj=new THREE.Line(n,m);particleObj=new THREE.ParticleSystem(k,new THREE.ParticleBasicMaterial({color:16755200,size:3}));lineObj.scale.set(1,1,1);e.addChild(lineObj);particleObj.scale.set(1,1,1);e.addChild(particleObj);k=new THREE.SphereGeometry(1,16,8);m=new THREE.MeshBasicMaterial({color:65280});for(i=0;i<z.points.length;i++){n=new THREE.Mesh(k,m),n.position.copy(z.points[i]),n.updateMatrix(),e.addChild(n)}}THREE.Camera.call(this,y.fov,y.aspect,y.near,y.far,y.target);this.id="PathCamera"+THREE.PathCameraIdCounter++;this.duration=10000;this.waypoints=[];this.useConstantSpeed=!0;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=0.005;this.lookHorizontal=this.lookVertical=!0;this.verticalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.horizontalAngleMap={srcRange:[0,6.28],dstRange:[0,6.28]};this.domElement=document;if(y){if(y.duration!==void 0){this.duration=y.duration*1000}if(y.waypoints!==void 0){this.waypoints=y.waypoints}if(y.useConstantSpeed!==void 0){this.useConstantSpeed=y.useConstantSpeed}if(y.resamplingCoef!==void 0){this.resamplingCoef=y.resamplingCoef}if(y.createDebugPath!==void 0){this.createDebugPath=y.createDebugPath}if(y.createDebugDummy!==void 0){this.createDebugDummy=y.createDebugDummy}if(y.lookSpeed!==void 0){this.lookSpeed=y.lookSpeed}if(y.lookVertical!==void 0){this.lookVertical=y.lookVertical}if(y.lookHorizontal!==void 0){this.lookHorizontal=y.lookHorizontal}if(y.verticalAngleMap!==void 0){this.verticalAngleMap=y.verticalAngleMap}if(y.horizontalAngleMap!==void 0){this.horizontalAngleMap=y.horizontalAngleMap}if(y.domElement!==void 0){this.domElement=y.domElement}}this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;this.windowHalfX=window.innerWidth/2;this.windowHalfY=window.innerHeight/2;var u=Math.PI*2,p=Math.PI/180;this.update=function(k,A,B){var z,n;this.lookHorizontal&&(this.lon+=this.mouseX*this.lookSpeed);this.lookVertical&&(this.lat-=this.mouseY*this.lookSpeed);this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*p;this.theta=this.lon*p;z=this.phi%u;this.phi=z>=0?z:z+u;z=this.verticalAngleMap.srcRange;n=this.verticalAngleMap.dstRange;var g=n[1]-n[0];this.phi=TWEEN.Easing.Quadratic.EaseInOut(((this.phi-z[0])*(n[1]-n[0])/(z[1]-z[0])+n[0]-n[0])/g)*g+n[0];z=this.horizontalAngleMap.srcRange;n=this.horizontalAngleMap.dstRange;g=n[1]-n[0];this.theta=TWEEN.Easing.Quadratic.EaseInOut(((this.theta-z[0])*(n[1]-n[0])/(z[1]-z[0])+n[0]-n[0])/g)*g+n[0];z=this.target.position;z.x=100*Math.sin(this.phi)*Math.cos(this.theta);z.y=100*Math.cos(this.phi);z.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.supr.update.call(this,k,A,B)};this.onMouseMove=function(c){this.mouseX=c.clientX-this.windowHalfX;this.mouseY=c.clientY-this.windowHalfY};this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var y=new THREE.MeshLambertMaterial({color:30719}),t=new THREE.MeshLambertMaterial({color:65280}),o=new THREE.CubeGeometry(10,10,20),j=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(o,y);y=new THREE.Mesh(j,t);y.position.set(0,10,0);this.animation=x(this.animationParent,this.spline,this.id,this.duration);this.animationParent.addChild(this);this.animationParent.addChild(this.target);this.animationParent.addChild(y)}else{this.animation=x(this.animationParent,this.spline,this.id,this.duration),this.animationParent.addChild(this.target),this.animationParent.addChild(this)}this.createDebugPath&&v(this.debugPath,this.spline);this.domElement.addEventListener("mousemove",function(c,f){return function(){f.apply(c,arguments)}}(this,this.onMouseMove),!1)};THREE.PathCamera.prototype=new THREE.Camera;THREE.PathCamera.prototype.constructor=THREE.PathCamera;THREE.PathCamera.prototype.supr=THREE.Camera.prototype;THREE.PathCameraIdCounter=0;THREE.FlyCamera=function(e){function f(g,h){return function(){h.apply(g,arguments)}}THREE.Camera.call(this,e.fov,e.aspect,e.near,e.far,e.target);this.tmpQuaternion=new THREE.Quaternion;this.movementSpeed=1;this.rollSpeed=0.005;this.autoForward=this.dragToLook=!1;this.domElement=document;if(e){if(e.movementSpeed!==void 0){this.movementSpeed=e.movementSpeed}if(e.rollSpeed!==void 0){this.rollSpeed=e.rollSpeed}if(e.dragToLook!==void 0){this.dragToLook=e.dragToLook}if(e.autoForward!==void 0){this.autoForward=e.autoForward}if(e.domElement!==void 0){this.domElement=e.domElement}}this.useTarget=!1;this.useQuaternion=!0;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.lastUpdate=-1;this.tdiff=0;this.handleEvent=function(c){if(typeof this[c.type]=="function"){this[c.type](c)}};this.keydown=function(c){if(!c.altKey){switch(c.keyCode){case 16:this.movementSpeedMultiplier=0.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(c){switch(c.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook){this.mouseStatus++}else{switch(c.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}}};this.mousemove=function(h){if(!this.dragToLook||this.mouseStatus>0){var n=this.getContainerDimensions(),m=n.size[0]/2,j=n.size[1]/2;this.moveState.yawLeft=-(h.clientX-n.offset[0]-m)/m;this.moveState.pitchDown=(h.clientY-n.offset[1]-j)/j;this.updateRotationVector()}};this.mouseup=function(c){c.preventDefault();c.stopPropagation();if(this.dragToLook){this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0}else{switch(c.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}}this.updateRotationVector()};this.update=function(){var g=(new Date).getTime();if(this.lastUpdate==-1){this.lastUpdate=g}this.tdiff=(g-this.lastUpdate)/1000;this.lastUpdate=g;var g=this.tdiff*this.movementSpeed,h=this.tdiff*this.rollSpeed;this.translateX(this.moveVector.x*g);this.translateY(this.moveVector.y*g);this.translateZ(this.moveVector.z*g);this.tmpQuaternion.set(this.rotationVector.x*h,this.rotationVector.y*h,this.rotationVector.z*h,1).normalize();this.quaternion.multiplySelf(this.tmpQuaternion);this.matrix.setPosition(this.position);this.matrix.setRotationFromQuaternion(this.quaternion);this.matrixWorldNeedsUpdate=!0;this.supr.update.call(this)};this.updateMovementVector=function(){var c=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-c+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",f(this,this.mousemove),!1);this.domElement.addEventListener("mousedown",f(this,this.mousedown),!1);this.domElement.addEventListener("mouseup",f(this,this.mouseup),!1);window.addEventListener("keydown",f(this,this.keydown),!1);window.addEventListener("keyup",f(this,this.keyup),!1);this.updateMovementVector();this.updateRotationVector()};THREE.FlyCamera.prototype=new THREE.Camera;THREE.FlyCamera.prototype.constructor=THREE.FlyCamera;THREE.FlyCamera.prototype.supr=THREE.Camera.prototype;THREE.RollCamera=function(K,J,I,H){THREE.Camera.call(this,K,J,I,H);this.mouseLook=!0;this.autoForward=!1;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-0.9,0.9];this.domElement=document;this.matrixAutoUpdate=this.useTarget=!1;this.forward=new THREE.Vector3(0,0,1);this.roll=0;this.lastUpdate=-1;this.delta=0;var G=new THREE.Vector3,E=new THREE.Vector3,F=new THREE.Vector3,D=new THREE.Matrix4,C=!1,z=1,x=0,O=0,M=0,N=0,L=0,j=window.innerWidth/2,y=window.innerHeight/2;this.update=function(){var c=(new Date).getTime();if(this.lastUpdate==-1){this.lastUpdate=c}this.delta=(c-this.lastUpdate)/1000;this.lastUpdate=c;this.mouseLook&&(c=this.delta*this.lookSpeed,this.rotateHorizontally(c*N),this.rotateVertically(c*L));c=this.delta*this.movementSpeed;this.translateZ(c*(x>0||this.autoForward&&!(x<0)?1:x));this.translateX(c*O);this.translateY(c*M);C&&(this.roll+=this.rollSpeed*this.delta*z);if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1],this.forward.normalize()}else{if(this.forward.y<this.constrainVertical[0]){this.forward.y=this.constrainVertical[0],this.forward.normalize()}}F.copy(this.forward);E.set(0,1,0);G.cross(E,F).normalize();E.cross(F,G).normalize();this.matrix.n11=G.x;this.matrix.n12=E.x;this.matrix.n13=F.x;this.matrix.n21=G.y;this.matrix.n22=E.y;this.matrix.n23=F.y;this.matrix.n31=G.z;this.matrix.n32=E.z;this.matrix.n33=F.z;D.identity();D.n11=Math.cos(this.roll);D.n12=-Math.sin(this.roll);D.n21=Math.sin(this.roll);D.n22=Math.cos(this.roll);this.matrix.multiplySelf(D);this.matrixWorldNeedsUpdate=!0;this.matrix.n14=this.position.x;this.matrix.n24=this.position.y;this.matrix.n34=this.position.z;this.supr.update.call(this)};this.translateX=function(c){this.position.x+=this.matrix.n11*c;this.position.y+=this.matrix.n21*c;this.position.z+=this.matrix.n31*c};this.translateY=function(c){this.position.x+=this.matrix.n12*c;this.position.y+=this.matrix.n22*c;this.position.z+=this.matrix.n32*c};this.translateZ=function(c){this.position.x-=this.matrix.n13*c;this.position.y-=this.matrix.n23*c;this.position.z-=this.matrix.n33*c};this.rotateHorizontally=function(c){G.set(this.matrix.n11,this.matrix.n21,this.matrix.n31);G.multiplyScalar(c);this.forward.subSelf(G);this.forward.normalize()};this.rotateVertically=function(c){E.set(this.matrix.n12,this.matrix.n22,this.matrix.n32);E.multiplyScalar(c);this.forward.addSelf(E);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",function(c){N=(c.clientX-j)/window.innerWidth;L=(c.clientY-y)/window.innerHeight},!1);this.domElement.addEventListener("mousedown",function(c){c.preventDefault();c.stopPropagation();switch(c.button){case 0:x=1;break;case 2:x=-1}},!1);this.domElement.addEventListener("mouseup",function(c){c.preventDefault();c.stopPropagation();switch(c.button){case 0:x=0;break;case 2:x=0}},!1);this.domElement.addEventListener("keydown",function(c){switch(c.keyCode){case 38:case 87:x=1;break;case 37:case 65:O=-1;break;case 40:case 83:x=-1;break;case 39:case 68:O=1;break;case 81:C=!0;z=1;break;case 69:C=!0;z=-1;break;case 82:M=1;break;case 70:M=-1}},!1);this.domElement.addEventListener("keyup",function(c){switch(c.keyCode){case 38:case 87:x=0;break;case 37:case 65:O=0;break;case 40:case 83:x=0;break;case 39:case 68:O=0;break;case 81:C=!1;break;case 69:C=!1;break;case 82:M=0;break;case 70:M=0}},!1)};THREE.RollCamera.prototype=new THREE.Camera;THREE.RollCamera.prototype.constructor=THREE.RollCamera;THREE.RollCamera.prototype.supr=THREE.Camera.prototype;THREE.TrackballCamera=function(C){function B(c,f){return function(){f.apply(c,arguments)}}C=C||{};THREE.Camera.call(this,C.fov,C.aspect,C.near,C.far,C.target);this.domElement=C.domElement||document;this.screen=C.screen||{width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0};this.radius=C.radius||(this.screen.width+this.screen.height)/4;this.rotateSpeed=C.rotateSpeed||1;this.zoomSpeed=C.zoomSpeed||1.2;this.panSpeed=C.panSpeed||0.3;this.noZoom=C.noZoom||!1;this.noPan=C.noPan||!1;this.staticMoving=C.staticMoving||!1;this.dynamicDampingFactor=C.dynamicDampingFactor||0.2;this.minDistance=C.minDistance||0;this.maxDistance=C.maxDistance||Infinity;this.keys=C.keys||[65,83,68];this.useTarget=!0;var A=!1,z=this.STATE.NONE,y=new THREE.Vector3,w=new THREE.Vector3,x=new THREE.Vector3,v=new THREE.Vector2,u=new THREE.Vector2,t=new THREE.Vector2,j=new THREE.Vector2;this.handleEvent=function(c){if(typeof this[c.type]=="function"){this[c.type](c)}};this.getMouseOnScreen=function(c,f){return new THREE.Vector2((c-this.screen.offsetLeft)/this.radius*0.5,(f-this.screen.offsetTop)/this.radius*0.5)};this.getMouseProjectionOnBall=function(g,k){var m=new THREE.Vector3((g-this.screen.width*0.5-this.screen.offsetLeft)/this.radius,(this.screen.height*0.5+this.screen.offsetTop-k)/this.radius,0),h=m.length();h>1?m.normalize():m.z=Math.sqrt(1-h*h);y=this.position.clone().subSelf(this.target.position);h=this.up.clone().setLength(m.y);h.addSelf(this.up.clone().crossSelf(y).setLength(m.x));h.addSelf(y.setLength(m.z));return h};this.rotateCamera=function(){var f=Math.acos(w.dot(x)/w.length()/x.length());if(f){var g=(new THREE.Vector3).cross(w,x).normalize(),h=new THREE.Quaternion;f*=this.rotateSpeed;h.setFromAxisAngle(g,-f);h.multiplyVector3(y);h.multiplyVector3(this.up);h.multiplyVector3(x);this.staticMoving?w=x:(h.setFromAxisAngle(g,f*(this.dynamicDampingFactor-1)),h.multiplyVector3(w))}};this.zoomCamera=function(){var c=1+(u.y-v.y)*this.zoomSpeed;c!==1&&c>0&&(y.multiplyScalar(c),this.staticMoving?v=u:v.y+=(u.y-v.y)*this.dynamicDampingFactor)};this.panCamera=function(){var c=j.clone().subSelf(t);if(c.lengthSq()){c.multiplyScalar(y.length()*this.panSpeed);var f=y.clone().crossSelf(this.up).setLength(c.x);f.addSelf(this.up.clone().setLength(c.y));this.position.addSelf(f);this.target.position.addSelf(f);this.staticMoving?t=j:t.addSelf(c.sub(j,t).multiplyScalar(this.dynamicDampingFactor))}};this.checkDistances=function(){if(!this.noZoom||!this.noPan){this.position.lengthSq()>this.maxDistance*this.maxDistance&&this.position.setLength(this.maxDistance),y.lengthSq()<this.minDistance*this.minDistance&&this.position.add(this.target.position,y.setLength(this.minDistance))}};this.update=function(f,g,h){y=this.position.clone().subSelf(this.target.position);this.rotateCamera();this.noZoom||this.zoomCamera();this.noPan||this.panCamera();this.position.add(this.target.position,y);this.checkDistances();this.supr.update.call(this,f,g,h)};this.domElement.addEventListener("contextmenu",function(c){c.preventDefault()},!1);this.domElement.addEventListener("mousemove",B(this,function(c){A&&(w=x=this.getMouseProjectionOnBall(c.clientX,c.clientY),v=u=this.getMouseOnScreen(c.clientX,c.clientY),t=j=this.getMouseOnScreen(c.clientX,c.clientY),A=!1);z!==this.STATE.NONE&&(z===this.STATE.ROTATE?x=this.getMouseProjectionOnBall(c.clientX,c.clientY):z===this.STATE.ZOOM&&!this.noZoom?u=this.getMouseOnScreen(c.clientX,c.clientY):z===this.STATE.PAN&&!this.noPan&&(j=this.getMouseOnScreen(c.clientX,c.clientY)))}),!1);this.domElement.addEventListener("mousedown",B(this,function(c){c.preventDefault();c.stopPropagation();if(z===this.STATE.NONE){z=c.button,z===this.STATE.ROTATE?w=x=this.getMouseProjectionOnBall(c.clientX,c.clientY):z===this.STATE.ZOOM&&!this.noZoom?v=u=this.getMouseOnScreen(c.clientX,c.clientY):this.noPan||(t=j=this.getMouseOnScreen(c.clientX,c.clientY))}}),!1);this.domElement.addEventListener("mouseup",B(this,function(c){c.preventDefault();c.stopPropagation();z=this.STATE.NONE}),!1);window.addEventListener("keydown",B(this,function(c){if(z===this.STATE.NONE){if(c.keyCode===this.keys[this.STATE.ROTATE]){z=this.STATE.ROTATE}else{if(c.keyCode===this.keys[this.STATE.ZOOM]&&!this.noZoom){z=this.STATE.ZOOM}else{if(c.keyCode===this.keys[this.STATE.PAN]&&!this.noPan){z=this.STATE.PAN}}}z!==this.STATE.NONE&&(A=!0)}}),!1);window.addEventListener("keyup",B(this,function(){if(z!==this.STATE.NONE){z=this.STATE.NONE}}),!1)};THREE.TrackballCamera.prototype=new THREE.Camera;THREE.TrackballCamera.prototype.constructor=THREE.TrackballCamera;THREE.TrackballCamera.prototype.supr=THREE.Camera.prototype;THREE.TrackballCamera.prototype.STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};THREE.QuakeCamera=THREE.FirstPersonCamera;THREE.CubeGeometry=function(I,H,G,F,E,C,D,A,z){function y(ae,ac,ad,ab,Y,X,W,S){var R,Q,P=F||1,U=E||1,O=Y/2,k=X/2,aa=x.vertices.length;if(ae=="x"&&ac=="y"||ae=="y"&&ac=="x"){R="z"}else{if(ae=="x"&&ac=="z"||ae=="z"&&ac=="x"){R="y",U=C||1}else{if(ae=="z"&&ac=="y"||ae=="y"&&ac=="z"){R="x",P=C||1}}}var V=P+1,g=U+1;Y/=P;var f=X/U;for(Q=0;Q<g;Q++){for(X=0;X<V;X++){var p=new THREE.Vector3;p[ae]=(X*Y-O)*ad;p[ac]=(Q*f-k)*ab;p[R]=W;x.vertices.push(new THREE.Vertex(p))}}for(Q=0;Q<U;Q++){for(X=0;X<P;X++){x.faces.push(new THREE.Face4(X+V*Q+aa,X+V*(Q+1)+aa,X+1+V*(Q+1)+aa,X+1+V*Q+aa,null,null,S)),x.faceVertexUvs[0].push([new THREE.UV(X/P,Q/U),new THREE.UV(X/P,(Q+1)/U),new THREE.UV((X+1)/P,(Q+1)/U),new THREE.UV((X+1)/P,Q/U)])}}}THREE.Geometry.call(this);var x=this,M=I/2,K=H/2,L=G/2,A=A?-1:1;if(D!==void 0){if(D instanceof Array){this.materials=D}else{this.materials=[];for(var J=0;J<6;J++){this.materials.push([D])}}}else{this.materials=[]}this.sides={px:!0,nx:!0,py:!0,ny:!0,pz:!0,nz:!0};if(z!=void 0){for(var j in z){this.sides[j]!=void 0&&(this.sides[j]=z[j])}}this.sides.px&&y("z","y",1*A,-1,G,H,-M,this.materials[0]);this.sides.nx&&y("z","y",-1*A,-1,G,H,M,this.materials[1]);this.sides.py&&y("x","z",1*A,1,I,G,K,this.materials[2]);this.sides.ny&&y("x","z",1*A,-1,I,G,-K,this.materials[3]);this.sides.pz&&y("x","y",1*A,-1,I,H,L,this.materials[4]);this.sides.nz&&y("x","y",-1*A,-1,I,H,-L,this.materials[5]);(function(){for(var O=[],B=[],N=0,w=x.vertices.length;N<w;N++){for(var u=x.vertices[N],v=!1,t=0,p=O.length;t<p;t++){var o=O[t];if(u.position.x==o.position.x&&u.position.y==o.position.y&&u.position.z==o.position.z){B[N]=t;v=!0;break}}if(!v){B[N]=O.length,O.push(new THREE.Vertex(u.position.clone()))}}N=0;for(w=x.faces.length;N<w;N++){u=x.faces[N],u.a=B[u.a],u.b=B[u.b],u.c=B[u.c],u.d=B[u.d]}x.vertices=O})();this.computeCentroids();this.computeFaceNormals()};THREE.CubeGeometry.prototype=new THREE.Geometry;THREE.CubeGeometry.prototype.constructor=THREE.CubeGeometry;THREE.CylinderGeometry=function(D,C,B,A,z,x){function y(f,g,h){w.vertices.push(new THREE.Vertex(new THREE.Vector3(f,g,h)))}THREE.Geometry.call(this);var w=this,v,u=Math.PI*2,j=A/2;for(v=0;v<D;v++){y(Math.sin(u*v/D)*C,Math.cos(u*v/D)*C,-j)}for(v=0;v<D;v++){y(Math.sin(u*v/D)*B,Math.cos(u*v/D)*B,j)}for(v=0;v<D;v++){w.faces.push(new THREE.Face4(v,v+D,D+(v+1)%D,(v+1)%D))}if(B>0){y(0,0,-j-(x||0));for(v=D;v<D+D/2;v++){w.faces.push(new THREE.Face4(2*D,(2*v-2*D)%D,(2*v-2*D+1)%D,(2*v-2*D+2)%D))}}if(C>0){y(0,0,j+(z||0));for(v=D+D/2;v<2*D;v++){w.faces.push(new THREE.Face4(2*D+1,(2*v-2*D+2)%D+D,(2*v-2*D+1)%D+D,(2*v-2*D)%D+D))}}v=0;for(D=this.faces.length;v<D;v++){var C=[],B=this.faces[v],z=this.vertices[B.a],x=this.vertices[B.b],j=this.vertices[B.c],E=this.vertices[B.d];C.push(new THREE.UV(0.5+Math.atan2(z.position.x,z.position.y)/u,0.5+z.position.z/A));C.push(new THREE.UV(0.5+Math.atan2(x.position.x,x.position.y)/u,0.5+x.position.z/A));C.push(new THREE.UV(0.5+Math.atan2(j.position.x,j.position.y)/u,0.5+j.position.z/A));B instanceof THREE.Face4&&C.push(new THREE.UV(0.5+Math.atan2(E.position.x,E.position.y)/u,0.5+E.position.z/A));this.faceVertexUvs[0].push(C)}this.computeCentroids();this.computeFaceNormals()};THREE.CylinderGeometry.prototype=new THREE.Geometry;THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;THREE.IcosahedronGeometry=function(C){function B(g,k,m){var h=Math.sqrt(g*g+k*k+m*m);return y.vertices.push(new THREE.Vertex(new THREE.Vector3(g/h,k/h,m/h)))-1}function A(g,k,m,h){h.faces.push(new THREE.Face3(g,k,m))}function z(c,m){var k=y.vertices[c].position,g=y.vertices[m].position;return B((k.x+g.x)/2,(k.y+g.y)/2,(k.z+g.z)/2)}var y=this,w=new THREE.Geometry,x;this.subdivisions=C||0;THREE.Geometry.call(this);C=(1+Math.sqrt(5))/2;B(-1,C,0);B(1,C,0);B(-1,-C,0);B(1,-C,0);B(0,-1,C);B(0,1,C);B(0,-1,-C);B(0,1,-C);B(C,0,-1);B(C,0,1);B(-C,0,-1);B(-C,0,1);A(0,11,5,w);A(0,5,1,w);A(0,1,7,w);A(0,7,10,w);A(0,10,11,w);A(1,5,9,w);A(5,11,4,w);A(11,10,2,w);A(10,7,6,w);A(7,1,8,w);A(3,9,4,w);A(3,4,2,w);A(3,2,6,w);A(3,6,8,w);A(3,8,9,w);A(4,9,5,w);A(2,4,11,w);A(6,2,10,w);A(8,6,7,w);A(9,8,1,w);for(C=0;C<this.subdivisions;C++){x=new THREE.Geometry;for(var v in w.faces){var u=z(w.faces[v].a,w.faces[v].b),t=z(w.faces[v].b,w.faces[v].c),j=z(w.faces[v].c,w.faces[v].a);A(w.faces[v].a,u,j,x);A(w.faces[v].b,t,u,x);A(w.faces[v].c,j,t,x);A(u,t,j,x)}w.faces=x.faces}y.faces=w.faces;delete w;delete x;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.IcosahedronGeometry.prototype=new THREE.Geometry;THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.LatheGeometry=function(y,x,w){THREE.Geometry.call(this);this.steps=x||12;this.angle=w||2*Math.PI;for(var x=this.angle/this.steps,w=[],v=[],u=[],p=[],t=(new THREE.Matrix4).setRotationZ(x),o=0;o<y.length;o++){this.vertices.push(new THREE.Vertex(y[o])),w[o]=y[o].clone(),v[o]=this.vertices.length-1}for(var j=0;j<=this.angle+0.001;j+=x){for(o=0;o<w.length;o++){j<this.angle?(w[o]=t.multiplyVector3(w[o].clone()),this.vertices.push(new THREE.Vertex(w[o])),u[o]=this.vertices.length-1):u=p}j==0&&(p=v);for(o=0;o<v.length-1;o++){this.faces.push(new THREE.Face4(u[o],u[o+1],v[o+1],v[o])),this.faceVertexUvs[0].push([new THREE.UV(1-j/this.angle,o/y.length),new THREE.UV(1-j/this.angle,(o+1)/y.length),new THREE.UV(1-(j-x)/this.angle,(o+1)/y.length),new THREE.UV(1-(j-x)/this.angle,o/y.length)])}v=u;u=[]}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=new THREE.Geometry;THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;THREE.PlaneGeometry=function(A,z,y,x){THREE.Geometry.call(this);var w,u=A/2,v=z/2,y=y||1,x=x||1,t=y+1,p=x+1;A/=y;var j=z/x;for(w=0;w<p;w++){for(z=0;z<t;z++){this.vertices.push(new THREE.Vertex(new THREE.Vector3(z*A-u,-(w*j-v),0)))}}for(w=0;w<x;w++){for(z=0;z<y;z++){this.faces.push(new THREE.Face4(z+t*w,z+t*(w+1),z+1+t*(w+1),z+1+t*w)),this.faceVertexUvs[0].push([new THREE.UV(z/y,w/x),new THREE.UV(z/y,(w+1)/x),new THREE.UV((z+1)/y,(w+1)/x),new THREE.UV((z+1)/y,w/x)])}}this.computeCentroids();this.computeFaceNormals()};THREE.PlaneGeometry.prototype=new THREE.Geometry;THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;THREE.SphereGeometry=function(K,J,I){THREE.Geometry.call(this);for(var K=K||50,H,G=Math.PI,E=Math.max(3,J||8),F=Math.max(2,I||6),J=[],I=0;I<F+1;I++){H=I/F;var D=K*Math.cos(H*G),C=K*Math.sin(H*G),z=[],x=0;for(H=0;H<E;H++){var O=2*H/E,M=C*Math.sin(O*G),O=C*Math.cos(O*G);(I==0||I==F)&&H>0||(x=this.vertices.push(new THREE.Vertex(new THREE.Vector3(O,D,M)))-1);z.push(x)}J.push(z)}for(var N,L,j,G=J.length,I=0;I<G;I++){if(E=J[I].length,I>0){for(H=0;H<E;H++){z=H==E-1;F=J[I][z?0:H+1];D=J[I][z?E-1:H];C=J[I-1][z?E-1:H];z=J[I-1][z?0:H+1];M=I/(G-1);N=(I-1)/(G-1);L=(H+1)/E;var O=H/E,x=new THREE.UV(1-L,M),M=new THREE.UV(1-O,M),O=new THREE.UV(1-O,N),y=new THREE.UV(1-L,N);I<J.length-1&&(N=this.vertices[F].position.clone(),L=this.vertices[D].position.clone(),j=this.vertices[C].position.clone(),N.normalize(),L.normalize(),j.normalize(),this.faces.push(new THREE.Face3(F,D,C,[new THREE.Vector3(N.x,N.y,N.z),new THREE.Vector3(L.x,L.y,L.z),new THREE.Vector3(j.x,j.y,j.z)])),this.faceVertexUvs[0].push([x,M,O]));I>1&&(N=this.vertices[F].position.clone(),L=this.vertices[C].position.clone(),j=this.vertices[z].position.clone(),N.normalize(),L.normalize(),j.normalize(),this.faces.push(new THREE.Face3(F,C,z,[new THREE.Vector3(N.x,N.y,N.z),new THREE.Vector3(L.x,L.y,L.z),new THREE.Vector3(j.x,j.y,j.z)])),this.faceVertexUvs[0].push([x,O,y]))}}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals();this.boundingSphere={radius:K}};THREE.SphereGeometry.prototype=new THREE.Geometry;THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;THREE.TextGeometry=function(e,f){THREE.Geometry.call(this);this.parameters=f||{};this.set(e)};THREE.TextGeometry.prototype=new THREE.Geometry;THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;THREE.TextGeometry.prototype.set=function(Q,P){function O(f,g,h){x.vertices.push(new THREE.Vertex(new THREE.Vector3(f,g,h)))}function N(g,k,m,h){x.faces.push(new THREE.Face4(g,k,m,h))}this.text=Q;var P=P||this.parameters,M=P.height!==void 0?P.height:50,K=P.curveSegments!==void 0?P.curveSegments:4,L=P.font!==void 0?P.font:"helvetiker",J=P.weight!==void 0?P.weight:"normal",I=P.style!==void 0?P.style:"normal",H=P.bezelThickness!==void 0?P.bezelThickness:10,G=P.bezelSize!==void 0?P.bezelSize:8,D=P.bezelEnabled!==void 0?P.bezelEnabled:!1;THREE.FontUtils.size=P.size!==void 0?P.size:100;THREE.FontUtils.divisions=K;THREE.FontUtils.face=L;THREE.FontUtils.weight=J;THREE.FontUtils.style=I;THREE.FontUtils.bezelSize=G;var J=THREE.FontUtils.drawText(Q),K=J.points,z=J.faces,L=J.contour,C=J.bezel,x=this;x.vertices=[];x.faces=[];for(var E,I=K.length,F=z.length,G=C.length,J=0;J<I;J++){E=K[J],O(E.x,E.y,0)}for(J=0;J<I;J++){E=K[J],O(E.x,E.y,M)}if(D){for(J=0;J<G;J++){E=C[J],O(E.x,E.y,H)}for(J=0;J<G;J++){E=C[J],O(E.x,E.y,M-H)}}for(J=0;J<F;J++){M=z[J],x.faces.push(new THREE.Face3(M[2],M[1],M[0]))}for(J=0;J<F;J++){M=z[J],x.faces.push(new THREE.Face3(M[0]+I,M[1]+I,M[2]+I))}var j;if(D){for(J=C.length;--J>0;){if(j){if(j.equals(L[J])){j=null;continue}}else{j=L[J]}H=I*2+J;z=H-1;N(H,z,z+G,H+G);for(D=0;D<I;D++){if(K[D].equals(L[J])){break}}for(M=0;M<I;M++){if(K[M].equals(L[J-1])){break}}N(D,M,z,H);N(H+G,z+G,M+I,D+I)}}else{for(J=L.length;--J>0;){if(j){if(j.equals(L[J])){j=null;continue}}else{j=L[J]}for(D=0;D<I;D++){if(K[D].equals(L[J])){break}}for(M=0;M<I;M++){if(K[M].equals(L[J-1])){break}}N(D,M,M+I,D+I)}}this.computeCentroids();this.computeFaceNormals()};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var f=e.familyName.toLowerCase();this.faces[f]=this.faces[f]||{};this.faces[f][e.cssFontWeight]=this.faces[f][e.cssFontWeight]||{};this.faces[f][e.cssFontWeight][e.cssFontStyle]=e;return this.faces[f][e.cssFontWeight][e.cssFontStyle]=e},extractPoints:function(W,V){if(W.length<3){return console.log("not valid polygon"),{points:W,faces:[]}}for(var U,T,S,Q,R,P=[],O=0;O<V.length;O++){R=V[O];Q=[];for(U=0;U<R.length;U++){T=R[U],Q.push(T.x+","+T.y)}var N;U=Q.slice(1).indexOf(Q[0]);var M=this.Triangulate.area(R.slice(0,U+1))<0;T=[];for(U=-1;U<Q.length;){N=U+1;U=Q[N];U=Q.slice(N+1).indexOf(U)+N;if(U<=N){break}var I=R.slice(N,U+1);M?this.Triangulate.area(I)<0?(N>0&&P.push({shape:S,holes:T}),S=I,T=[]):T.push(I):this.Triangulate.area(I)<0?(P.push({shape:I,holes:T}),T=[]):T.push(I);U++}M&&P.push({shape:S,holes:T})}var F,H,D,K,L,x;Q=[];for(R=0;R<P.length;R++){O=P[R];S=O.shape;T=O.holes;for(N=0;N<T.length;N++){M=T[N];D=Number.POSITIVE_INFINITY;for(I=0;I<M.length;I++){L=M[I];for(U=0;U<S.length;U++){K=S[U],K=L.distanceTo(K),K<D&&(D=K,F=I,H=U)}}U=H-1>=0?H-1:S.length-1;var I=F-1>=0?F-1:M.length-1,E=[];E.push(M[F]);E.push(S[H]);E.push(S[U]);D=this.Triangulate.area(E);var j=[];j.push(M[F]);j.push(M[I]);j.push(S[H]);L=this.Triangulate.area(j);K=H;x=F;H+=1;F+=-1;H<0&&(H+=S.length);H%=S.length;F<0&&(F+=M.length);F%=S.length;U=H-1>=0?H-1:S.length-1;I=F-1>=0?F-1:M.length-1;E=[];E.push(M[F]);E.push(S[H]);E.push(S[U]);E=this.Triangulate.area(E);j=[];j.push(M[F]);j.push(M[I]);j.push(S[H]);j=this.Triangulate.area(j);D+L>E+j&&(H=K,F=x,H<0&&(H+=S.length),H%=S.length,F<0&&(F+=M.length),F%=S.length,U=H-1>=0?H-1:S.length-1,I=F-1>=0?F-1:M.length-1);D=S.slice(0,H);L=S.slice(H);K=M.slice(F);x=M.slice(0,F);Q.push(M[F]);Q.push(S[H]);Q.push(S[U]);Q.push(M[F]);Q.push(M[I]);Q.push(S[H]);S=D.concat(K).concat(x).concat(L)}O.shape=S}F=[];H=[];for(R=N=0;R<P.length;R++){O=P[R];S=O.shape;F=F.concat(S);M=THREE.FontUtils.Triangulate(S,!0);for(T=0;T<M.length;T++){O=M[T],O[0]+=N,O[1]+=N,O[2]+=N}H=H.concat(M);N+=S.length}var J;for(T=0;T<Q.length/3;T++){O=[];for(P=0;P<3;P++){R=!1;for(S=0;S<F.length&&!R;S++){J=T*3+P,F[S].equals(Q[J])&&(O.push(S),R=!0)}R||(F.push(Q[J]),O.push(F.length-1),console.log("not found"))}H.push(O)}return{points:F,faces:H}},drawText:function(C){var B=[],A=[],z,y=this.getFace(),w=this.size/y.resolution,x=0;z=String(C).split("");for(var v=z.length,C=0;C<v;C++){var u=this.extractGlyphPoints(z[C],y,w,x);x+=u.offset;B.push(u.points);A=A.concat(u.points)}C=x/2;for(z=0;z<A.length;z++){A[z].x-=C}B=this.extractPoints(A,B);B.contour=A;y=[];w=[];z=[];for(var x=[],v=new THREE.Vector2,t,C=A.length;--C>=0;){if(t){if(t.equals(A[C])){t=null;u=this.Triangulate.area(z)>0;x.push(u);w.push(v.divideScalar(z.length));z=[];v=new THREE.Vector2;continue}}else{t=A[C]}v.addSelf(A[C]);z.push(A[C])}C=A.length;z=0;for(var j;--C>=0;){u=A[C],v=w[z],u=u.clone().subSelf(v),j=this.bezelSize/u.length(),x[z]?j+=1:j=1-j,j=u.multiplyScalar(j).addSelf(v),y.unshift(j),t?t.equals(A[C])&&(t=null,z++):t=A[C]}B.bezel=y;return B},b2p0:function(f,h){var g=1-f;return g*g*h},b2p1:function(e,f){return 2*(1-e)*e*f},b2p2:function(e,f){return e*e*f},b2:function(g,k,j,h){return this.b2p0(g,k)+this.b2p1(g,j)+this.b2p2(g,h)},b3p0:function(f,h){var g=1-f;return g*g*g*h},b3p1:function(f,h){var g=1-f;return 3*g*g*f*h},b3p2:function(e,f){return 3*(1-e)*e*e*f},b3p3:function(e,f){return e*e*e*f},b3:function(h,n,m,k,j){return this.b3p0(h,n)+this.b3p1(h,m)+this.b3p2(h,k)+this.b3p3(h,j)},extractGlyphPoints:function(Q,P,O,N){var M=[],K,L,J,I,H,G,D,z,C,x,E=P.glyphs[Q]||P.glyphs[ctxt.options.fallbackCharacter];if(E){if(E.o){P=E._cachedOutline||(E._cachedOutline=E.o.split(" "));J=P.length;for(Q=0;Q<J;){switch(L=P[Q++],L){case"m":L=P[Q++]*O+N;I=P[Q++]*O;M.push(new THREE.Vector2(L,I));break;case"l":L=P[Q++]*O+N;I=P[Q++]*O;M.push(new THREE.Vector2(L,I));break;case"q":L=P[Q++]*O+N;I=P[Q++]*O;D=P[Q++]*O+N;z=P[Q++]*O;if(K=M[M.length-1]){H=K.x;G=K.y;K=1;for(divisions=this.divisions;K<=divisions;K++){var F=K/divisions,j=THREE.FontUtils.b2(F,H,D,L),F=THREE.FontUtils.b2(F,G,z,I);M.push(new THREE.Vector2(j,F))}}break;case"b":if(L=P[Q++]*O+N,I=P[Q++]*O,D=P[Q++]*O+N,z=P[Q++]*-O,C=P[Q++]*O+N,x=P[Q++]*-O,K=M[M.length-1]){H=K.x;G=K.y;K=1;for(divisions=this.divisions;K<=divisions;K++){F=K/divisions,j=THREE.FontUtils.b3(F,H,D,C,L),F=THREE.FontUtils.b3(F,G,z,x,I),M.push(new THREE.Vector2(j,F))}}}}}return{offset:E.ha*O,points:M}}}};(function(e){var f=function(j){for(var p=j.length,o=0,m=p-1,n=0;n<p;m=n++){o+=j[m].x*j[n].y-j[n].x*j[m].y}return o*0.5};e.Triangulate=function(aA,az){var ay=aA.length;if(ay<3){return null}var av=[],ax=[],au=[],at,ar,aq;if(f(aA)>0){for(ar=0;ar<ay;ar++){ax[ar]=ar}}else{for(ar=0;ar<ay;ar++){ax[ar]=ay-1-ar}}var ap=2*ay;for(ar=ay-1;ay>2;){if(ap--<=0){console.log("Warning, unable to triangulate polygon!");if(az){return au}return av}at=ar;ay<=at&&(at=0);ar=at+1;ay<=ar&&(ar=0);aq=ar+1;ay<=aq&&(aq=0);var an;a:{an=aA;var ao=at,am=ar,ae=aq,af=ay,al=ax,Y=void 0,ak=void 0,ad=void 0,W=void 0,ac=void 0,O=void 0,U=void 0,ab=void 0,V=void 0,ak=an[al[ao]].x,ad=an[al[ao]].y,W=an[al[am]].x,ac=an[al[am]].y,O=an[al[ae]].x,U=an[al[ae]].y;if(1e-10>(W-ak)*(U-ad)-(ac-ad)*(O-ak)){an=!1}else{for(Y=0;Y<af;Y++){if(!(Y==ao||Y==am||Y==ae)){var ab=an[al[Y]].x,V=an[al[Y]].y,M=void 0,R=void 0,c=void 0,aw=void 0,ai=void 0,L=void 0,x=void 0,P=void 0,ah=void 0,E=void 0,ag=void 0,aj=void 0,M=c=ai=void 0,M=O-W,R=U-ac,c=ak-O,aw=ad-U,ai=W-ak,L=ac-ad,x=ab-ak,P=V-ad,ah=ab-W,E=V-ac,ag=ab-O,aj=V-U,M=M*E-R*ah,ai=ai*P-L*x,c=c*aj-aw*ag;if(M>=0&&c>=0&&ai>=0){an=!1;break a}}}an=!0}}if(an){ap=ax[at];an=ax[ar];ao=ax[aq];av.push(aA[ap]);av.push(aA[an]);av.push(aA[ao]);au.push([ax[at],ax[ar],ax[aq]]);at=ar;for(aq=ar+1;aq<ay;at++,aq++){ax[at]=ax[aq]}ay--;ap=2*ay}}if(az){return au}return av};e.Triangulate.area=f;return e})(THREE.FontUtils);window._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.TorusGeometry=function(j,u,t,p){THREE.Geometry.call(this);this.radius=j||100;this.tube=u||40;this.segmentsR=t||8;this.segmentsT=p||6;j=[];for(u=0;u<=this.segmentsR;++u){for(t=0;t<=this.segmentsT;++t){var p=t/this.segmentsT*2*Math.PI,o=u/this.segmentsR*2*Math.PI;this.vertices.push(new THREE.Vertex(new THREE.Vector3((this.radius+this.tube*Math.cos(o))*Math.cos(p),(this.radius+this.tube*Math.cos(o))*Math.sin(p),this.tube*Math.sin(o))));j.push([t/this.segmentsT,1-u/this.segmentsR])}}for(u=1;u<=this.segmentsR;++u){for(t=1;t<=this.segmentsT;++t){var p=(this.segmentsT+1)*u+t,o=(this.segmentsT+1)*u+t-1,m=(this.segmentsT+1)*(u-1)+t-1,n=(this.segmentsT+1)*(u-1)+t;this.faces.push(new THREE.Face4(p,o,m,n));this.faceVertexUvs[0].push([new THREE.UV(j[p][0],j[p][1]),new THREE.UV(j[o][0],j[o][1]),new THREE.UV(j[m][0],j[m][1]),new THREE.UV(j[n][0],j[n][1])])}}delete j;this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusGeometry.prototype=new THREE.Geometry;THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;THREE.TorusKnotGeometry=function(C,B,A,z,y,w,x){function v(k,p,D,o,m,n){p=D/o*k;D=Math.cos(p);return new THREE.Vector3(m*(2+D)*0.5*Math.cos(k),m*(2+D)*Math.sin(k)*0.5,n*m*Math.sin(p)*0.5)}THREE.Geometry.call(this);this.radius=C||200;this.tube=B||40;this.segmentsR=A||64;this.segmentsT=z||8;this.p=y||2;this.q=w||3;this.heightScale=x||1;this.grid=Array(this.segmentsR);A=new THREE.Vector3;z=new THREE.Vector3;w=new THREE.Vector3;for(C=0;C<this.segmentsR;++C){this.grid[C]=Array(this.segmentsT);for(B=0;B<this.segmentsT;++B){var u=C/this.segmentsR*2*this.p*Math.PI,x=B/this.segmentsT*2*Math.PI,y=v(u,x,this.q,this.p,this.radius,this.heightScale),u=v(u+0.01,x,this.q,this.p,this.radius,this.heightScale);A.x=u.x-y.x;A.y=u.y-y.y;A.z=u.z-y.z;z.x=u.x+y.x;z.y=u.y+y.y;z.z=u.z+y.z;w.cross(A,z);z.cross(w,A);w.normalize();z.normalize();u=-this.tube*Math.cos(x);x=this.tube*Math.sin(x);y.x+=u*z.x+x*w.x;y.y+=u*z.y+x*w.y;y.z+=u*z.z+x*w.z;this.grid[C][B]=this.vertices.push(new THREE.Vertex(new THREE.Vector3(y.x,y.y,y.z)))-1}}for(C=0;C<this.segmentsR;++C){for(B=0;B<this.segmentsT;++B){var z=(C+1)%this.segmentsR,w=(B+1)%this.segmentsT,y=this.grid[C][B],A=this.grid[z][B],z=this.grid[z][w],w=this.grid[C][w],x=new THREE.UV(C/this.segmentsR,B/this.segmentsT),u=new THREE.UV((C+1)/this.segmentsR,B/this.segmentsT),t=new THREE.UV((C+1)/this.segmentsR,(B+1)/this.segmentsT),j=new THREE.UV(C/this.segmentsR,(B+1)/this.segmentsT);this.faces.push(new THREE.Face4(y,A,z,w));this.faceVertexUvs[0].push([x,u,t,j])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusKnotGeometry.prototype=new THREE.Geometry;THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;THREE.Loader=function(c){this.statusDomElement=(this.showStatus=c)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={addStatusElement:function(){var c=document.createElement("div");c.style.position="absolute";c.style.right="0px";c.style.top="0px";c.style.fontSize="0.8em";c.style.textAlign="left";c.style.background="rgba(0,0,0,0.25)";c.style.color="#fff";c.style.width="120px";c.style.padding="0.5em 0.5em 0.5em 0.5em";c.style.zIndex=1000;c.innerHTML="Loading ...";return c},updateProgress:function(e){var f="Loaded ";f+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1000).toFixed(2)+" KB";this.statusDomElement.innerHTML=f},extractUrlbase:function(c){c=c.split("/");c.pop();return c.join("/")},init_materials:function(g,k,j){g.materials=[];for(var h=0;h<k.length;++h){g.materials[h]=[THREE.Loader.prototype.createMaterial(k[h],j)]}},hasNormals:function(g){var k,j,h=g.materials.length;for(j=0;j<h;j++){if(k=g.materials[j][0],k instanceof THREE.MeshShaderMaterial){return !0}}return !1},createMaterial:function(E,D){function C(c){c=Math.log(c)/Math.LN2;return Math.floor(c)==c}function B(e,h){var g=new Image;g.onload=function(){if(!C(this.width)||!C(this.height)){var k=Math.pow(2,Math.round(Math.log(this.width)/Math.LN2)),b=Math.pow(2,Math.round(Math.log(this.height)/Math.LN2));e.image.width=k;e.image.height=b;e.image.getContext("2d").drawImage(this,0,0,k,b)}else{e.image=this}e.needsUpdate=!0};g.src=h}function A(f,v,p,t,o,c){var H=document.createElement("canvas");f[v]=new THREE.Texture(H);f[v].sourceFile=p;if(t){f[v].repeat.set(t[0],t[1]);if(t[0]!=1){f[v].wrapS=THREE.RepeatWrapping}if(t[1]!=1){f[v].wrapT=THREE.RepeatWrapping}}o&&f[v].offset.set(o[0],o[1]);if(c){t={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(t[c[0]]!==void 0){f[v].wrapS=t[c[0]]}if(t[c[1]]!==void 0){f[v].wrapT=t[c[1]]}}B(f[v],D+"/"+p)}function y(c){return(c[0]*255<<16)+(c[1]*255<<8)+c[2]*255}var z,x,w;x="MeshLambertMaterial";z={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:E.wireframe};E.shading&&(E.shading=="Phong"?x="MeshPhongMaterial":E.shading=="Basic"&&(x="MeshBasicMaterial"));if(E.blending){if(E.blending=="Additive"){z.blending=THREE.AdditiveBlending}else{if(E.blending=="Subtractive"){z.blending=THREE.SubtractiveBlending}else{if(E.blending=="Multiply"){z.blending=THREE.MultiplyBlending}}}}if(E.transparent!==void 0||E.opacity<1){z.transparent=E.transparent}if(E.depthTest!==void 0){z.depthTest=E.depthTest}if(E.vertexColors!==void 0){if(E.vertexColors=="face"){z.vertexColors=THREE.FaceColors}else{if(E.vertexColors){z.vertexColors=THREE.VertexColors}}}if(E.colorDiffuse){z.color=y(E.colorDiffuse)}else{if(E.DbgColor){z.color=E.DbgColor}}if(E.colorSpecular){z.specular=y(E.colorSpecular)}if(E.colorAmbient){z.ambient=y(E.colorAmbient)}if(E.transparency){z.opacity=E.transparency}if(E.specularCoef){z.shininess=E.specularCoef}E.mapDiffuse&&D&&A(z,"map",E.mapDiffuse,E.mapDiffuseRepeat,E.mapDiffuseOffset,E.mapDiffuseWrap);E.mapLight&&D&&A(z,"lightMap",E.mapLight,E.mapLightRepeat,E.mapLightOffset,E.mapLightWrap);E.mapNormal&&D&&A(z,"normalMap",E.mapNormal,E.mapNormalRepeat,E.mapNormalOffset,E.mapNormalWrap);if(E.mapNormal){var u=THREE.ShaderUtils.lib.normal,j=THREE.UniformsUtils.clone(u.uniforms),G=z.color;x=z.specular;w=z.ambient;var F=z.shininess;j.tNormal.texture=z.normalMap;if(E.mapNormalFactor){j.uNormalScale.value=E.mapNormalFactor}if(z.map){j.tDiffuse.texture=z.map,j.enableDiffuse.value=!0}j.enableAO.value=!1;j.enableSpecular.value=!1;j.uDiffuseColor.value.setHex(G);j.uSpecularColor.value.setHex(x);j.uAmbientColor.value.setHex(w);j.uShininess.value=F;if(z.opacity){j.uOpacity.value=z.opacity}z=new THREE.MeshShaderMaterial({fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:j,lights:!0})}else{z=new THREE[x](z)}return z}};THREE.JSONLoader=function(c){THREE.Loader.call(this,c)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.supr=THREE.Loader.prototype;THREE.JSONLoader.prototype.load=function(h){var n=this,m=h.model,k=h.callback,j=h.texture_path?h.texture_path:this.extractUrlbase(m),h=new Worker(m);h.onmessage=function(c){n.createModel(c.data,k,j);n.onLoadComplete()};this.onLoadStart();h.postMessage((new Date).getTime())};THREE.JSONLoader.prototype.createModel=function(h,n,m){var k=new THREE.Geometry,j=h.scale!==void 0?1/h.scale:1;this.init_materials(k,h.materials,m);(function(V){if(h.version===void 0||h.version!=2){console.error("Deprecated file format.")}else{var W,U,T,S,R,L,J,K,F,O,P,x,I,f,N=h.faces;L=h.vertices;var E=h.normals,M=h.colors,b=0;for(W=0;W<h.uvs.length;W++){h.uvs[W].length&&b++}for(W=0;W<b;W++){k.faceUvs[W]=[],k.faceVertexUvs[W]=[]}S=0;for(R=L.length;S<R;){J=new THREE.Vertex,J.position.x=L[S++]*V,J.position.y=L[S++]*V,J.position.z=L[S++]*V,k.vertices.push(J)}S=0;for(R=N.length;S<R;){V=N[S++];L=V&1;T=V&2;W=V&4;U=V&8;K=V&16;J=V&32;O=V&64;V&=128;L?(P=new THREE.Face4,P.a=N[S++],P.b=N[S++],P.c=N[S++],P.d=N[S++],L=4):(P=new THREE.Face3,P.a=N[S++],P.b=N[S++],P.c=N[S++],L=3);if(T){T=N[S++],P.materials=k.materials[T]}T=k.faces.length;if(W){for(W=0;W<b;W++){x=h.uvs[W],F=N[S++],f=x[F*2],F=x[F*2+1],k.faceUvs[W][T]=new THREE.UV(f,F)}}if(U){for(W=0;W<b;W++){x=h.uvs[W];I=[];for(U=0;U<L;U++){F=N[S++],f=x[F*2],F=x[F*2+1],I[U]=new THREE.UV(f,F)}k.faceVertexUvs[W][T]=I}}if(K){K=N[S++]*3,U=new THREE.Vector3,U.x=E[K++],U.y=E[K++],U.z=E[K],P.normal=U}if(J){for(W=0;W<L;W++){K=N[S++]*3,U=new THREE.Vector3,U.x=E[K++],U.y=E[K++],U.z=E[K],P.vertexNormals.push(U)}}if(O){J=N[S++],J=new THREE.Color(M[J]),P.color=J}if(V){for(W=0;W<L;W++){J=N[S++],J=new THREE.Color(M[J]),P.vertexColors.push(J)}}k.faces.push(P)}}})(j);(function(){var f,p,b,o;if(h.skinWeights){f=0;for(p=h.skinWeights.length;f<p;f+=2){b=h.skinWeights[f],o=h.skinWeights[f+1],k.skinWeights.push(new THREE.Vector4(b,o,0,0))}}if(h.skinIndices){f=0;for(p=h.skinIndices.length;f<p;f+=2){b=h.skinIndices[f],o=h.skinIndices[f+1],k.skinIndices.push(new THREE.Vector4(b,o,0,0))}}k.bones=h.bones;k.animation=h.animation})();(function(z){if(h.morphTargets!==void 0){var A,y,x,f,b,E,C,D,B;A=0;for(y=h.morphTargets.length;A<y;A++){k.morphTargets[A]={};k.morphTargets[A].name=h.morphTargets[A].name;k.morphTargets[A].vertices=[];D=k.morphTargets[A].vertices;B=h.morphTargets[A].vertices;x=0;for(f=B.length;x<f;x+=3){b=B[x]*z,E=B[x+1]*z,C=B[x+2]*z,D.push(new THREE.Vertex(new THREE.Vector3(b,E,C)))}}}if(h.morphColors!==void 0){A=0;for(y=h.morphColors.length;A<y;A++){k.morphColors[A]={};k.morphColors[A].name=h.morphColors[A].name;k.morphColors[A].colors=[];f=k.morphColors[A].colors;b=h.morphColors[A].colors;z=0;for(x=b.length;z<x;z+=3){E=new THREE.Color(16755200),E.setRGB(b[z],b[z+1],b[z+2]),f.push(E)}}}})(j);(function(){if(h.edges!==void 0){var o,f,b;for(o=0;o<h.edges.length;o+=2){f=h.edges[o],b=h.edges[o+1],k.edges.push(new THREE.Edge(k.vertices[f],k.vertices[b],f,b))}}})();k.computeCentroids();k.computeFaceNormals();this.hasNormals(k)&&k.computeTangents();n(k)};THREE.BinaryLoader=function(c){THREE.Loader.call(this,c)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.supr=THREE.Loader.prototype;THREE.BinaryLoader.prototype={load:function(h){var p=h.model,o=h.callback,n=h.texture_path?h.texture_path:THREE.Loader.prototype.extractUrlbase(p),m=h.bin_path?h.bin_path:THREE.Loader.prototype.extractUrlbase(p),h=(new Date).getTime(),p=new Worker(p),j=this.showProgress?THREE.Loader.prototype.updateProgress:null;p.onmessage=function(c){THREE.BinaryLoader.prototype.loadAjaxBuffers(c.data.buffers,c.data.materials,o,m,n,j)};p.onerror=function(c){alert("worker.onerror: "+c.message+"\n"+c.data);c.preventDefault()};p.postMessage(h)},loadAjaxBuffers:function(y,x,w,v,u,p){var t=new XMLHttpRequest,o=v+"/"+y,j=0;t.onreadystatechange=function(){t.readyState==4?t.status==200||t.status==0?THREE.BinaryLoader.prototype.createBinModel(t.responseText,w,u,x):alert("Couldn't load ["+o+"] ["+t.status+"]"):t.readyState==3?p&&(j==0&&(j=t.getResponseHeader("Content-Length")),p({total:j,loaded:t.responseText.length})):t.readyState==2&&(j=t.getResponseHeader("Content-Length"))};t.open("GET",o,!0);t.overrideMimeType("text/plain; charset=x-user-defined");t.setRequestHeader("Content-Type","text/plain");t.send(null)},createBinModel:function(h,n,m,k){var j=function(aH){function aG(e,w){var v=aB(e,w),u=aB(e,w+1),t=aB(e,w+2),p=aB(e,w+3),o=(p<<1&255|t>>7)-127;v|=(t&127)<<16|u<<8;if(v==0&&o==-127){return 0}return(1-2*(p>>7))*(1+v*Math.pow(2,-23))*Math.pow(2,o)}function aF(g,u){var t=aB(g,u),p=aB(g,u+1),o=aB(g,u+2);return(aB(g,u+3)<<24)+(o<<16)+(p<<8)+t}function aD(g,p){var o=aB(g,p);return(aB(g,p+1)<<8)+o}function aC(g,p){var o=aB(g,p);return o>127?o-256:o}function aB(e,g){return e.charCodeAt(g)&255}function aA(t){var p,o,g;p=aF(h,t);o=aF(h,t+aj);g=aF(h,t+Y);t=aD(h,t+ae);THREE.BinaryLoader.prototype.f3(aw,p,o,g,t)}function ay(y){var v,u,t,p,g,w;v=aF(h,y);u=aF(h,y+aj);t=aF(h,y+Y);p=aD(h,y+ae);g=aF(h,y+ai);w=aF(h,y+af);y=aF(h,y+V);THREE.BinaryLoader.prototype.f3n(aw,ak,v,u,t,p,g,w,y)}function az(u){var t,p,o,g;t=aF(h,u);p=aF(h,u+ad);o=aF(h,u+b);g=aF(h,u+aE);u=aD(h,u+ar);THREE.BinaryLoader.prototype.f4(aw,t,p,o,g,u)}function ax(B){var A,z,y,w,v,g,D,C;A=aF(h,B);z=aF(h,B+ad);y=aF(h,B+b);w=aF(h,B+aE);v=aD(h,B+ar);g=aF(h,B+R);D=aF(h,B+x);C=aF(h,B+ab);B=aF(h,B+ao);THREE.BinaryLoader.prototype.f4n(aw,ak,A,z,y,w,v,g,D,C,B)}function al(p){var o,g;o=aF(h,p);g=aF(h,p+E);p=aF(h,p+an);THREE.BinaryLoader.prototype.uv3(aw.faceVertexUvs[0],ag[o*2],ag[o*2+1],ag[g*2],ag[g*2+1],ag[p*2],ag[p*2+1])}function am(t){var p,o,g;p=aF(h,t);o=aF(h,t+au);g=aF(h,t+f);t=aF(h,t+O);THREE.BinaryLoader.prototype.uv4(aw.faceVertexUvs[0],ag[p*2],ag[p*2+1],ag[o*2],ag[o*2+1],ag[g*2],ag[g*2+1],ag[t*2],ag[t*2+1])}var aw=this,ah=0,av,ak=[],ag=[],aj,Y,ae,ai,af,V,ad,b,aE,ar,R,x,ab,ao,E,an,au,f,O,ap,ac,at,M,P,aq;THREE.Geometry.call(this);THREE.Loader.prototype.init_materials(aw,k,aH);av={signature:h.substr(ah,8),header_bytes:aB(h,ah+8),vertex_coordinate_bytes:aB(h,ah+9),normal_coordinate_bytes:aB(h,ah+10),uv_coordinate_bytes:aB(h,ah+11),vertex_index_bytes:aB(h,ah+12),normal_index_bytes:aB(h,ah+13),uv_index_bytes:aB(h,ah+14),material_index_bytes:aB(h,ah+15),nvertices:aF(h,ah+16),nnormals:aF(h,ah+16+4),nuvs:aF(h,ah+16+8),ntri_flat:aF(h,ah+16+12),ntri_smooth:aF(h,ah+16+16),ntri_flat_uv:aF(h,ah+16+20),ntri_smooth_uv:aF(h,ah+16+24),nquad_flat:aF(h,ah+16+28),nquad_smooth:aF(h,ah+16+32),nquad_flat_uv:aF(h,ah+16+36),nquad_smooth_uv:aF(h,ah+16+40)};ah+=av.header_bytes;aj=av.vertex_index_bytes;Y=av.vertex_index_bytes*2;ae=av.vertex_index_bytes*3;ai=av.vertex_index_bytes*3+av.material_index_bytes;af=av.vertex_index_bytes*3+av.material_index_bytes+av.normal_index_bytes;V=av.vertex_index_bytes*3+av.material_index_bytes+av.normal_index_bytes*2;ad=av.vertex_index_bytes;b=av.vertex_index_bytes*2;aE=av.vertex_index_bytes*3;ar=av.vertex_index_bytes*4;R=av.vertex_index_bytes*4+av.material_index_bytes;x=av.vertex_index_bytes*4+av.material_index_bytes+av.normal_index_bytes;ab=av.vertex_index_bytes*4+av.material_index_bytes+av.normal_index_bytes*2;ao=av.vertex_index_bytes*4+av.material_index_bytes+av.normal_index_bytes*3;E=av.uv_index_bytes;an=av.uv_index_bytes*2;au=av.uv_index_bytes;f=av.uv_index_bytes*2;O=av.uv_index_bytes*3;aH=av.vertex_index_bytes*3+av.material_index_bytes;aq=av.vertex_index_bytes*4+av.material_index_bytes;ap=av.ntri_flat*aH;ac=av.ntri_smooth*(aH+av.normal_index_bytes*3);at=av.ntri_flat_uv*(aH+av.uv_index_bytes*3);M=av.ntri_smooth_uv*(aH+av.normal_index_bytes*3+av.uv_index_bytes*3);P=av.nquad_flat*aq;aH=av.nquad_smooth*(aq+av.normal_index_bytes*4);aq=av.nquad_flat_uv*(aq+av.uv_index_bytes*4);ah+=function(v){for(var u,t,p,o=av.vertex_coordinate_bytes*3,e=v+av.nvertices*o;v<e;v+=o){u=aG(h,v),t=aG(h,v+av.vertex_coordinate_bytes),p=aG(h,v+av.vertex_coordinate_bytes*2),THREE.BinaryLoader.prototype.v(aw,u,t,p)}return av.nvertices*o}(ah);ah+=function(w){for(var v,u,t,p=av.normal_coordinate_bytes*3,o=w+av.nnormals*p;w<o;w+=p){v=aC(h,w),u=aC(h,w+av.normal_coordinate_bytes),t=aC(h,w+av.normal_coordinate_bytes*2),ak.push(v/127,u/127,t/127)}return av.nnormals*p}(ah);ah+=function(u){for(var t,p,o=av.uv_coordinate_bytes*2,e=u+av.nuvs*o;u<e;u+=o){t=aG(h,u),p=aG(h,u+av.uv_coordinate_bytes),ag.push(t,p)}return av.nuvs*o}(ah);ap=ah+ap;ac=ap+ac;at=ac+at;M=at+M;P=M+P;aH=P+aH;aq=aH+aq;(function(o){var v,u=av.vertex_index_bytes*3+av.material_index_bytes,t=u+av.uv_index_bytes*3,p=o+av.ntri_flat_uv*t;for(v=o;v<p;v+=t){aA(v),al(v+u)}return p-o})(ac);(function(o){var v,u=av.vertex_index_bytes*3+av.material_index_bytes+av.normal_index_bytes*3,t=u+av.uv_index_bytes*3,p=o+av.ntri_smooth_uv*t;for(v=o;v<p;v+=t){ay(v),al(v+u)}return p-o})(at);(function(o){var v,u=av.vertex_index_bytes*4+av.material_index_bytes,t=u+av.uv_index_bytes*4,p=o+av.nquad_flat_uv*t;for(v=o;v<p;v+=t){az(v),am(v+u)}return p-o})(aH);(function(o){var v,u=av.vertex_index_bytes*4+av.material_index_bytes+av.normal_index_bytes*4,t=u+av.uv_index_bytes*4,p=o+av.nquad_smooth_uv*t;for(v=o;v<p;v+=t){ax(v),am(v+u)}return p-o})(aq);(function(g){var t,p=av.vertex_index_bytes*3+av.material_index_bytes,o=g+av.ntri_flat*p;for(t=g;t<o;t+=p){aA(t)}return o-g})(ah);(function(g){var t,p=av.vertex_index_bytes*3+av.material_index_bytes+av.normal_index_bytes*3,o=g+av.ntri_smooth*p;for(t=g;t<o;t+=p){ay(t)}return o-g})(ap);(function(g){var t,p=av.vertex_index_bytes*4+av.material_index_bytes,o=g+av.nquad_flat*p;for(t=g;t<o;t+=p){az(t)}return o-g})(M);(function(g){var t,p=av.vertex_index_bytes*4+av.material_index_bytes+av.normal_index_bytes*4,o=g+av.nquad_smooth*p;for(t=g;t<o;t+=p){ax(t)}return o-g})(P);this.computeCentroids();this.computeFaceNormals();THREE.Loader.prototype.hasNormals(this)&&this.computeTangents()};j.prototype=new THREE.Geometry;j.prototype.constructor=j;n(new j(m))},v:function(g,k,j,h){g.vertices.push(new THREE.Vertex(new THREE.Vector3(k,j,h)))},f3:function(h,n,m,k,j){h.faces.push(new THREE.Face3(n,m,k,null,null,h.materials[j]))},f4:function(h,p,o,n,m,j){h.faces.push(new THREE.Face4(p,o,n,m,null,null,h.materials[j]))},f3n:function(E,D,C,B,A,y,z,x,w){var y=E.materials[y],u=D[x*3],j=D[x*3+1],x=D[x*3+2],G=D[w*3],F=D[w*3+1],w=D[w*3+2];E.faces.push(new THREE.Face3(C,B,A,[new THREE.Vector3(D[z*3],D[z*3+1],D[z*3+2]),new THREE.Vector3(u,j,x),new THREE.Vector3(G,F,w)],null,y))},f4n:function(K,J,I,H,G,E,F,D,C,z,x){var F=K.materials[F],O=J[C*3],M=J[C*3+1],C=J[C*3+2],N=J[z*3],L=J[z*3+1],z=J[z*3+2],j=J[x*3],y=J[x*3+1],x=J[x*3+2];K.faces.push(new THREE.Face4(I,H,G,E,[new THREE.Vector3(J[D*3],J[D*3+1],J[D*3+2]),new THREE.Vector3(O,M,C),new THREE.Vector3(N,L,z),new THREE.Vector3(j,y,x)],null,F))},uv3:function(n,w,v,u,t,o,p){var j=[];j.push(new THREE.UV(w,v));j.push(new THREE.UV(u,t));j.push(new THREE.UV(o,p));n.push(j)},uv4:function(A,z,y,x,w,u,v,t,p){var j=[];j.push(new THREE.UV(z,y));j.push(new THREE.UV(x,w));j.push(new THREE.UV(u,v));j.push(new THREE.UV(t,p));A.push(j)}};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};THREE.SceneLoader.prototype={load:function(h,n){var m=this,k=new Worker(h);k.postMessage(0);var j=THREE.Loader.prototype.extractUrlbase(h);k.onmessage=function(aq){function ap(f,o){return o=="relativeToHTML"?f:j+"/"+f}function an(){for(ad in O.objects){if(!M.objects[ad]){if(aa=O.objects[ad],aa.geometry!==void 0){if(af=M.geometries[aa.geometry]){var f=!1;V=[];for(e=0;e<aa.materials.length;e++){V[e]=M.materials[aa.materials[e]],f=V[e] instanceof THREE.MeshShaderMaterial}f&&af.computeTangents();P=aa.position;r=aa.rotation;q=aa.quaternion;s=aa.scale;q=0;V.length==0&&(V[0]=new THREE.MeshFaceMaterial);V.length>1&&(V=[new THREE.MeshFaceMaterial]);object=new THREE.Mesh(af,V);object.name=ad;object.position.set(P[0],P[1],P[2]);q?(object.quaternion.set(q[0],q[1],q[2],q[3]),object.useQuaternion=!0):object.rotation.set(r[0],r[1],r[2]);object.scale.set(s[0],s[1],s[2]);object.visible=aa.visible;M.scene.addObject(object);M.objects[ad]=object;aa.meshCollider&&(f=THREE.CollisionUtils.MeshColliderWBox(object),M.scene.collisions.colliders.push(f));if(aa.castsShadow){f=new THREE.ShadowVolume(af),M.scene.addChild(f),f.position=object.position,f.rotation=object.rotation,f.scale=object.scale}aa.trigger&&aa.trigger.toLowerCase()!="none"&&(f={type:aa.trigger,object:aa},M.triggers[object.name]=f)}}else{P=aa.position,r=aa.rotation,q=aa.quaternion,s=aa.scale,q=0,object=new THREE.Object3D,object.name=ad,object.position.set(P[0],P[1],P[2]),q?(object.quaternion.set(q[0],q[1],q[2],q[3]),object.useQuaternion=!0):object.rotation.set(r[0],r[1],r[2]),object.scale.set(s[0],s[1],s[2]),object.visible=aa.visible!==void 0?aa.visible:!1,M.scene.addObject(object),M.objects[ad]=object,M.empties[ad]=object,aa.trigger&&aa.trigger.toLowerCase()!="none"&&(f={type:aa.trigger,object:aa},M.triggers[object.name]=f)}}}}function am(f){return function(b){M.geometries[f]=b;an();ao-=1;m.onLoadComplete();aj()}}function al(f){return function(b){M.geometries[f]=b}}function aj(){m.callbackProgress({totalModels:g,totalTextures:c,loadedModels:g-ao,loadedTextures:c-ak},M);m.onLoadProgress();ao==0&&ak==0&&n(M)}var ae,ab,ad,Y,ah,ai,U,aa,P,ag,W,af,E,R,ac,V,x,O,L,ao,ak,g,c,M;O=aq.data;ac=new THREE.BinaryLoader;L=new THREE.JSONLoader;ak=ao=0;M={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},triggers:{},empties:{}};aq=!1;for(ad in O.objects){if(aa=O.objects[ad],aa.meshCollider){aq=!0;break}}if(aq){M.scene.collisions=new THREE.CollisionSystem}if(O.transform){aq=O.transform.position;ag=O.transform.rotation;var ar=O.transform.scale;aq&&M.scene.position.set(aq[0],aq[1],aq[2]);ag&&M.scene.rotation.set(ag[0],ag[1],ag[2]);ar&&M.scene.scale.set(ar[0],ar[1],ar[2]);(aq||ag||ar)&&M.scene.updateMatrix()}aq=function(){ak-=1;aj();m.onLoadComplete()};for(ah in O.cameras){ag=O.cameras[ah];if(ag.type=="perspective"){E=new THREE.Camera(ag.fov,ag.aspect,ag.near,ag.far)}else{if(ag.type=="ortho"){E=new THREE.Camera,E.projectionMatrix=THREE.Matrix4.makeOrtho(ag.left,ag.right,ag.top,ag.bottom,ag.near,ag.far)}}P=ag.position;ag=ag.target;E.position.set(P[0],P[1],P[2]);E.target.position.set(ag[0],ag[1],ag[2]);M.cameras[ah]=E}for(Y in O.lights){ah=O.lights[Y],E=ah.color!==void 0?ah.color:16777215,ag=ah.intensity!==void 0?ah.intensity:1,ah.type=="directional"?(P=ah.direction,x=new THREE.DirectionalLight(E,ag),x.position.set(P[0],P[1],P[2]),x.position.normalize()):ah.type=="point"?(P=ah.position,d=ah.distance,x=new THREE.PointLight(E,ag,d),x.position.set(P[0],P[1],P[2])):ah.type=="ambient"&&(x=new THREE.AmbientLight(E)),M.scene.addLight(x),M.lights[Y]=x}for(ai in O.fogs){Y=O.fogs[ai],Y.type=="linear"?R=new THREE.Fog(0,Y.near,Y.far):Y.type=="exp2"&&(R=new THREE.FogExp2(0,Y.density)),ag=Y.color,R.color.setRGB(ag[0],ag[1],ag[2]),M.fogs[ai]=R}if(M.cameras&&O.defaults.camera){M.currentCamera=M.cameras[O.defaults.camera]}if(M.fogs&&O.defaults.fog){M.scene.fog=M.fogs[O.defaults.fog]}ag=O.defaults.bgcolor;M.bgColor=new THREE.Color;M.bgColor.setRGB(ag[0],ag[1],ag[2]);M.bgColorAlpha=O.defaults.bgalpha;for(ae in O.geometries){if(ai=O.geometries[ae],ai.type=="bin_mesh"||ai.type=="ascii_mesh"){ao+=1,m.onLoadStart()}}g=ao;for(ae in O.geometries){ai=O.geometries[ae],ai.type=="cube"?(af=new THREE.CubeGeometry(ai.width,ai.height,ai.depth,ai.segmentsWidth,ai.segmentsHeight,ai.segmentsDepth,null,ai.flipped,ai.sides),M.geometries[ae]=af):ai.type=="plane"?(af=new THREE.PlaneGeometry(ai.width,ai.height,ai.segmentsWidth,ai.segmentsHeight),M.geometries[ae]=af):ai.type=="sphere"?(af=new THREE.SphereGeometry(ai.radius,ai.segmentsWidth,ai.segmentsHeight),M.geometries[ae]=af):ai.type=="cylinder"?(af=new THREE.CylinderGeometry(ai.numSegs,ai.topRad,ai.botRad,ai.height,ai.topOffset,ai.botOffset),M.geometries[ae]=af):ai.type=="torus"?(af=new THREE.TorusGeometry(ai.radius,ai.tube,ai.segmentsR,ai.segmentsT),M.geometries[ae]=af):ai.type=="icosahedron"?(af=new THREE.IcosahedronGeometry(ai.subdivisions),M.geometries[ae]=af):ai.type=="bin_mesh"?ac.load({model:ap(ai.url,O.urlBaseType),callback:am(ae)}):ai.type=="ascii_mesh"?L.load({model:ap(ai.url,O.urlBaseType),callback:am(ae)}):ai.type=="embedded_mesh"&&(ai=O.embeds[ai.id])&&L.createModel(ai,al(ae),"")}for(U in O.textures){if(ae=O.textures[U],ae.url instanceof Array){ak+=ae.url.length;for(ac=0;ac<ae.url.length;ac++){m.onLoadStart()}}else{ak+=1,m.onLoadStart()}}c=ak;for(U in O.textures){ae=O.textures[U];if(ae.mapping!=void 0&&THREE[ae.mapping]!=void 0){ae.mapping=new THREE[ae.mapping]}if(ae.url instanceof Array){ac=[];for(var e=0;e<ae.url.length;e++){ac[e]=ap(ae.url[e],O.urlBaseType)}ac=THREE.ImageUtils.loadTextureCube(ac,ae.mapping,aq)}else{ac=THREE.ImageUtils.loadTexture(ap(ae.url,O.urlBaseType),ae.mapping,aq);if(THREE[ae.minFilter]!=void 0){ac.minFilter=THREE[ae.minFilter]}if(THREE[ae.magFilter]!=void 0){ac.magFilter=THREE[ae.magFilter]}if(ae.repeat){ac.repeat.set(ae.repeat[0],ae.repeat[1]);if(ae.repeat[0]!=1){ac.wrapS=THREE.RepeatWrapping}if(ae.repeat[1]!=1){ac.wrapT=THREE.RepeatWrapping}}ae.offset&&ac.offset.set(ae.offset[0],ae.offset[1]);if(ae.wrap){L={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(L[ae.wrap[0]]!==void 0){ac.wrapS=L[ae.wrap[0]]}if(L[ae.wrap[1]]!==void 0){ac.wrapT=L[ae.wrap[1]]}}}M.textures[U]=ac}for(ab in O.materials){U=O.materials[ab];for(W in U.parameters){if(W=="envMap"||W=="map"||W=="lightMap"){U.parameters[W]=M.textures[U.parameters[W]]}else{if(W=="shading"){U.parameters[W]=U.parameters[W]=="flat"?THREE.FlatShading:THREE.SmoothShading}else{if(W=="blending"){U.parameters[W]=THREE[U.parameters[W]]?THREE[U.parameters[W]]:THREE.NormalBlending}else{if(W=="combine"){U.parameters[W]=U.parameters[W]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation}else{if(W=="vertexColors"){if(U.parameters[W]=="face"){U.parameters[W]=THREE.FaceColors}else{if(U.parameters[W]){U.parameters[W]=THREE.VertexColors}}}}}}}}if(U.parameters.opacity!==void 0&&U.parameters.opacity<1){U.parameters.transparent=!0}if(U.parameters.normalMap){ae=THREE.ShaderUtils.lib.normal;aq=THREE.UniformsUtils.clone(ae.uniforms);ac=U.parameters.color;L=U.parameters.specular;ai=U.parameters.ambient;R=U.parameters.shininess;aq.tNormal.texture=M.textures[U.parameters.normalMap];if(U.parameters.normalMapFactor){aq.uNormalScale.value=U.parameters.normalMapFactor}if(U.parameters.map){aq.tDiffuse.texture=U.parameters.map,aq.enableDiffuse.value=!0}aq.enableAO.value=!1;aq.enableSpecular.value=!1;aq.uDiffuseColor.value.setHex(ac);aq.uSpecularColor.value.setHex(L);aq.uAmbientColor.value.setHex(ai);aq.uShininess.value=R;if(U.parameters.opacity){aq.uOpacity.value=U.parameters.opacity}U=new THREE.MeshShaderMaterial({fragmentShader:ae.fragmentShader,vertexShader:ae.vertexShader,uniforms:aq,lights:!0})}else{U=new THREE[U.type](U.parameters)}M.materials[ab]=U}an();m.callbackSync(M)}}};THREE.MarchingCubes=function(e,f){THREE.Object3D.call(this);this.materials=f instanceof Array?f:[f];this.init=function(c){this.isolation=80;this.size=c;this.size2=this.size*this.size;this.size3=this.size2*this.size;this.halfsize=this.size/2;this.delta=2/this.size;this.yd=this.size;this.zd=this.size2;this.field=new Float32Array(this.size3);this.normal_cache=new Float32Array(this.size3*3);this.vlist=new Float32Array(36);this.nlist=new Float32Array(36);this.firstDraw=!0;this.maxCount=4096;this.count=0;this.hasNormal=this.hasPos=!1;this.positionArray=new Float32Array(this.maxCount*3);this.normalArray=new Float32Array(this.maxCount*3)};this.lerp=function(h,k,j){return h+(k-h)*j};this.VIntX=function(B,A,z,x,y,w,v,u,j,C){y=(y-j)/(C-j);j=this.normal_cache;A[x]=w+y*this.delta;A[x+1]=v;A[x+2]=u;z[x]=this.lerp(j[B],j[B+3],y);z[x+1]=this.lerp(j[B+1],j[B+4],y);z[x+2]=this.lerp(j[B+2],j[B+5],y)};this.VIntY=function(B,A,z,x,y,w,v,u,j,C){y=(y-j)/(C-j);j=this.normal_cache;A[x]=w;A[x+1]=v+y*this.delta;A[x+2]=u;A=B+this.yd*3;z[x]=this.lerp(j[B],j[A],y);z[x+1]=this.lerp(j[B+1],j[A+1],y);z[x+2]=this.lerp(j[B+2],j[A+2],y)};this.VIntZ=function(B,A,z,x,y,w,v,u,j,C){y=(y-j)/(C-j);j=this.normal_cache;A[x]=w;A[x+1]=v;A[x+2]=u+y*this.delta;A=B+this.zd*3;z[x]=this.lerp(j[B],j[A],y);z[x+1]=this.lerp(j[B+1],j[A+1],y);z[x+2]=this.lerp(j[B+2],j[A+2],y)};this.compNorm=function(g){var h=g*3;this.normal_cache[h]==0&&(this.normal_cache[h]=this.field[g-1]-this.field[g+1],this.normal_cache[h+1]=this.field[g-this.yd]-this.field[g+this.yd],this.normal_cache[h+2]=this.field[g-this.zd]-this.field[g+this.zd])};this.polygonize=function(ai,ah,ag,ae,af,ad){var ac=ae+1,ab=ae+this.yd,aa=ae+this.zd,V=ac+this.yd,R=ac+this.zd,U=ae+this.yd+this.zd,O=ac+this.yd+this.zd,Y=0,Z=this.field[ae],L=this.field[ac],P=this.field[ab],E=this.field[V],X=this.field[aa],N=this.field[R],W=this.field[U],x=this.field[O];Z<af&&(Y|=1);L<af&&(Y|=2);P<af&&(Y|=8);E<af&&(Y|=4);X<af&&(Y|=16);N<af&&(Y|=32);W<af&&(Y|=128);x<af&&(Y|=64);var K=THREE.edgeTable[Y];if(K==0){return 0}var T=this.delta,M=ai+T,j=ah+T,T=ag+T;K&1&&(this.compNorm(ae),this.compNorm(ac),this.VIntX(ae*3,this.vlist,this.nlist,0,af,ai,ah,ag,Z,L));K&2&&(this.compNorm(ac),this.compNorm(V),this.VIntY(ac*3,this.vlist,this.nlist,3,af,M,ah,ag,L,E));K&4&&(this.compNorm(ab),this.compNorm(V),this.VIntX(ab*3,this.vlist,this.nlist,6,af,ai,j,ag,P,E));K&8&&(this.compNorm(ae),this.compNorm(ab),this.VIntY(ae*3,this.vlist,this.nlist,9,af,ai,ah,ag,Z,P));K&16&&(this.compNorm(aa),this.compNorm(R),this.VIntX(aa*3,this.vlist,this.nlist,12,af,ai,ah,T,X,N));K&32&&(this.compNorm(R),this.compNorm(O),this.VIntY(R*3,this.vlist,this.nlist,15,af,M,ah,T,N,x));K&64&&(this.compNorm(U),this.compNorm(O),this.VIntX(U*3,this.vlist,this.nlist,18,af,ai,j,T,W,x));K&128&&(this.compNorm(aa),this.compNorm(U),this.VIntY(aa*3,this.vlist,this.nlist,21,af,ai,ah,T,X,W));K&256&&(this.compNorm(ae),this.compNorm(aa),this.VIntZ(ae*3,this.vlist,this.nlist,24,af,ai,ah,ag,Z,X));K&512&&(this.compNorm(ac),this.compNorm(R),this.VIntZ(ac*3,this.vlist,this.nlist,27,af,M,ah,ag,L,N));K&1024&&(this.compNorm(V),this.compNorm(O),this.VIntZ(V*3,this.vlist,this.nlist,30,af,M,j,ag,E,x));K&2048&&(this.compNorm(ab),this.compNorm(U),this.VIntZ(ab*3,this.vlist,this.nlist,33,af,ai,j,ag,P,W));Y<<=4;for(af=ae=0;THREE.triTable[Y+af]!=-1;){ai=Y+af,ah=ai+1,ag=ai+2,this.posnormtriv(this.vlist,this.nlist,3*THREE.triTable[ai],3*THREE.triTable[ah],3*THREE.triTable[ag],ad),af+=3,ae++}return ae};this.posnormtriv=function(o,w,u,p,t,j){var v=this.count*3;this.positionArray[v]=o[u];this.positionArray[v+1]=o[u+1];this.positionArray[v+2]=o[u+2];this.positionArray[v+3]=o[p];this.positionArray[v+4]=o[p+1];this.positionArray[v+5]=o[p+2];this.positionArray[v+6]=o[t];this.positionArray[v+7]=o[t+1];this.positionArray[v+8]=o[t+2];this.normalArray[v]=w[u];this.normalArray[v+1]=w[u+1];this.normalArray[v+2]=w[u+2];this.normalArray[v+3]=w[p];this.normalArray[v+4]=w[p+1];this.normalArray[v+5]=w[p+2];this.normalArray[v+6]=w[t];this.normalArray[v+7]=w[t+1];this.normalArray[v+8]=w[t+2];this.hasNormal=this.hasPos=!0;this.count+=3;this.count>=this.maxCount-3&&j(this)};this.begin=function(){this.count=0;this.hasNormal=this.hasPos=!1};this.end=function(g){if(this.count!=0){for(var h=this.count*3;h<this.positionArray.length;h++){this.positionArray[h]=0}g(this)}};this.addBall=function(S,R,Q,O,P){var N=this.size*Math.sqrt(O/P),M=Q*this.size,L=R*this.size,K=S*this.size,H=Math.floor(M-N);H<1&&(H=1);M=Math.floor(M+N);M>this.size-1&&(M=this.size-1);var E=Math.floor(L-N);E<1&&(E=1);L=Math.floor(L+N);L>this.size-1&&(L=this.size-1);var F=Math.floor(K-N);F<1&&(F=1);N=Math.floor(K+N);N>this.size-1&&(N=this.size-1);for(var C,I,J,x,D,j;H<M;H++){K=this.size2*H;I=H/this.size-Q;D=I*I;for(I=E;I<L;I++){J=K+this.size*I;C=I/this.size-R;j=C*C;for(C=F;C<N;C++){x=C/this.size-S,x=O/(0.000001+x*x+j+D)-P,x>0&&(this.field[J+C]+=x)}}}};this.addPlaneX=function(D,C){var B,z,A,y,x,w=this.size,j=this.yd,G=this.zd,E=this.field,F=w*Math.sqrt(D/C);F>w&&(F=w);for(B=0;B<F;B++){if(z=B/w,z*=z,y=D/(0.0001+z)-C,y>0){for(z=0;z<w;z++){x=B+z*j;for(A=0;A<w;A++){E[G*A+x]+=y}}}}};this.addPlaneY=function(E,D){var C,A,B,z,y,x,j=this.size,I=this.yd,G=this.zd,H=this.field,F=j*Math.sqrt(E/D);F>j&&(F=j);for(A=0;A<F;A++){if(C=A/j,C*=C,z=E/(0.0001+C)-D,z>0){y=A*I;for(C=0;C<j;C++){x=y+C;for(B=0;B<j;B++){H[G*B+x]+=z}}}}};this.addPlaneZ=function(p,y){var v,t,u,j,x,w;size=this.size;yd=this.yd;zd=this.zd;field=this.field;dist=size*Math.sqrt(p/y);dist>size&&(dist=size);for(u=0;u<dist;u++){if(v=u/size,v*=v,j=p/(0.0001+v)-y,j>0){x=zd*u;for(t=0;t<size;t++){w=x+t*yd;for(v=0;v<size;v++){field[w+v]+=j}}}}};this.reset=function(){var c;for(c=0;c<this.size3;c++){this.normal_cache[c*3]=0,this.field[c]=0}};this.render=function(C){this.begin();var B,A,y,z,x,w,u,j,E,D=this.size-2;for(z=1;z<D;z++){E=this.size2*z;u=(z-this.halfsize)/this.halfsize;for(y=1;y<D;y++){j=E+this.size*y;w=(y-this.halfsize)/this.halfsize;for(A=1;A<D;A++){x=(A-this.halfsize)/this.halfsize,B=j+A,this.polygonize(x,w,u,B,this.isolation,C)}}}this.end(C)};this.generateGeometry=function(){var h=0,k=new THREE.Geometry,j=[];this.render(function(x){var y,w,g,c,b,B,z,A;for(y=0;y<x.count;y++){z=y*3,b=z+1,A=z+2,w=x.positionArray[z],g=x.positionArray[b],c=x.positionArray[A],B=new THREE.Vector3(w,g,c),w=x.normalArray[z],g=x.normalArray[b],c=x.normalArray[A],z=new THREE.Vector3(w,g,c),z.normalize(),b=new THREE.Vertex(B),k.vertices.push(b),j.push(z)}nfaces=x.count/3;for(y=0;y<nfaces;y++){z=(h+y)*3,b=z+1,A=z+2,B=j[z],w=j[b],g=j[A],z=new THREE.Face3(z,b,A,[B,w,g]),k.faces.push(z)}h+=nfaces;x.count=0});return k};this.init(e)};THREE.MarchingCubes.prototype=new THREE.Object3D;THREE.MarchingCubes.prototype.constructor=THREE.MarchingCubes;THREE.edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]);THREE.triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);THREE.Trident=function(h){function n(b){return new THREE.Mesh(new THREE.CylinderGeometry(30,0.1,h.length/20,h.length/5),new THREE.MeshBasicMaterial({color:b}))}function m(f,o){var g=new THREE.Geometry;g.vertices=[new THREE.Vertex,new THREE.Vertex(f)];return new THREE.Line(g,new THREE.LineBasicMaterial({color:o}))}THREE.Object3D.call(this);var k=Math.PI/2,j,h=h||THREE.Trident.defaultParams;if(h!==THREE.Trident.defaultParams){for(j in THREE.Trident.defaultParams){h.hasOwnProperty(j)||(h[j]=THREE.Trident.defaultParams[j])}}this.scale=new THREE.Vector3(h.scale,h.scale,h.scale);this.addChild(m(new THREE.Vector3(h.length,0,0),h.xAxisColor));this.addChild(m(new THREE.Vector3(0,h.length,0),h.yAxisColor));this.addChild(m(new THREE.Vector3(0,0,h.length),h.zAxisColor));if(h.showArrows){j=n(h.xAxisColor),j.rotation.y=-k,j.position.x=h.length,this.addChild(j),j=n(h.yAxisColor),j.rotation.x=k,j.position.y=h.length,this.addChild(j),j=n(h.zAxisColor),j.rotation.y=Math.PI,j.position.z=h.length,this.addChild(j)}};THREE.Trident.prototype=new THREE.Object3D;THREE.Trident.prototype.constructor=THREE.Trident;THREE.Trident.defaultParams={xAxisColor:16711680,yAxisColor:65280,zAxisColor:255,showArrows:!0,length:100,scale:1};THREE.PlaneCollider=function(e,f){this.point=e;this.normal=f};THREE.SphereCollider=function(e,f){this.center=e;this.radius=f;this.radiusSq=f*f};THREE.BoxCollider=function(e,f){this.min=e;this.max=f;this.dynamic=!0;this.normal=new THREE.Vector3};THREE.MeshCollider=function(e,f){this.mesh=e;this.box=f;this.numFaces=this.mesh.geometry.faces.length;this.normal=new THREE.Vector3};THREE.CollisionSystem=function(){this.collisionNormal=new THREE.Vector3;this.colliders=[];this.hits=[]};THREE.Collisions=new THREE.CollisionSystem;THREE.CollisionSystem.prototype.merge=function(c){this.colliders=this.colliders.concat(c.colliders);this.hits=this.hits.concat(c.hits)};THREE.CollisionSystem.prototype.rayCastAll=function(h){h.direction.normalize();this.hits.length=0;var p,o,n,m,j=0;p=0;for(o=this.colliders.length;p<o;p++){if(m=this.colliders[p],n=this.rayCast(h,m),n<Number.MAX_VALUE){m.distance=n,n>j?this.hits.push(m):this.hits.unshift(m),j=n}}return this.hits};THREE.CollisionSystem.prototype.rayCastNearest=function(g){var k=this.rayCastAll(g);if(k.length==0){return null}for(var j=0;k[j] instanceof THREE.MeshCollider;){var h=this.rayMesh(g,k[j]);if(h.dist<Number.MAX_VALUE){k[j].distance=h.dist;k[j].faceIndex=h.faceIndex;break}j++}if(j>k.length){return null}return k[j]};THREE.CollisionSystem.prototype.rayCast=function(e,f){if(f instanceof THREE.PlaneCollider){return this.rayPlane(e,f)}else{if(f instanceof THREE.SphereCollider){return this.raySphere(e,f)}else{if(f instanceof THREE.BoxCollider){return this.rayBox(e,f)}else{if(f instanceof THREE.MeshCollider&&f.box){return this.rayBox(e,f.box)}}}}};THREE.CollisionSystem.prototype.rayMesh=function(C,B){for(var A=this.makeRayLocal(C,B.mesh),z=Number.MAX_VALUE,y,w=0;w<B.numFaces;w++){var x=B.mesh.geometry.faces[w],v=B.mesh.geometry.vertices[x.a].position,u=B.mesh.geometry.vertices[x.b].position,t=B.mesh.geometry.vertices[x.c].position,j=x instanceof THREE.Face4?B.mesh.geometry.vertices[x.d].position:null;x instanceof THREE.Face3?(x=this.rayTriangle(A,v,u,t,z,this.collisionNormal,B.mesh),x<z&&(z=x,y=w,B.normal.copy(this.collisionNormal),B.normal.normalize())):x instanceof THREE.Face4&&(x=this.rayTriangle(A,v,u,j,z,this.collisionNormal,B.mesh),x<z&&(z=x,y=w,B.normal.copy(this.collisionNormal),B.normal.normalize()),x=this.rayTriangle(A,u,t,j,z,this.collisionNormal,B.mesh),x<z&&(z=x,y=w,B.normal.copy(this.collisionNormal),B.normal.normalize()))}return{dist:z,faceIndex:y}};THREE.CollisionSystem.prototype.rayTriangle=function(y,x,w,v,u,p,t){var o=THREE.CollisionSystem.__v1,j=THREE.CollisionSystem.__v2;p.set(0,0,0);o.sub(w,x);j.sub(v,w);p.cross(o,j);o=p.dot(y.direction);if(!(o<0)){if(t.doubleSided||t.flipSided){p.multiplyScalar(-1),o*=-1}else{return Number.MAX_VALUE}}t=p.dot(x)-p.dot(y.origin);if(!(t<=0)){return Number.MAX_VALUE}if(!(t>=o*u)){return Number.MAX_VALUE}t/=o;o=THREE.CollisionSystem.__v3;o.copy(y.direction);o.multiplyScalar(t);o.addSelf(y.origin);Math.abs(p.x)>Math.abs(p.y)?Math.abs(p.x)>Math.abs(p.z)?(y=o.y-x.y,p=w.y-x.y,u=v.y-x.y,o=o.z-x.z,w=w.z-x.z,v=v.z-x.z):(y=o.x-x.x,p=w.x-x.x,u=v.x-x.x,o=o.y-x.y,w=w.y-x.y,v=v.y-x.y):Math.abs(p.y)>Math.abs(p.z)?(y=o.x-x.x,p=w.x-x.x,u=v.x-x.x,o=o.z-x.z,w=w.z-x.z,v=v.z-x.z):(y=o.x-x.x,p=w.x-x.x,u=v.x-x.x,o=o.y-x.y,w=w.y-x.y,v=v.y-x.y);x=p*v-w*u;if(x==0){return Number.MAX_VALUE}x=1/x;v=(y*v-o*u)*x;if(!(v>=0)){return Number.MAX_VALUE}x*=p*o-w*y;if(!(x>=0)){return Number.MAX_VALUE}if(!(1-v-x>=0)){return Number.MAX_VALUE}return t};THREE.CollisionSystem.prototype.makeRayLocal=function(g,k){var j=THREE.CollisionSystem.__m;THREE.Matrix4.makeInvert(k.matrixWorld,j);var h=THREE.CollisionSystem.__r;h.origin.copy(g.origin);h.direction.copy(g.direction);j.multiplyVector3(h.origin);j.rotateAxis(h.direction);h.direction.normalize();return h};THREE.CollisionSystem.prototype.rayBox=function(A,z){var y;z.dynamic&&z.mesh&&z.mesh.matrixWorld?y=this.makeRayLocal(A,z.mesh):(y=THREE.CollisionSystem.__r,y.origin.copy(A.origin),y.direction.copy(A.direction));var x=0,w=0,u=0,v=0,t=0,p=0,j=!0;y.origin.x<z.min.x?(x=z.min.x-y.origin.x,x/=y.direction.x,j=!1,v=-1):y.origin.x>z.max.x&&(x=z.max.x-y.origin.x,x/=y.direction.x,j=!1,v=1);y.origin.y<z.min.y?(w=z.min.y-y.origin.y,w/=y.direction.y,j=!1,t=-1):y.origin.y>z.max.y&&(w=z.max.y-y.origin.y,w/=y.direction.y,j=!1,t=1);y.origin.z<z.min.z?(u=z.min.z-y.origin.z,u/=y.direction.z,j=!1,p=-1):y.origin.z>z.max.z&&(u=z.max.z-y.origin.z,u/=y.direction.z,j=!1,p=1);if(j){return -1}j=0;w>x&&(j=1,x=w);u>x&&(j=2,x=u);switch(j){case 0:t=y.origin.y+y.direction.y*x;if(t<z.min.y||t>z.max.y){return Number.MAX_VALUE}y=y.origin.z+y.direction.z*x;if(y<z.min.z||y>z.max.z){return Number.MAX_VALUE}z.normal.set(v,0,0);break;case 1:v=y.origin.x+y.direction.x*x;if(v<z.min.x||v>z.max.x){return Number.MAX_VALUE}y=y.origin.z+y.direction.z*x;if(y<z.min.z||y>z.max.z){return Number.MAX_VALUE}z.normal.set(0,t,0);break;case 2:v=y.origin.x+y.direction.x*x;if(v<z.min.x||v>z.max.x){return Number.MAX_VALUE}t=y.origin.y+y.direction.y*x;if(t<z.min.y||t>z.max.y){return Number.MAX_VALUE}z.normal.set(0,0,p)}return x};THREE.CollisionSystem.prototype.rayPlane=function(g,k){var j=g.direction.dot(k.normal),h=k.point.dot(k.normal);if(j<0){j=(h-g.origin.dot(k.normal))/j}else{return Number.MAX_VALUE}return j>0?j:Number.MAX_VALUE};THREE.CollisionSystem.prototype.raySphere=function(g,k){var j=k.center.clone().subSelf(g.origin);if(j.lengthSq<k.radiusSq){return -1}var h=j.dot(g.direction.clone());if(h<=0){return Number.MAX_VALUE}j=k.radiusSq-(j.lengthSq()-h*h);if(j>=0){return Math.abs(h)-Math.sqrt(j)}return Number.MAX_VALUE};THREE.CollisionSystem.__v1=new THREE.Vector3;THREE.CollisionSystem.__v2=new THREE.Vector3;THREE.CollisionSystem.__v3=new THREE.Vector3;THREE.CollisionSystem.__nr=new THREE.Vector3;THREE.CollisionSystem.__m=new THREE.Matrix4;THREE.CollisionSystem.__r=new THREE.Ray;THREE.CollisionUtils={};THREE.CollisionUtils.MeshOBB=function(f){f.geometry.computeBoundingBox();var h=f.geometry.boundingBox,g=new THREE.Vector3(h.x[0],h.y[0],h.z[0]),h=new THREE.Vector3(h.x[1],h.y[1],h.z[1]),g=new THREE.BoxCollider(g,h);g.mesh=f;return g};THREE.CollisionUtils.MeshAABB=function(e){var f=THREE.CollisionUtils.MeshOBB(e);f.min.addSelf(e.position);f.max.addSelf(e.position);f.dynamic=!1;return f};THREE.CollisionUtils.MeshColliderWBox=function(c){return new THREE.MeshCollider(c,THREE.CollisionUtils.MeshOBB(c))};if(THREE.WebGLRenderer){THREE.AnaglyphWebGLRenderer=function(G){THREE.WebGLRenderer.call(this,G);var F=this,E=this.setSize,D=this.render,C=new THREE.Camera,A=new THREE.Camera,B=new THREE.Matrix4,z=new THREE.Matrix4,y,x,j;C.useTarget=A.useTarget=!1;C.matrixAutoUpdate=A.matrixAutoUpdate=!1;var G={minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat},K=new THREE.WebGLRenderTarget(512,512,G),I=new THREE.WebGLRenderTarget(512,512,G),J=new THREE.Camera(53,1,1,10000);J.position.z=2;_material=new THREE.MeshShaderMaterial({uniforms:{mapLeft:{type:"t",value:0,texture:K},mapRight:{type:"t",value:1,texture:I}},vertexShader:"varying vec2 vUv;\nvoid main() {\nvUv = vec2( uv.x, 1.0 - uv.y );\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D mapLeft;\nuniform sampler2D mapRight;\nvarying vec2 vUv;\nvoid main() {\nvec4 colorL, colorR;\nvec2 uv = vUv;\ncolorL = texture2D( mapLeft, uv );\ncolorR = texture2D( mapRight, uv );\ngl_FragColor = vec4( colorL.g * 0.7 + colorL.b * 0.3, colorR.g, colorR.b, colorL.a + colorR.a ) * 1.1;\n}"});var H=new THREE.Scene;H.addObject(new THREE.Mesh(new THREE.PlaneGeometry(2,2),_material));this.setSize=function(c,e){E.call(F,c,e);K.width=c;K.height=e;I.width=c;I.height=e};this.render=function(c,h){h.update(null,!0);if(y!==h.aspect||x!==h.near||j!==h.fov){y=h.aspect;x=h.near;j=h.fov;var n=h.projectionMatrix.clone(),g=125/30*0.5,m=g*x/125,k=x*Math.tan(j*Math.PI/360),f;B.n14=g;z.n14=-g;g=-k*y+m;f=k*y+m;n.n11=2*x/(f-g);n.n13=(f+g)/(f-g);C.projectionMatrix=n.clone();g=-k*y-m;f=k*y-m;n.n11=2*x/(f-g);n.n13=(f+g)/(f-g);A.projectionMatrix=n.clone()}C.matrix=h.matrixWorld.clone().multiplySelf(z);C.update(null,!0);C.position.copy(h.position);C.near=x;C.far=h.far;D.call(F,c,C,K,!0);A.matrix=h.matrixWorld.clone().multiplySelf(B);A.update(null,!0);A.position.copy(h.position);A.near=x;A.far=h.far;D.call(F,c,A,I,!0);D.call(F,H,J)}}}if(THREE.WebGLRenderer){THREE.CrosseyedWebGLRenderer=function(n){THREE.WebGLRenderer.call(this,n);this.autoClear=!1;var w=this,v=this.setSize,u=this.render,t,o,p=new THREE.Camera,j=new THREE.Camera;w.separation=10;if(n&&n.separation!==void 0){w.separation=n.separation}(new THREE.Camera(53,window.innerWidth/2/window.innerHeight,1,10000)).position.z=-10;this.setSize=function(c,e){v.call(w,c,e);t=c/2;o=e};this.render=function(c,f){this.clear();p.fov=f.fov;p.aspect=0.5*f.aspect;p.near=f.near;p.far=f.far;p.updateProjectionMatrix();p.position.copy(f.position);p.target.position.copy(f.target.position);p.translateX(w.separation);j.projectionMatrix=p.projectionMatrix;j.position.copy(f.position);j.target.position.copy(f.target.position);j.translateX(-w.separation);this.setViewport(0,0,t,o);u.call(w,c,p);this.setViewport(t,0,t,o);u.call(w,c,j,!1)}}}function Graph(b){this.options=b||{};this.nodeSet={};this.nodes=[];this.edges=[];this.layout}Graph.prototype.addNode=function(b){if(this.nodeSet[b.id]==undefined&&!this.reached_limit()){this.nodeSet[b.id]=b;this.nodes.push(b);return true}return false};Graph.prototype.getNode=function(b){return this.nodeSet[b]};Graph.prototype.addEdge=function(c,e){if(c.addConnectedTo(e)===true){var b=new Edge(c,e);this.edges.push(b);return true}return false};Graph.prototype.reached_limit=function(){if(this.options.limit!=undefined){return this.options.limit<=this.nodes.length}else{return false}};function Node(b){this.id=b;this.nodesTo=[];this.nodesFrom=[];this.position={};this.data={}}Node.prototype.addConnectedTo=function(b){if(this.connectedTo(b)===false){this.nodesTo.push(b);return true}return false};Node.prototype.connectedTo=function(e){for(var b=0;b<this.nodesTo.length;b++){var c=this.nodesTo[b];if(c.id==e.id){return true}}return false};function Edge(b,c){this.source=b;this.target=c;this.data={}}var Layout=Layout||{};Layout.ForceDirected=function(c,e){var e=e||{};var n=0.000001;var y=e.attraction||5;var u;var b=e.repulsion||0.75;var k;var g;var f;var j=0;var o=e.iterations||10000;var v=0;var c=c;var p=e.width||200;var m=e.height||200;this.init=function(){v=p/10;f=Math.sqrt(m*p/c.nodes.length);u=y*f;k=b*f};this.generate=function(){if(j<o){c.nodes.forEach(function(z){w(c,z)});c.edges.forEach(function(z){t(c,z)});c.nodes.forEach(function(z){x(c,z)});v*=(1-(j/o));j++}};var w=function(A,z){z.layout=z.layout||{};z.layout.offset_x=0;z.layout.offset_y=0;z.layout.force=0;z.layout.tmp_pos_x=z.layout.tmp_pos_x||z.position.x;z.layout.tmp_pos_y=z.layout.tmp_pos_y||z.position.y;A.nodes.forEach(function(B){if(z.id!=B.id){B.layout=B.layout||{};B.layout.tmp_pos_x=B.layout.tmp_pos_x||B.position.x;B.layout.tmp_pos_y=B.layout.tmp_pos_y||B.position.y;var F=z.layout.tmp_pos_x-B.layout.tmp_pos_x;var E=z.layout.tmp_pos_y-B.layout.tmp_pos_y;var C=Math.max(n,Math.sqrt((F*F)+(E*E)));var D=(k*k)/C;z.layout.force+=D;B.layout.force+=D;z.layout.offset_x+=(F/C)*D;z.layout.offset_y+=(E/C)*D}})};var t=function(C,A){var E=A.source.layout.tmp_pos_x-A.target.layout.tmp_pos_x;var D=A.source.layout.tmp_pos_y-A.target.layout.tmp_pos_y;var z=Math.max(n,Math.sqrt((E*E)+(D*D)));var B=(z*z)/u;A.source.layout.force-=B;A.target.layout.force+=B;A.source.layout.offset_x-=(E/z)*B;A.source.layout.offset_y-=(D/z)*B;A.target.layout.offset_x+=(E/z)*B;A.target.layout.offset_y+=(D/z)*B};var x=function(B,A){var z=Math.max(n,h(A));A.layout.tmp_pos_x+=(A.layout.offset_x/z)*Math.min(z,v);A.layout.tmp_pos_y+=(A.layout.offset_y/z)*Math.min(z,v);var C=100;if(A.position.x<(A.layout.tmp_pos_x-C)||A.position.x>(A.layout.tmp_pos_x+C)){A.position.x-=(A.position.x-A.layout.tmp_pos_x)/10}if(A.position.y<(A.layout.tmp_pos_y-C)||A.position.y>(A.layout.tmp_pos_y+C)){A.position.y-=(A.position.y-A.layout.tmp_pos_y)/10}};var h=function(z){return Math.sqrt(z.layout.offset_x*z.layout.offset_x+z.layout.offset_y*z.layout.offset_y)}};var Layout=Layout||{};Layout.ForceDirected3D=function(c,e){var e=e||{};var o=0.000001;var z=e.attraction||5;var v;var b=e.repulsion||0.75;var m;var g;var f;var j=0;var p=e.iterations||10000;var w=0;var c=c;var t=e.width||200;var n=e.height||200;this.init=function(){w=t/10;f=Math.sqrt(n*t/c.nodes.length);v=z*f;m=b*f};this.generate=function(){if(j<p){c.nodes.forEach(function(A){x(c,A)});c.edges.forEach(function(A){u(c,A)});c.nodes.forEach(function(A){y(c,A)});w*=(1-(j/p));j++}};var x=function(B,A){A.layout=A.layout||{};A.layout.offset_x=0;A.layout.offset_y=0;A.layout.offset_z=0;A.layout.force=0;A.layout.tmp_pos_x=A.layout.tmp_pos_x||A.position.x;A.layout.tmp_pos_y=A.layout.tmp_pos_y||A.position.y;A.layout.tmp_pos_z=A.layout.tmp_pos_z||A.position.z;B.nodes.forEach(function(D){if(A.id!=D.id){D.layout=D.layout||{};D.layout.tmp_pos_x=D.layout.tmp_pos_x||D.position.x;D.layout.tmp_pos_y=D.layout.tmp_pos_y||D.position.y;D.layout.tmp_pos_z=D.layout.tmp_pos_z||D.position.z;var J=A.layout.tmp_pos_x-D.layout.tmp_pos_x;var I=A.layout.tmp_pos_y-D.layout.tmp_pos_y;var H=A.layout.tmp_pos_z-D.layout.tmp_pos_z;var E=Math.max(o,Math.sqrt((J*J)+(I*I)));var G=Math.max(o,Math.sqrt((H*H)+(I*I)));var F=(m*m)/E;var C=(m*m)/G;A.layout.force+=F;D.layout.force+=F;A.layout.offset_x+=(J/E)*F;A.layout.offset_y+=(I/E)*F;A.layout.offset_z+=(H/G)*C}})};var u=function(H,C){var F=C.source.layout.tmp_pos_x-C.target.layout.tmp_pos_x;var E=C.source.layout.tmp_pos_y-C.target.layout.tmp_pos_y;var D=C.source.layout.tmp_pos_z-C.target.layout.tmp_pos_z;var I=Math.max(o,Math.sqrt((F*F)+(E*E)));var G=Math.max(o,Math.sqrt((D*D)+(E*E)));var B=(I*I)/v;var A=(G*G)/v;C.source.layout.force-=B;C.target.layout.force+=B;C.source.layout.offset_x-=(F/I)*B;C.source.layout.offset_y-=(E/I)*B;C.source.layout.offset_z-=(D/G)*A;C.target.layout.offset_x+=(F/I)*B;C.target.layout.offset_y+=(E/I)*B;C.target.layout.offset_z+=(D/G)*A};var y=function(D,B){var A=Math.max(o,h(B));var C=Math.max(o,k(B));B.layout.tmp_pos_x+=(B.layout.offset_x/A)*Math.min(A,w);B.layout.tmp_pos_y+=(B.layout.offset_y/A)*Math.min(A,w);B.layout.tmp_pos_z+=(B.layout.offset_z/C)*Math.min(C,w);var E=200;if(B.position.x<(B.layout.tmp_pos_x-E)||B.position.x>(B.layout.tmp_pos_x+E)){B.position.x-=(B.position.x-B.layout.tmp_pos_x)/10}if(B.position.y<(B.layout.tmp_pos_y-E)||B.position.y>(B.layout.tmp_pos_y+E)){B.position.y-=(B.position.y-B.layout.tmp_pos_y)/10}if(B.position.z<(B.layout.tmp_pos_z-E)||B.position.z>(B.layout.tmp_pos_z+E)){B.position.z-=(B.position.z-B.layout.tmp_pos_z)/10}};var h=function(A){return Math.sqrt(A.layout.offset_x*A.layout.offset_x+A.layout.offset_y*A.layout.offset_y)};var k=function(A){return Math.sqrt(A.layout.offset_z*A.layout.offset_z+A.layout.offset_y*A.layout.offset_y)}};var Drawing=Drawing||{};Drawing.SimpleGraph=function(w){var w=w||{};var j=w.layout||"2d";var k,f,m,p,g;var u=new Graph({limit:w.limit});v();n();c();function v(){k=new THREE.TrackballCamera({fov:40,aspect:window.innerWidth/window.innerHeight,near:1,far:1000000,rotateSpeed:0.5,zoomSpeed:5.2,panSpeed:1,noZoom:false,noPan:false,staticMoving:false,dynamicDampingFactor:0.3,keys:[65,83,68]});k.position.z=5000;f=new THREE.Scene();m=new THREE.CanvasRenderer();m.setSize(window.innerWidth,window.innerHeight);document.body.appendChild(m.domElement);g=new Stats();g.domElement.style.position="absolute";g.domElement.style.top="0px";document.body.appendChild(g.domElement)}function n(){var B=new Node(0);u.addNode(B);t(B);var y=[];y.push(B);var x=1;do{var B=y.shift();var A=e(1,10);for(var z=1;z<=A;z++){var C=new Node(z*x);if(u.addNode(C)){t(C);y.push(C);if(u.addEdge(B,C)){o(B,C)}}}x++}while(y.length!=0&&x<150);if(j==="3d"){u.layout=new Layout.ForceDirected3D(u,{width:2000,height:2000,iterations:2000})}else{u.layout=new Layout.ForceDirected(u,{width:2000,height:2000,iterations:2000})}u.layout.init()}function t(z){var A;if(j==="3d"){A=new THREE.CubeGeometry(50,50,50)}else{A=new THREE.CubeGeometry(50,50,0)}var x=new THREE.Mesh(A,[new THREE.MeshBasicMaterial({color:Math.random()*16777215}),new THREE.MeshBasicMaterial({color:16777215,opacity:0.5,wireframe:true})]);var y=2000;x.position.x=Math.floor(Math.random()*(y+y+1)-y);x.position.y=Math.floor(Math.random()*(y+y+1)-y);if(j==="3d"){x.position.z=Math.floor(Math.random()*(y+y+1)-y)}x.id=z.id;z.data.draw_object=x;z.position=x.position;f.addObject(z.data.draw_object)}function o(x,y){material=new THREE.LineBasicMaterial({color:16711680,opacity:1,linewidth:0.5});tmp_geo=new THREE.Geometry();tmp_geo.vertices.push(new THREE.Vertex(x.data.draw_object.position));tmp_geo.vertices.push(new THREE.Vertex(y.data.draw_object.position));line=new THREE.Line(tmp_geo,material,THREE.LinePieces);line.scale.x=line.scale.y=line.scale.z=1;line.originalScale=1;f.addObject(line)}function c(){requestAnimationFrame(c);b()}function b(){u.layout.generate();m.render(f,k);g.update()}function h(y,A){y.materials[0].map.image=null;var x=document.createElement("canvas");var z=x.getContext("2d");z.font="50pt arial bold";z.fillText(A,10,64);y.materials[0].map.image=x}function e(y,x){return Math.floor(Math.random()*(x-y+1)+y)}};